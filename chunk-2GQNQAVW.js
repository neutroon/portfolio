import{Aa as cr,C as Gi,Ea as Rc,Vb as Pc,Wb as Cc,Y as bc,Ya as gt,a as wc,aa as ir,b as Tc,ba as sr,d,ea as or,fa as mt,h as Jt,ka as ar,m as Ac,n as Sc,r as $i,ta as Oe,v as zi,w as ji}from"./chunk-FBE5BHJ4.js";var kc=function(t){let e=[],n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):(i&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},dd=function(t){let e=[],n=0,r=0;for(;n<t.length;){let i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=t[n++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){let s=t[n++],o=t[n++],a=t[n++],c=((i&7)<<18|(s&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(c&1023))}else{let s=t[n++],o=t[n++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|o&63)}}return e.join("")},Nc={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();let n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<t.length;i+=3){let s=t[i],o=i+1<t.length,a=o?t[i+1]:0,c=i+2<t.length,u=c?t[i+2]:0,l=s>>2,h=(s&3)<<4|a>>4,f=(a&15)<<2|u>>6,m=u&63;c||(m=64,o||(f=64)),r.push(n[l],n[h],n[f],n[m])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(kc(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):dd(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();let n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<t.length;){let s=n[t.charAt(i++)],a=i<t.length?n[t.charAt(i)]:0;++i;let u=i<t.length?n[t.charAt(i)]:64;++i;let h=i<t.length?n[t.charAt(i)]:64;if(++i,s==null||a==null||u==null||h==null)throw new Ki;let f=s<<2|a>>4;if(r.push(f),u!==64){let m=a<<4&240|u>>2;if(r.push(m),h!==64){let P=u<<6&192|h;r.push(P)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},Ki=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},fd=function(t){let e=kc(t);return Nc.encodeByteArray(e,!0)},Xt=function(t){return fd(t).replace(/\./g,"")},Qi=function(t){try{return Nc.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function pd(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var md=()=>pd().__FIREBASE_DEFAULTS__,gd=()=>{if(typeof process>"u"||typeof process.env>"u")return;let t=process.env.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},_d=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let e=t&&Qi(t[1]);return e&&JSON.parse(e)},lr=()=>{try{return md()||gd()||_d()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},Oc=t=>{var e,n;return(n=(e=lr())===null||e===void 0?void 0:e.emulatorHosts)===null||n===void 0?void 0:n[t]},xc=t=>{let e=Oc(t);if(!e)return;let n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);let r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},Yi=()=>{var t;return(t=lr())===null||t===void 0?void 0:t.config},Vc=t=>{var e;return(e=lr())===null||e===void 0?void 0:e[`_${t}`]};var ur=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}};function Lc(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let n={alg:"none",type:"JWT"},r=e||"demo-project",i=t.iat||0,s=t.sub||t.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},t);return[Xt(JSON.stringify(n)),Xt(JSON.stringify(o)),""].join(".")}function ee(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Mc(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(ee())}function yd(){var t;let e=(t=lr())===null||t===void 0?void 0:t.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Fc(){let t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function Uc(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Bc(){return!yd()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function hr(){try{return typeof indexedDB=="object"}catch{return!1}}function qc(){return new Promise((t,e)=>{try{let n=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var s;e(((s=i.error)===null||s===void 0?void 0:s.message)||"")}}catch(n){e(n)}})}var Id="FirebaseError",ce=class t extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=Id,Object.setPrototypeOf(this,t.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Pe.prototype.create)}},Pe=class{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){let r=n[0]||{},i=`${this.service}/${e}`,s=this.errors[e],o=s?vd(s,r):"Error",a=`${this.serviceName}: ${o} (${i}).`;return new ce(i,a,r)}};function vd(t,e){return t.replace(Ed,(n,r)=>{let i=e[r];return i!=null?String(i):`<${r}?>`})}var Ed=/\{\$([^}]+)}/g;function _t(t,e){if(t===e)return!0;let n=Object.keys(t),r=Object.keys(e);for(let i of n){if(!r.includes(i))return!1;let s=t[i],o=e[i];if(Dc(s)&&Dc(o)){if(!_t(s,o))return!1}else if(s!==o)return!1}for(let i of r)if(!n.includes(i))return!1;return!0}function Dc(t){return t!==null&&typeof t=="object"}function Ji(t){let e=[];for(let[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function $c(t,e){let n=new Hi(t,e);return n.subscribe.bind(n)}var Hi=class{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let i;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");wd(e,["next","error","complete"])?i=e:i={next:e,error:n,complete:r},i.next===void 0&&(i.next=Wi),i.error===void 0&&(i.error=Wi),i.complete===void 0&&(i.complete=Wi);let s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function wd(t,e){if(typeof t!="object"||t===null)return!1;for(let n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function Wi(){}var G_=4*60*60*1e3;function xe(t){return t&&t._delegate?t._delegate:t}var ue=class{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var Ge="[DEFAULT]";var Xi=class{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){let r=new ur;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{let i=this.getOrInitializeService({instanceIdentifier:n});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){var n;let r=this.normalizeInstanceIdentifier(e?.identifier),i=(n=e?.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Ad(e))try{this.getOrInitializeService({instanceIdentifier:Ge})}catch{}for(let[n,r]of this.instancesDeferred.entries()){let i=this.normalizeInstanceIdentifier(n);try{let s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=Ge){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){return d(this,null,function*(){let e=Array.from(this.instances.values());yield Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])})}isComponentSet(){return this.component!=null}isInitialized(e=Ge){return this.instances.has(e)}getOptions(e=Ge){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:r,options:n});for(let[s,o]of this.instancesDeferred.entries()){let a=this.normalizeInstanceIdentifier(s);r===a&&o.resolve(i)}return i}onInit(e,n){var r;let i=this.normalizeInstanceIdentifier(n),s=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;s.add(e),this.onInitCallbacks.set(i,s);let o=this.instances.get(i);return o&&e(o,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,n){let r=this.onInitCallbacks.get(n);if(r)for(let i of r)try{i(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Td(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Ge){return this.component?this.component.multipleInstances?e:Ge:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function Td(t){return t===Ge?void 0:t}function Ad(t){return t.instantiationMode==="EAGER"}var dr=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let n=new Xi(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}};var Sd=[],S=function(t){return t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT",t}(S||{}),bd={debug:S.DEBUG,verbose:S.VERBOSE,info:S.INFO,warn:S.WARN,error:S.ERROR,silent:S.SILENT},Rd=S.INFO,Pd={[S.DEBUG]:"log",[S.VERBOSE]:"log",[S.INFO]:"info",[S.WARN]:"warn",[S.ERROR]:"error"},Cd=(t,e,...n)=>{if(e<t.logLevel)return;let r=new Date().toISOString(),i=Pd[e];if(i)console[i](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},Ve=class{constructor(e){this.name=e,this._logLevel=Rd,this._logHandler=Cd,this._userLogHandler=null,Sd.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in S))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?bd[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,S.DEBUG,...e),this._logHandler(this,S.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,S.VERBOSE,...e),this._logHandler(this,S.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,S.INFO,...e),this._logHandler(this,S.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,S.WARN,...e),this._logHandler(this,S.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,S.ERROR,...e),this._logHandler(this,S.ERROR,...e)}};var Dd=(t,e)=>e.some(n=>t instanceof n),zc,jc;function kd(){return zc||(zc=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Nd(){return jc||(jc=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var Gc=new WeakMap,es=new WeakMap,Wc=new WeakMap,Zi=new WeakMap,ns=new WeakMap;function Od(t){let e=new Promise((n,r)=>{let i=()=>{t.removeEventListener("success",s),t.removeEventListener("error",o)},s=()=>{n(_e(t.result)),i()},o=()=>{r(t.error),i()};t.addEventListener("success",s),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&Gc.set(n,t)}).catch(()=>{}),ns.set(e,t),e}function xd(t){if(es.has(t))return;let e=new Promise((n,r)=>{let i=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",o),t.removeEventListener("abort",o)},s=()=>{n(),i()},o=()=>{r(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",s),t.addEventListener("error",o),t.addEventListener("abort",o)});es.set(t,e)}var ts={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return es.get(t);if(e==="objectStoreNames")return t.objectStoreNames||Wc.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return _e(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function Kc(t){ts=t(ts)}function Vd(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){let r=t.call(fr(this),e,...n);return Wc.set(r,e.sort?e.sort():[e]),_e(r)}:Nd().includes(t)?function(...e){return t.apply(fr(this),e),_e(Gc.get(this))}:function(...e){return _e(t.apply(fr(this),e))}}function Ld(t){return typeof t=="function"?Vd(t):(t instanceof IDBTransaction&&xd(t),Dd(t,kd())?new Proxy(t,ts):t)}function _e(t){if(t instanceof IDBRequest)return Od(t);if(Zi.has(t))return Zi.get(t);let e=Ld(t);return e!==t&&(Zi.set(t,e),ns.set(e,t)),e}var fr=t=>ns.get(t);function Qc(t,e,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){let o=indexedDB.open(t,e),a=_e(o);return r&&o.addEventListener("upgradeneeded",c=>{r(_e(o.result),c.oldVersion,c.newVersion,_e(o.transaction),c)}),n&&o.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),a.then(c=>{s&&c.addEventListener("close",()=>s()),i&&c.addEventListener("versionchange",u=>i(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}var Md=["get","getKey","getAll","getAllKeys","count"],Fd=["put","add","delete","clear"],rs=new Map;function Hc(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(rs.get(e))return rs.get(e);let n=e.replace(/FromIndex$/,""),r=e!==n,i=Fd.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||Md.includes(n)))return;let s=function(o,...a){return d(this,null,function*(){let c=this.transaction(o,i?"readwrite":"readonly"),u=c.store;return r&&(u=u.index(a.shift())),(yield Promise.all([u[n](...a),i&&c.done]))[0]})};return rs.set(e,s),s}Kc(t=>Tc(wc({},t),{get:(e,n,r)=>Hc(e,n)||t.get(e,n,r),has:(e,n)=>!!Hc(e,n)||t.has(e,n)}));var ss=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(Ud(n)){let r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}};function Ud(t){let e=t.getComponent();return e?.type==="VERSION"}var os="@firebase/app",Yc="0.10.0";var We=new Ve("@firebase/app"),Bd="@firebase/app-compat",qd="@firebase/analytics-compat",$d="@firebase/analytics",zd="@firebase/app-check-compat",jd="@firebase/app-check",Gd="@firebase/auth",Wd="@firebase/auth-compat",Kd="@firebase/database",Hd="@firebase/database-compat",Qd="@firebase/functions",Yd="@firebase/functions-compat",Jd="@firebase/installations",Xd="@firebase/installations-compat",Zd="@firebase/messaging",ef="@firebase/messaging-compat",tf="@firebase/performance",nf="@firebase/performance-compat",rf="@firebase/remote-config",sf="@firebase/remote-config-compat",of="@firebase/storage",af="@firebase/storage-compat",cf="@firebase/firestore",uf="@firebase/firestore-compat",lf="firebase",hf="10.10.0";var as="[DEFAULT]",df={[os]:"fire-core",[Bd]:"fire-core-compat",[$d]:"fire-analytics",[qd]:"fire-analytics-compat",[jd]:"fire-app-check",[zd]:"fire-app-check-compat",[Gd]:"fire-auth",[Wd]:"fire-auth-compat",[Kd]:"fire-rtdb",[Hd]:"fire-rtdb-compat",[Qd]:"fire-fn",[Yd]:"fire-fn-compat",[Jd]:"fire-iid",[Xd]:"fire-iid-compat",[Zd]:"fire-fcm",[ef]:"fire-fcm-compat",[tf]:"fire-perf",[nf]:"fire-perf-compat",[rf]:"fire-rc",[sf]:"fire-rc-compat",[of]:"fire-gcs",[af]:"fire-gcs-compat",[cf]:"fire-fst",[uf]:"fire-fst-compat","fire-js":"fire-js",[lf]:"fire-js-all"};var Zt=new Map,ff=new Map,cs=new Map;function Jc(t,e){try{t.container.addComponent(e)}catch(n){We.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Me(t){let e=t.name;if(cs.has(e))return We.debug(`There were multiple attempts to register component ${e}.`),!1;cs.set(e,t);for(let n of Zt.values())Jc(n,t);for(let n of ff.values())Jc(n,t);return!0}function ds(t,e){let n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function yt(t){return t.settings!==void 0}var pf={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Le=new Pe("app","Firebase",pf);var us=class{constructor(e,n,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new ue("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Le.create("app-deleted",{appName:this._name})}};var It=hf;function fs(t,e={}){let n=t;typeof e!="object"&&(e={name:e});let r=Object.assign({name:as,automaticDataCollectionEnabled:!1},e),i=r.name;if(typeof i!="string"||!i)throw Le.create("bad-app-name",{appName:String(i)});if(n||(n=Yi()),!n)throw Le.create("no-options");let s=Zt.get(i);if(s){if(_t(n,s.options)&&_t(r,s.config))return s;throw Le.create("duplicate-app",{appName:i})}let o=new dr(i);for(let c of cs.values())o.addComponent(c);let a=new us(n,r,o);return Zt.set(i,a),a}function tn(t=as){let e=Zt.get(t);if(!e&&t===as&&Yi())return fs();if(!e)throw Le.create("no-app",{appName:t});return e}function pr(){return Array.from(Zt.values())}function W(t,e,n){var r;let i=(r=df[t])!==null&&r!==void 0?r:t;n&&(i+=`-${n}`);let s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){let a=[`Unable to register library "${i}" with version "${e}":`];s&&a.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),We.warn(a.join(" "));return}Me(new ue(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}var mf="firebase-heartbeat-database",gf=1,en="firebase-heartbeat-store",is=null;function tu(){return is||(is=Qc(mf,gf,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(en)}catch(n){console.warn(n)}}}}).catch(t=>{throw Le.create("idb-open",{originalErrorMessage:t.message})})),is}function _f(t){return d(this,null,function*(){try{let n=(yield tu()).transaction(en),r=yield n.objectStore(en).get(nu(t));return yield n.done,r}catch(e){if(e instanceof ce)We.warn(e.message);else{let n=Le.create("idb-get",{originalErrorMessage:e?.message});We.warn(n.message)}}})}function Xc(t,e){return d(this,null,function*(){try{let r=(yield tu()).transaction(en,"readwrite");yield r.objectStore(en).put(e,nu(t)),yield r.done}catch(n){if(n instanceof ce)We.warn(n.message);else{let r=Le.create("idb-set",{originalErrorMessage:n?.message});We.warn(r.message)}}})}function nu(t){return`${t.name}!${t.options.appId}`}var yf=1024,If=30*24*60*60*1e3,ls=class{constructor(e){this.container=e,this._heartbeatsCache=null;let n=this.container.getProvider("app").getImmediate();this._storage=new hs(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}triggerHeartbeat(){return d(this,null,function*(){var e,n;let i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=Zc();if(!(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,((n=this._heartbeatsCache)===null||n===void 0?void 0:n.heartbeats)==null))&&!(this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(o=>o.date===s)))return this._heartbeatsCache.heartbeats.push({date:s,agent:i}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{let a=new Date(o.date).valueOf();return Date.now()-a<=If}),this._storage.overwrite(this._heartbeatsCache)})}getHeartbeatsHeader(){return d(this,null,function*(){var e;if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";let n=Zc(),{heartbeatsToSend:r,unsentEntries:i}=vf(this._heartbeatsCache.heartbeats),s=Xt(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,i.length>0?(this._heartbeatsCache.heartbeats=i,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s})}};function Zc(){return new Date().toISOString().substring(0,10)}function vf(t,e=yf){let n=[],r=t.slice();for(let i of t){let s=n.find(o=>o.agent===i.agent);if(s){if(s.dates.push(i.date),eu(n)>e){s.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),eu(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}var hs=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return d(this,null,function*(){return hr()?qc().then(()=>!0).catch(()=>!1):!1})}read(){return d(this,null,function*(){if(yield this._canUseIndexedDBPromise){let n=yield _f(this.app);return n?.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(e){return d(this,null,function*(){var n;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return Xc(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return})}add(e){return d(this,null,function*(){var n;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return Xc(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return})}};function eu(t){return Xt(JSON.stringify({version:2,heartbeats:t})).length}function Ef(t){Me(new ue("platform-logger",e=>new ss(e),"PRIVATE")),Me(new ue("heartbeat",e=>new ls(e),"PRIVATE")),W(os,Yc,t),W(os,Yc,"esm2017"),W("fire-js","")}Ef("");var wf="firebase",Tf="10.10.0";W(wf,Tf,"app");var Et=new Pc("ANGULARFIRE2_VERSION");function gs(t,e,n){if(e){if(e.length===1)return e[0];let s=e.filter(o=>o.app===n);if(s.length===1)return s[0]}return n.container.getProvider(t).getImmediate({optional:!0})}var rn=(t,e)=>{let n=e?[e]:pr(),r=[];return n.forEach(i=>{i.container.getProvider(t).instances.forEach(o=>{r.includes(o)||r.push(o)})}),r},nn=class{constructor(){return rn(Af)}},Af="app-check";function vt(){}var mr=class{zone;delegate;constructor(e,n=Sc){this.zone=e,this.delegate=n}now(){return this.delegate.now()}schedule(e,n,r){let i=this.zone,s=function(o){i.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,n,r)}},ps=class{zone;task=null;constructor(e){this.zone=e}call(e,n){let r=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",vt,{},vt,vt)),n.pipe(bc({next:r,complete:r,error:r})).subscribe(e).add(r)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},sn=(()=>{class t{ngZone;outsideAngular;insideAngular;constructor(n){this.ngZone=n,this.outsideAngular=n.runOutsideAngular(()=>new mr(Zone.current)),this.insideAngular=n.run(()=>new mr(Zone.current,Ac)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(r){return new(r||t)(mt(gt))};static \u0275prov=ir({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function gr(){let t=globalThis.\u0275AngularFireScheduler;if(!t)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return t}function Sf(t){return gr().ngZone.runOutsideAngular(()=>t())}function Ke(t){return gr().ngZone.run(()=>t())}function bf(t){return Rf(gr())(t)}function Rf(t){return function(n){return n=n.lift(new ps(t.ngZone)),n.pipe(ji(t.outsideAngular),zi(t.insideAngular))}}var Pf=(t,e)=>function(){let r=arguments;return e&&setTimeout(()=>{e.state==="scheduled"&&e.invoke()},10),Ke(()=>t.apply(void 0,r))},He=(t,e)=>function(){let n,r=arguments;for(let s=0;s<arguments.length;s++)typeof r[s]=="function"&&(e&&(n||=Ke(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",vt,{},vt,vt))),r[s]=Pf(r[s],n));let i=Sf(()=>t.apply(this,r));if(!e)if(i instanceof Jt){let s=gr();return i.pipe(ji(s.outsideAngular),zi(s.insideAngular))}else return Ke(()=>i);return i instanceof Jt?i.pipe(bf):i instanceof Promise?Ke(()=>new Promise((s,o)=>i.then(a=>Ke(()=>s(a)),a=>Ke(()=>o(a))))):typeof i=="function"&&n?function(){return setTimeout(()=>{n&&n.state==="scheduled"&&n.invoke()},10),i.apply(this,arguments)}:Ke(()=>i)};var Qe=class{constructor(e){return e}},on=class{constructor(){return pr()}};function Cf(t){return t&&t.length===1?t[0]:new Qe(tn())}var _s=new or("angularfire2._apps"),Df={provide:Qe,useFactory:Cf,deps:[[new Oe,_s]]},kf={provide:on,deps:[[new Oe,_s]]};function Nf(t){return(e,n)=>{let r=e.runOutsideAngular(()=>t(n));return new Qe(r)}}var Of=(()=>{class t{constructor(n){W("angularfire",Et.full,"core"),W("angularfire",Et.full,"app"),W("angular",Cc.full,n.toString())}static \u0275fac=function(r){return new(r||t)(mt(Rc))};static \u0275mod=ar({type:t});static \u0275inj=sr({providers:[Df,kf]})}return t})();function Cy(t,...e){return{ngModule:Of,providers:[{provide:_s,useFactory:Nf(t),multi:!0,deps:[gt,cr,sn,...e]}]}}var Dy=He(fs,!0);function lu(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}var hu=lu,du=new Pe("auth","Firebase",lu());var vr=new Ve("@firebase/auth");function Vf(t,...e){vr.logLevel<=S.WARN&&vr.warn(`Auth (${It}): ${t}`,...e)}function yr(t,...e){vr.logLevel<=S.ERROR&&vr.error(`Auth (${It}): ${t}`,...e)}function ru(t,...e){throw Cs(t,...e)}function Ps(t,...e){return Cs(t,...e)}function fu(t,e,n){let r=Object.assign(Object.assign({},hu()),{[e]:n});return new Pe("auth","Firebase",r).create(e,{appName:t.name})}function Ir(t){return fu(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Cs(t,...e){if(typeof t!="string"){let n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return du.create(t,...e)}function k(t,e,...n){if(!t)throw Cs(e,...n)}function an(t){let e="INTERNAL ASSERTION FAILED: "+t;throw yr(e),new Error(e)}function Er(t,e){t||an(e)}function Lf(){return iu()==="http:"||iu()==="https:"}function iu(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}function Mf(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Lf()||Fc()||"connection"in navigator)?navigator.onLine:!0}function Ff(){if(typeof navigator>"u")return null;let t=navigator;return t.languages&&t.languages[0]||t.language||null}var Je=class{constructor(e,n){this.shortDelay=e,this.longDelay=n,Er(n>e,"Short delay should be less than long delay!"),this.isMobile=Mc()||Uc()}get(){return Mf()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};function Uf(t,e){Er(t.emulator,"Emulator should always be set here");let{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}var wr=class{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;an("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;an("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;an("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};var Bf={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};var qf=new Je(3e4,6e4);function pu(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}function br(s,o,a,c){return d(this,arguments,function*(t,e,n,r,i={}){return mu(t,i,()=>d(this,null,function*(){let u={},l={};r&&(e==="GET"?l=r:u={body:JSON.stringify(r)});let h=Ji(Object.assign({key:t.config.apiKey},l)).slice(1),f=yield t._getAdditionalHeaders();return f["Content-Type"]="application/json",t.languageCode&&(f["X-Firebase-Locale"]=t.languageCode),wr.fetch()(gu(t,t.config.apiHost,n,h),Object.assign({method:e,headers:f,referrerPolicy:"no-referrer"},u))}))})}function mu(t,e,n){return d(this,null,function*(){t._canInitEmulator=!1;let r=Object.assign(Object.assign({},Bf),e);try{let i=new vs(t),s=yield Promise.race([n(),i.promise]);i.clearNetworkTimeout();let o=yield s.json();if("needConfirmation"in o)throw _r(t,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{let a=s.ok?o.errorMessage:o.error.message,[c,u]=a.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw _r(t,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw _r(t,"email-already-in-use",o);if(c==="USER_DISABLED")throw _r(t,"user-disabled",o);let l=r[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw fu(t,l,u);ru(t,l)}}catch(i){if(i instanceof ce)throw i;ru(t,"network-request-failed",{message:String(i)})}})}function gu(t,e,n,r){let i=`${e}${n}?${r}`;return t.config.emulator?Uf(t.config,i):`${t.config.apiScheme}://${i}`}var vs=class{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(Ps(this.auth,"network-request-failed")),qf.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}};function _r(t,e,n){let r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);let i=Ps(t,e,r);return i.customData._tokenResponse=n,i}function $f(t,e){return d(this,null,function*(){return br(t,"POST","/v1/accounts:delete",e)})}function _u(t,e){return d(this,null,function*(){return br(t,"POST","/v1/accounts:lookup",e)})}function cn(t){if(t)try{let e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}function Ds(t,e=!1){return d(this,null,function*(){let n=xe(t),r=yield n.getIdToken(e),i=yu(r);k(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");let s=typeof i.firebase=="object"?i.firebase:void 0,o=s?.sign_in_provider;return{claims:i,token:r,authTime:cn(ys(i.auth_time)),issuedAtTime:cn(ys(i.iat)),expirationTime:cn(ys(i.exp)),signInProvider:o||null,signInSecondFactor:s?.sign_in_second_factor||null}})}function ys(t){return Number(t)*1e3}function yu(t){let[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return yr("JWT malformed, contained fewer than 3 sections"),null;try{let i=Qi(n);return i?JSON.parse(i):(yr("Failed to decode base64 JWT payload"),null)}catch(i){return yr("Caught error parsing JWT payload as JSON",i?.toString()),null}}function su(t){let e=yu(t);return k(e,"internal-error"),k(typeof e.exp<"u","internal-error"),k(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}function Es(t,e,n=!1){return d(this,null,function*(){if(n)return e;try{return yield e}catch(r){throw r instanceof ce&&zf(r)&&t.auth.currentUser===t&&(yield t.auth.signOut()),r}})}function zf({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}var ws=class{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var n;if(e){let r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;let i=((n=this.user.stsTokenManager.expirationTime)!==null&&n!==void 0?n:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;let n=this.getInterval(e);this.timerId=setTimeout(()=>d(this,null,function*(){yield this.iteration()}),n)}iteration(){return d(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()})}};var ln=class{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=cn(this.lastLoginAt),this.creationTime=cn(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};function Tr(t){return d(this,null,function*(){var e;let n=t.auth,r=yield t.getIdToken(),i=yield Es(t,_u(n,{idToken:r}));k(i?.users.length,n,"internal-error");let s=i.users[0];t._notifyReloadListener(s);let o=!((e=s.providerUserInfo)===null||e===void 0)&&e.length?Iu(s.providerUserInfo):[],a=jf(t.providerData,o),c=t.isAnonymous,u=!(t.email&&s.passwordHash)&&!a?.length,l=c?u:!1,h={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new ln(s.createdAt,s.lastLoginAt),isAnonymous:l};Object.assign(t,h)})}function ks(t){return d(this,null,function*(){let e=xe(t);yield Tr(e),yield e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)})}function jf(t,e){return[...t.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function Iu(t){return t.map(e=>{var{providerId:n}=e,r=$i(e,["providerId"]);return{providerId:n,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}function Gf(t,e){return d(this,null,function*(){let n=yield mu(t,{},()=>d(this,null,function*(){let r=Ji({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=t.config,o=gu(t,i,"/v1/token",`key=${s}`),a=yield t._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",wr.fetch()(o,{method:"POST",headers:a,body:r})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}})}function Wf(t,e){return d(this,null,function*(){return br(t,"POST","/v2/accounts:revokeToken",pu(t,e))})}var un=class t{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){k(e.idToken,"internal-error"),k(typeof e.idToken<"u","internal-error"),k(typeof e.refreshToken<"u","internal-error");let n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):su(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){k(e.length!==0,"internal-error");let n=su(e);this.updateTokensAndExpiration(e,null,n)}getToken(e,n=!1){return d(this,null,function*(){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(k(this.refreshToken,e,"user-token-expired"),this.refreshToken?(yield this.refresh(e,this.refreshToken),this.accessToken):null)})}clearRefreshToken(){this.refreshToken=null}refresh(e,n){return d(this,null,function*(){let{accessToken:r,refreshToken:i,expiresIn:s}=yield Gf(e,n);this.updateTokensAndExpiration(r,i,Number(s))})}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){let{refreshToken:r,accessToken:i,expirationTime:s}=n,o=new t;return r&&(k(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),i&&(k(typeof i=="string","internal-error",{appName:e}),o.accessToken=i),s&&(k(typeof s=="number","internal-error",{appName:e}),o.expirationTime=s),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new t,this.toJSON())}_performRefresh(){return an("not implemented")}};function Fe(t,e){k(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}var hn=class t{constructor(e){var{uid:n,auth:r,stsTokenManager:i}=e,s=$i(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new ws(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new ln(s.createdAt||void 0,s.lastLoginAt||void 0)}getIdToken(e){return d(this,null,function*(){let n=yield Es(this,this.stsTokenManager.getToken(this.auth,e));return k(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n})}getIdTokenResult(e){return Ds(this,e)}reload(){return ks(this)}_assign(e){this!==e&&(k(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>Object.assign({},n)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let n=new t(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return n.metadata._copy(this.metadata),n}_onReload(e){k(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,n=!1){return d(this,null,function*(){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&(yield Tr(this)),yield this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)})}delete(){return d(this,null,function*(){if(yt(this.auth.app))return Promise.reject(Ir(this.auth));let e=yield this.getIdToken();return yield Es(this,$f(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){var r,i,s,o,a,c,u,l;let h=(r=n.displayName)!==null&&r!==void 0?r:void 0,f=(i=n.email)!==null&&i!==void 0?i:void 0,m=(s=n.phoneNumber)!==null&&s!==void 0?s:void 0,P=(o=n.photoURL)!==null&&o!==void 0?o:void 0,b=(a=n.tenantId)!==null&&a!==void 0?a:void 0,E=(c=n._redirectEventId)!==null&&c!==void 0?c:void 0,V=(u=n.createdAt)!==null&&u!==void 0?u:void 0,j=(l=n.lastLoginAt)!==null&&l!==void 0?l:void 0,{uid:Y,emailVerified:Z,isAnonymous:ge,providerData:G,stsTokenManager:Re}=n;k(Y&&Re,e,"internal-error");let pt=un.fromJSON(this.name,Re);k(typeof Y=="string",e,"internal-error"),Fe(h,e.name),Fe(f,e.name),k(typeof Z=="boolean",e,"internal-error"),k(typeof ge=="boolean",e,"internal-error"),Fe(m,e.name),Fe(P,e.name),Fe(b,e.name),Fe(E,e.name),Fe(V,e.name),Fe(j,e.name);let Yt=new t({uid:Y,auth:e,email:f,emailVerified:Z,displayName:h,isAnonymous:ge,photoURL:P,phoneNumber:m,tenantId:b,stsTokenManager:pt,createdAt:V,lastLoginAt:j});return G&&Array.isArray(G)&&(Yt.providerData=G.map(rr=>Object.assign({},rr))),E&&(Yt._redirectEventId=E),Yt}static _fromIdTokenResponse(e,n,r=!1){return d(this,null,function*(){let i=new un;i.updateFromServerResponse(n);let s=new t({uid:n.localId,auth:e,stsTokenManager:i,isAnonymous:r});return yield Tr(s),s})}static _fromGetAccountInfoResponse(e,n,r){return d(this,null,function*(){let i=n.users[0];k(i.localId!==void 0,"internal-error");let s=i.providerUserInfo!==void 0?Iu(i.providerUserInfo):[],o=!(i.email&&i.passwordHash)&&!s?.length,a=new un;a.updateFromIdToken(r);let c=new t({uid:i.localId,auth:e,stsTokenManager:a,isAnonymous:o}),u={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new ln(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!s?.length};return Object.assign(c,u),c})}};var ou=new Map;function Ye(t){Er(t instanceof Function,"Expected a class definition");let e=ou.get(t);return e?(Er(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,ou.set(t,e),e)}var Kf=(()=>{class t{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return d(this,null,function*(){return!0})}_set(n,r){return d(this,null,function*(){this.storage[n]=r})}_get(n){return d(this,null,function*(){let r=this.storage[n];return r===void 0?null:r})}_remove(n){return d(this,null,function*(){delete this.storage[n]})}_addListener(n,r){}_removeListener(n,r){}}return t.type="NONE",t})(),Ts=Kf;function Is(t,e,n){return`firebase:${t}:${e}:${n}`}var Ar=class t{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;let{config:i,name:s}=this.auth;this.fullUserKey=Is(this.userKey,i.apiKey,s),this.fullPersistenceKey=Is("persistence",i.apiKey,s),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){return d(this,null,function*(){let e=yield this.persistence._get(this.fullUserKey);return e?hn._fromJSON(this.auth,e):null})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){return d(this,null,function*(){if(this.persistence===e)return;let n=yield this.getCurrentUser();if(yield this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,n,r="authUser"){return d(this,null,function*(){if(!n.length)return new t(Ye(Ts),e,r);let i=(yield Promise.all(n.map(u=>d(this,null,function*(){if(yield u._isAvailable())return u})))).filter(u=>u),s=i[0]||Ye(Ts),o=Is(r,e.config.apiKey,e.name),a=null;for(let u of n)try{let l=yield u._get(o);if(l){let h=hn._fromJSON(e,l);u!==s&&(a=h),s=u;break}}catch{}let c=i.filter(u=>u._shouldAllowMigration);return!s._shouldAllowMigration||!c.length?new t(s,e,r):(s=c[0],a&&(yield s._set(o,a.toJSON())),yield Promise.all(n.map(u=>d(this,null,function*(){if(u!==s)try{yield u._remove(o)}catch{}}))),new t(s,e,r))})}};function au(t){let e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Jf(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Hf(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Zf(e))return"Blackberry";if(ep(e))return"Webos";if(Qf(e))return"Safari";if((e.includes("chrome/")||Yf(e))&&!e.includes("edge/"))return"Chrome";if(Xf(e))return"Android";{let n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if(r?.length===2)return r[1]}return"Other"}function Hf(t=ee()){return/firefox\//i.test(t)}function Qf(t=ee()){let e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Yf(t=ee()){return/crios\//i.test(t)}function Jf(t=ee()){return/iemobile/i.test(t)}function Xf(t=ee()){return/android/i.test(t)}function Zf(t=ee()){return/blackberry/i.test(t)}function ep(t=ee()){return/webos/i.test(t)}function vu(t,e=[]){let n;switch(t){case"Browser":n=au(ee());break;case"Worker":n=`${au(ee())}-${t}`;break;default:n=t}let r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${It}/${r}`}var As=class{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){let r=s=>new Promise((o,a)=>{try{let c=e(s);o(c)}catch(c){a(c)}});r.onAbort=n,this.queue.push(r);let i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}runMiddleware(e){return d(this,null,function*(){if(this.auth.currentUser===e)return;let n=[];try{for(let r of this.queue)yield r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(let i of n)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}})}};function tp(n){return d(this,arguments,function*(t,e={}){return br(t,"GET","/v2/passwordPolicy",pu(t,e))})}var np=6,Ss=class{constructor(e){var n,r,i,s;let o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(n=o.minPasswordLength)!==null&&n!==void 0?n:np,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(s=e.forceUpgradeOnSignin)!==null&&s!==void 0?s:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var n,r,i,s,o,a;let c={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,c),this.validatePasswordCharacterOptions(e,c),c.isValid&&(c.isValid=(n=c.meetsMinPasswordLength)!==null&&n!==void 0?n:!0),c.isValid&&(c.isValid=(r=c.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),c.isValid&&(c.isValid=(i=c.containsLowercaseLetter)!==null&&i!==void 0?i:!0),c.isValid&&(c.isValid=(s=c.containsUppercaseLetter)!==null&&s!==void 0?s:!0),c.isValid&&(c.isValid=(o=c.containsNumericCharacter)!==null&&o!==void 0?o:!0),c.isValid&&(c.isValid=(a=c.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),c}validatePasswordLengthOptions(e,n){let r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),i&&(n.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}};var bs=class{constructor(e,n,r,i){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Sr(this),this.idTokenSubscription=new Sr(this),this.beforeStateQueue=new As(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=du,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=Ye(n)),this._initializationPromise=this.queue(()=>d(this,null,function*(){var r,i;if(!this._deleted&&(this.persistenceManager=yield Ar.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch{}yield this.initializeCurrentUser(n),this.lastNotifiedUid=((i=this.currentUser)===null||i===void 0?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return d(this,null,function*(){if(this._deleted)return;let e=yield this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),yield this.currentUser.getIdToken();return}yield this._updateCurrentUser(e,!0)}})}initializeCurrentUserFromIdToken(e){return d(this,null,function*(){try{let n=yield _u(this,{idToken:e}),r=yield hn._fromGetAccountInfoResponse(this,n,e);yield this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(e){return d(this,null,function*(){var n;if(yt(this.app)){let o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}let r=yield this.assertedPersistence.getCurrentUser(),i=r,s=!1;if(e&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();let o=(n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId,a=i?._redirectEventId,c=yield this.tryRedirectSignIn(e);(!o||o===a)&&c?.user&&(i=c.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{yield this.beforeStateQueue.runMiddleware(i)}catch(o){i=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return k(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)})}tryRedirectSignIn(e){return d(this,null,function*(){let n=null;try{n=yield this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{yield this._setRedirectUser(null)}return n})}reloadAndSetCurrentUserOrClear(e){return d(this,null,function*(){try{yield Tr(e)}catch(n){if(n?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)})}useDeviceLanguage(){this.languageCode=Ff()}_delete(){return d(this,null,function*(){this._deleted=!0})}updateCurrentUser(e){return d(this,null,function*(){if(yt(this.app))return Promise.reject(Ir(this));let n=e?xe(e):null;return n&&k(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))})}_updateCurrentUser(e,n=!1){return d(this,null,function*(){if(!this._deleted)return e&&k(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||(yield this.beforeStateQueue.runMiddleware(e)),this.queue(()=>d(this,null,function*(){yield this.directlySetCurrentUser(e),this.notifyAuthListeners()}))})}signOut(){return d(this,null,function*(){return yt(this.app)?Promise.reject(Ir(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(e){return yt(this.app)?Promise.reject(Ir(this)):this.queue(()=>d(this,null,function*(){yield this.assertedPersistence.setPersistence(Ye(e))}))}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(e){return d(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());let n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)})}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return d(this,null,function*(){let e=yield tp(this),n=new Ss(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Pe("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},n)}})}revokeAccessToken(e){return d(this,null,function*(){if(this.currentUser){let n=yield this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),yield Wf(this,r)}})}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}_setRedirectUser(e,n){return d(this,null,function*(){let r=yield this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)})}getOrInitRedirectPersistenceManager(e){return d(this,null,function*(){if(!this.redirectPersistenceManager){let n=e&&Ye(e)||this._popupRedirectResolver;k(n,this,"argument-error"),this.redirectPersistenceManager=yield Ar.create(this,[Ye(n._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(e){return d(this,null,function*(){var n,r;return this._isInitialized&&(yield this.queue(()=>d(this,null,function*(){}))),((n=this._currentUser)===null||n===void 0?void 0:n._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null})}_persistUserIfCurrent(e){return d(this,null,function*(){if(e===this.currentUser)return this.queue(()=>d(this,null,function*(){return this.directlySetCurrentUser(e)}))})}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let r=(n=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&n!==void 0?n:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,i){if(this._deleted)return()=>{};let s=typeof n=="function"?n:n.next.bind(n),o=!1,a=this._isInitialized?Promise.resolve():this._initializationPromise;if(k(a,this,"internal-error"),a.then(()=>{o||s(this.currentUser)}),typeof n=="function"){let c=e.addObserver(n,r,i);return()=>{o=!0,c()}}else{let c=e.addObserver(n);return()=>{o=!0,c()}}}directlySetCurrentUser(e){return d(this,null,function*(){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?yield this.assertedPersistence.setCurrentUser(e):yield this.assertedPersistence.removeCurrentUser()})}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return k(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=vu(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return d(this,null,function*(){var e;let n={"X-Client-Version":this.clientVersion};this.app.options.appId&&(n["X-Firebase-gmpid"]=this.app.options.appId);let r=yield(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader();r&&(n["X-Firebase-Client"]=r);let i=yield this._getAppCheckToken();return i&&(n["X-Firebase-AppCheck"]=i),n})}_getAppCheckToken(){return d(this,null,function*(){var e;let n=yield(e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken();return n?.error&&Vf(`Error while retrieving App Check token: ${n.error}`),n?.token})}};function rp(t){return xe(t)}var Sr=class{constructor(e){this.auth=e,this.observer=null,this.addObserver=$c(n=>this.observer=n)}get next(){return k(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};var ip={loadJS(){return d(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function sp(t){ip=t}function op(t){return`__${t}${Math.floor(Math.random()*1e6)}`}function ap(t,e){let n=e?.persistence||[],r=(Array.isArray(n)?n:[n]).map(Ye);e?.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e?.popupRedirectResolver)}var $y=op("rcb"),zy=new Je(3e4,6e4);var jy=new Je(2e3,1e4);var Gy=10*60*1e3;var Wy=new Je(3e4,6e4);var Ky=new Je(5e3,15e3);var Hy=encodeURIComponent("fac");var cu="@firebase/auth",uu="1.7.0";var Rs=class{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}getToken(e){return d(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(e)}:null})}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let n=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){k(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};function cp(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function up(t){Me(new ue("auth",(e,{options:n})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;k(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});let c={apiKey:o,authDomain:a,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:vu(t)},u=new bs(r,i,s,c);return ap(u,n),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),Me(new ue("auth-internal",e=>{let n=rp(e.getProvider("auth").getImmediate());return(r=>new Rs(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),W(cu,uu,cp(t)),W(cu,uu,"esm2017")}var lp=5*60,Qy=Vc("authIdTokenMaxAge")||lp;function hp(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}sp({loadJS(t){return new Promise((e,n)=>{let r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=i=>{let s=Ps("internal-error");s.customData=i,n(s)},r.type="text/javascript",r.charset="UTF-8",hp().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});up("Browser");var lm="auth";var Rr=class{constructor(){return rn(lm)}};var hm=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},fe={},_,Zs=Zs||{},w=hm||self;function qr(t){var e=typeof t;return e=e!="object"?e:t?Array.isArray(t)?"array":e:"null",e=="array"||e=="object"&&typeof t.length=="number"}function Sn(t){var e=typeof t;return e=="object"&&t!=null||e=="function"}function dm(t){return Object.prototype.hasOwnProperty.call(t,Ns)&&t[Ns]||(t[Ns]=++fm)}var Ns="closure_uid_"+(1e9*Math.random()>>>0),fm=0;function pm(t,e,n){return t.call.apply(t.bind,arguments)}function mm(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),t.apply(e,i)}}return function(){return t.apply(e,arguments)}}function te(t,e,n){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?te=pm:te=mm,te.apply(null,arguments)}function Pr(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var r=n.slice();return r.push.apply(r,arguments),t.apply(this,r)}}function H(t,e){function n(){}n.prototype=e.prototype,t.$=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.ac=function(r,i,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[i].apply(r,o)}}function Ue(){this.s=this.s,this.o=this.o}var gm=0;Ue.prototype.s=!1;Ue.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),gm!=0)&&dm(this)};Ue.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var Ou=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(typeof t=="string")return typeof e!="string"||e.length!=1?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1};function eo(t){let e=t.length;if(0<e){let n=Array(e);for(let r=0;r<e;r++)n[r]=t[r];return n}return[]}function Eu(t,e){for(let n=1;n<arguments.length;n++){let r=arguments[n];if(qr(r)){let i=t.length||0,s=r.length||0;t.length=i+s;for(let o=0;o<s;o++)t[i+o]=r[o]}else t.push(r)}}function ne(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}ne.prototype.h=function(){this.defaultPrevented=!0};var _m=function(){if(!w.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{let n=()=>{};w.addEventListener("test",n,e),w.removeEventListener("test",n,e)}catch{}return t}();function _n(t){return/^[\s\xa0]*$/.test(t)}function $r(){var t=w.navigator;return t&&(t=t.userAgent)?t:""}function ye(t){return $r().indexOf(t)!=-1}function to(t){return to[" "](t),t}to[" "]=function(){};function ym(t,e){var n=og;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}var Im=ye("Opera"),St=ye("Trident")||ye("MSIE"),xu=ye("Edge"),Ms=xu||St,Vu=ye("Gecko")&&!($r().toLowerCase().indexOf("webkit")!=-1&&!ye("Edge"))&&!(ye("Trident")||ye("MSIE"))&&!ye("Edge"),vm=$r().toLowerCase().indexOf("webkit")!=-1&&!ye("Edge");function Lu(){var t=w.document;return t?t.documentMode:void 0}var Fs;e:{if(Cr="",Dr=function(){var t=$r();if(Vu)return/rv:([^\);]+)(\)|;)/.exec(t);if(xu)return/Edge\/([\d\.]+)/.exec(t);if(St)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(t);if(vm)return/WebKit\/(\S+)/.exec(t);if(Im)return/(?:Version)[ \/]?(\S+)/.exec(t)}(),Dr&&(Cr=Dr?Dr[1]:""),St&&(kr=Lu(),kr!=null&&kr>parseFloat(Cr))){Fs=String(kr);break e}Fs=Cr}var Cr,Dr,kr,Us;w.document&&St?(Os=Lu(),Us=Os||parseInt(Fs,10)||void 0):Us=void 0;var Os,Em=Us;function yn(t,e){if(ne.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(Vu){e:{try{to(e.nodeName);var i=!0;break e}catch{}i=!1}i||(e=null)}}else n=="mouseover"?e=t.fromElement:n=="mouseout"&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=t.clientX!==void 0?t.clientX:t.pageX,this.clientY=t.clientY!==void 0?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=typeof t.pointerType=="string"?t.pointerType:wm[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&yn.$.h.call(this)}}H(yn,ne);var wm={2:"touch",3:"pen",4:"mouse"};yn.prototype.h=function(){yn.$.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var bn="closure_listenable_"+(1e6*Math.random()|0),Tm=0;function Am(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.la=i,this.key=++Tm,this.fa=this.ia=!1}function zr(t){t.fa=!0,t.listener=null,t.proxy=null,t.src=null,t.la=null}function no(t,e,n){for(let r in t)e.call(n,t[r],r,t)}function Sm(t,e){for(let n in t)e.call(void 0,t[n],n,t)}function Mu(t){let e={};for(let n in t)e[n]=t[n];return e}var wu="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Fu(t,e){let n,r;for(let i=1;i<arguments.length;i++){r=arguments[i];for(n in r)t[n]=r[n];for(let s=0;s<wu.length;s++)n=wu[s],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function jr(t){this.src=t,this.g={},this.h=0}jr.prototype.add=function(t,e,n,r,i){var s=t.toString();t=this.g[s],t||(t=this.g[s]=[],this.h++);var o=qs(t,e,r,i);return-1<o?(e=t[o],n||(e.ia=!1)):(e=new Am(e,this.src,s,!!r,i),e.ia=n,t.push(e)),e};function Bs(t,e){var n=e.type;if(n in t.g){var r=t.g[n],i=Ou(r,e),s;(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(zr(e),t.g[n].length==0&&(delete t.g[n],t.h--))}}function qs(t,e,n,r){for(var i=0;i<t.length;++i){var s=t[i];if(!s.fa&&s.listener==e&&s.capture==!!n&&s.la==r)return i}return-1}var ro="closure_lm_"+(1e6*Math.random()|0),xs={};function Uu(t,e,n,r,i){if(r&&r.once)return qu(t,e,n,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)Uu(t,e[s],n,r,i);return null}return n=oo(n),t&&t[bn]?t.O(e,n,Sn(r)?!!r.capture:!!r,i):Bu(t,e,n,!1,r,i)}function Bu(t,e,n,r,i,s){if(!e)throw Error("Invalid event type");var o=Sn(i)?!!i.capture:!!i,a=so(t);if(a||(t[ro]=a=new jr(t)),n=a.add(e,n,r,o,s),n.proxy)return n;if(r=bm(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)_m||(i=o),i===void 0&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(zu(e.toString()),r);else if(t.addListener&&t.removeListener)t.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return n}function bm(){function t(n){return e.call(t.src,t.listener,n)}let e=Rm;return t}function qu(t,e,n,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)qu(t,e[s],n,r,i);return null}return n=oo(n),t&&t[bn]?t.P(e,n,Sn(r)?!!r.capture:!!r,i):Bu(t,e,n,!0,r,i)}function $u(t,e,n,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)$u(t,e[s],n,r,i);else r=Sn(r)?!!r.capture:!!r,n=oo(n),t&&t[bn]?(t=t.i,e=String(e).toString(),e in t.g&&(s=t.g[e],n=qs(s,n,r,i),-1<n&&(zr(s[n]),Array.prototype.splice.call(s,n,1),s.length==0&&(delete t.g[e],t.h--)))):t&&(t=so(t))&&(e=t.g[e.toString()],t=-1,e&&(t=qs(e,n,r,i)),(n=-1<t?e[t]:null)&&io(n))}function io(t){if(typeof t!="number"&&t&&!t.fa){var e=t.src;if(e&&e[bn])Bs(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(zu(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=so(e))?(Bs(n,t),n.h==0&&(n.src=null,e[ro]=null)):zr(t)}}}function zu(t){return t in xs?xs[t]:xs[t]="on"+t}function Rm(t,e){if(t.fa)t=!0;else{e=new yn(e,this);var n=t.listener,r=t.la||t.src;t.ia&&io(t),t=n.call(r,e)}return t}function so(t){return t=t[ro],t instanceof jr?t:null}var Vs="__closure_events_fn_"+(1e9*Math.random()>>>0);function oo(t){return typeof t=="function"?t:(t[Vs]||(t[Vs]=function(e){return t.handleEvent(e)}),t[Vs])}function K(){Ue.call(this),this.i=new jr(this),this.S=this,this.J=null}H(K,Ue);K.prototype[bn]=!0;K.prototype.removeEventListener=function(t,e,n,r){$u(this,t,e,n,r)};function X(t,e){var n,r=t.J;if(r)for(n=[];r;r=r.J)n.push(r);if(t=t.S,r=e.type||e,typeof e=="string")e=new ne(e,t);else if(e instanceof ne)e.target=e.target||t;else{var i=e;e=new ne(r,t),Fu(e,i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=e.g=n[s];i=Nr(o,r,!0,e)&&i}if(o=e.g=t,i=Nr(o,r,!0,e)&&i,i=Nr(o,r,!1,e)&&i,n)for(s=0;s<n.length;s++)o=e.g=n[s],i=Nr(o,r,!1,e)&&i}K.prototype.N=function(){if(K.$.N.call(this),this.i){var t=this.i,e;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)zr(n[r]);delete t.g[e],t.h--}}this.J=null};K.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)};K.prototype.P=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};function Nr(t,e,n,r){if(e=t.i.g[String(e)],!e)return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==n){var a=o.listener,c=o.la||o.src;o.ia&&Bs(t.i,o),i=a.call(c,r)!==!1&&i}}return i&&!r.defaultPrevented}var ao=w.JSON.stringify,$s=class{constructor(e,n){this.i=e,this.j=n,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}};function Pm(){var t=co;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var zs=class{constructor(){this.h=this.g=null}add(e,n){let r=ju.get();r.set(e,n),this.h?this.h.next=r:this.g=r,this.h=r}},ju=new $s(()=>new js,t=>t.reset()),js=class{constructor(){this.next=this.g=this.h=null}set(e,n){this.h=e,this.g=n,this.next=null}reset(){this.next=this.g=this.h=null}};function Cm(t){var e=1;t=t.split(":");let n=[];for(;0<e&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function Dm(t){w.setTimeout(()=>{throw t},0)}var In,vn=!1,co=new zs,Gu=()=>{let t=w.Promise.resolve(void 0);In=()=>{t.then(km)}},km=()=>{for(var t;t=Pm();){try{t.h.call(t.g)}catch(n){Dm(n)}var e=ju;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}vn=!1};function Gr(t,e){K.call(this),this.h=t||1,this.g=e||w,this.j=te(this.qb,this),this.l=Date.now()}H(Gr,K);_=Gr.prototype;_.ga=!1;_.T=null;_.qb=function(){if(this.ga){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-t):(this.T&&(this.g.clearTimeout(this.T),this.T=null),X(this,"tick"),this.ga&&(uo(this),this.start()))}};_.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function uo(t){t.ga=!1,t.T&&(t.g.clearTimeout(t.T),t.T=null)}_.N=function(){Gr.$.N.call(this),uo(this),delete this.g};function lo(t,e,n){if(typeof t=="function")n&&(t=te(t,n));else if(t&&typeof t.handleEvent=="function")t=te(t.handleEvent,t);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:w.setTimeout(t,e||0)}function Wu(t){t.g=lo(()=>{t.g=null,t.i&&(t.i=!1,Wu(t))},t.j);let e=t.h;t.h=null,t.m.apply(null,e)}var Gs=class extends Ue{constructor(e,n){super(),this.m=e,this.j=n,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:Wu(this)}N(){super.N(),this.g&&(w.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}};function En(t){Ue.call(this),this.h=t,this.g={}}H(En,Ue);var Tu=[];function Ku(t,e,n,r){Array.isArray(n)||(n&&(Tu[0]=n.toString()),n=Tu);for(var i=0;i<n.length;i++){var s=Uu(e,n[i],r||t.handleEvent,!1,t.h||t);if(!s)break;t.g[s.key]=s}}function Hu(t){no(t.g,function(e,n){this.g.hasOwnProperty(n)&&io(e)},t),t.g={}}En.prototype.N=function(){En.$.N.call(this),Hu(this)};En.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function Wr(){this.g=!0}Wr.prototype.Ea=function(){this.g=!1};function Nm(t,e,n,r,i,s){t.info(function(){if(t.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var l=u[0];u=u[1];var h=l.split("_");o=2<=h.length&&h[1]=="type"?o+(l+"="+u+"&"):o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+`
`+n+`
`+o})}function Om(t,e,n,r,i,s,o){t.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+`
`+n+`
`+s+" "+o})}function Tt(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+Vm(t,n)+(r?" "+r:"")})}function xm(t,e){t.info(function(){return"TIMEOUT: "+e})}Wr.prototype.info=function(){};function Vm(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n){for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if(s!="noop"&&s!="stop"&&s!="close")for(var o=1;o<i.length;o++)i[o]=""}}}}return ao(n)}catch{return e}}var tt={},Au=null;function Kr(){return Au=Au||new K}tt.Ta="serverreachability";function Qu(t){ne.call(this,tt.Ta,t)}H(Qu,ne);function wn(t){let e=Kr();X(e,new Qu(e))}tt.STAT_EVENT="statevent";function Yu(t,e){ne.call(this,tt.STAT_EVENT,t),this.stat=e}H(Yu,ne);function se(t){let e=Kr();X(e,new Yu(e,t))}tt.Ua="timingevent";function Ju(t,e){ne.call(this,tt.Ua,t),this.size=e}H(Ju,ne);function Rn(t,e){if(typeof t!="function")throw Error("Fn must not be null and must be a function");return w.setTimeout(function(){t()},e)}var Hr={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Xu={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function ho(){}ho.prototype.h=null;function Su(t){return t.h||(t.h=t.i())}function Zu(){}var Pn={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function fo(){ne.call(this,"d")}H(fo,ne);function po(){ne.call(this,"c")}H(po,ne);var Ws;function Qr(){}H(Qr,ho);Qr.prototype.g=function(){return new XMLHttpRequest};Qr.prototype.i=function(){return{}};Ws=new Qr;function Cn(t,e,n,r){this.l=t,this.j=e,this.m=n,this.W=r||1,this.U=new En(this),this.P=Lm,t=Ms?125:void 0,this.V=new Gr(t),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new el}function el(){this.i=null,this.g="",this.h=!1}var Lm=45e3,tl={},Ks={};_=Cn.prototype;_.setTimeout=function(t){this.P=t};function Hs(t,e,n){t.L=1,t.A=Jr(De(e)),t.u=n,t.S=!0,nl(t,null)}function nl(t,e){t.G=Date.now(),Dn(t),t.B=De(t.A);var n=t.B,r=t.W;Array.isArray(r)||(r=[String(r)]),ll(n.i,"t",r),t.o=0,n=t.l.J,t.h=new el,t.g=kl(t.l,n?e:null,!t.u),0<t.O&&(t.M=new Gs(te(t.Pa,t,t.g),t.O)),Ku(t.U,t.g,"readystatechange",t.nb),e=t.I?Mu(t.I):{},t.u?(t.v||(t.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ha(t.B,t.v,t.u,e)):(t.v="GET",t.g.ha(t.B,t.v,null,e)),wn(),Nm(t.j,t.v,t.B,t.m,t.W,t.u)}_.nb=function(t){t=t.target;let e=this.M;e&&Ie(t)==3?e.l():this.Pa(t)};_.Pa=function(t){try{if(t==this.g)e:{let l=Ie(this.g);var e=this.g.Ia();let h=this.g.da();if(!(3>l)&&(l!=3||Ms||this.g&&(this.h.h||this.g.ja()||Cu(this.g)))){this.J||l!=4||e==7||(e==8||0>=h?wn(3):wn(2)),Yr(this);var n=this.g.da();this.ca=n;t:if(rl(this)){var r=Cu(this.g);t="";var i=r.length,s=Ie(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Xe(this),gn(this);var o="";break t}this.h.i=new w.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,t+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.length=0,this.h.g+=t,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=n==200,Om(this.j,this.v,this.B,this.m,this.W,l,n),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!_n(a)){var u=a;break t}}u=null}if(n=u)Tt(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Qs(this,n);else{this.i=!1,this.s=3,se(12),Xe(this),gn(this);break e}}this.S?(il(this,l,o),Ms&&this.i&&l==3&&(Ku(this.U,this.V,"tick",this.mb),this.V.start())):(Tt(this.j,this.m,o,null),Qs(this,o)),l==4&&Xe(this),this.i&&!this.J&&(l==4?Rl(this.l,this):(this.i=!1,Dn(this)))}else rg(this.g),n==400&&0<o.indexOf("Unknown SID")?(this.s=3,se(12)):(this.s=0,se(13)),Xe(this),gn(this)}}}catch{}finally{}};function rl(t){return t.g?t.v=="GET"&&t.L!=2&&t.l.Ha:!1}function il(t,e,n){let r=!0,i;for(;!t.J&&t.o<n.length;)if(i=Mm(t,n),i==Ks){e==4&&(t.s=4,se(14),r=!1),Tt(t.j,t.m,null,"[Incomplete Response]");break}else if(i==tl){t.s=4,se(15),Tt(t.j,t.m,n,"[Invalid Chunk]"),r=!1;break}else Tt(t.j,t.m,i,null),Qs(t,i);rl(t)&&t.o!=0&&(t.h.g=t.h.g.slice(t.o),t.o=0),e!=4||n.length!=0||t.h.h||(t.s=1,se(16),r=!1),t.i=t.i&&r,r?0<n.length&&!t.ba&&(t.ba=!0,e=t.l,e.g==t&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),vo(e),e.M=!0,se(11))):(Tt(t.j,t.m,n,"[Invalid Chunked Response]"),Xe(t),gn(t))}_.mb=function(){if(this.g){var t=Ie(this.g),e=this.g.ja();this.o<e.length&&(Yr(this),il(this,t,e),this.i&&t!=4&&Dn(this))}};function Mm(t,e){var n=t.o,r=e.indexOf(`
`,n);return r==-1?Ks:(n=Number(e.substring(n,r)),isNaN(n)?tl:(r+=1,r+n>e.length?Ks:(e=e.slice(r,r+n),t.o=r+n,e)))}_.cancel=function(){this.J=!0,Xe(this)};function Dn(t){t.Y=Date.now()+t.P,sl(t,t.P)}function sl(t,e){if(t.C!=null)throw Error("WatchDog timer not null");t.C=Rn(te(t.lb,t),e)}function Yr(t){t.C&&(w.clearTimeout(t.C),t.C=null)}_.lb=function(){this.C=null;let t=Date.now();0<=t-this.Y?(xm(this.j,this.B),this.L!=2&&(wn(),se(17)),Xe(this),this.s=2,gn(this)):sl(this,this.Y-t)};function gn(t){t.l.H==0||t.J||Rl(t.l,t)}function Xe(t){Yr(t);var e=t.M;e&&typeof e.sa=="function"&&e.sa(),t.M=null,uo(t.V),Hu(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.sa())}function Qs(t,e){try{var n=t.l;if(n.H!=0&&(n.g==t||Ys(n.i,t))){if(!t.K&&Ys(n.i,t)&&n.H==3){try{var r=n.Ja.g.parse(e)}catch{r=null}if(Array.isArray(r)&&r.length==3){var i=r;if(i[0]==0){e:if(!n.u){if(n.g)if(n.g.G+3e3<t.G)Mr(n),ei(n);else break e;Io(n),se(18)}}else n.Fa=i[1],0<n.Fa-n.V&&37500>i[2]&&n.G&&n.A==0&&!n.v&&(n.v=Rn(te(n.ib,n),6e3));if(1>=fl(n.i)&&n.oa){try{n.oa()}catch{}n.oa=void 0}}else Ze(n,11)}else if((t.K||n.g==t)&&Mr(n),!_n(e))for(i=n.Ja.g.parse(e),e=0;e<i.length;e++){let u=i[e];if(n.V=u[0],u=u[1],n.H==2)if(u[0]=="c"){n.K=u[1],n.pa=u[2];let l=u[3];l!=null&&(n.ra=l,n.l.info("VER="+n.ra));let h=u[4];h!=null&&(n.Ga=h,n.l.info("SVER="+n.Ga));let f=u[5];f!=null&&typeof f=="number"&&0<f&&(r=1.5*f,n.L=r,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;let m=t.g;if(m){let P=m.g?m.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(P){var s=r.i;s.g||P.indexOf("spdy")==-1&&P.indexOf("quic")==-1&&P.indexOf("h2")==-1||(s.j=s.l,s.g=new Set,s.h&&(mo(s,s.h),s.h=null))}if(r.F){let b=m.g?m.g.getResponseHeader("X-HTTP-Session-Id"):null;b&&(r.Da=b,x(r.I,r.F,b))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-t.G,n.l.info("Handshake RTT: "+n.S+"ms")),r=n;var o=t;if(r.wa=Dl(r,r.J?r.pa:null,r.Y),o.K){pl(r.i,o);var a=o,c=r.L;c&&a.setTimeout(c),a.C&&(Yr(a),Dn(a)),r.g=o}else Sl(r);0<n.j.length&&ti(n)}else u[0]!="stop"&&u[0]!="close"||Ze(n,7);else n.H==3&&(u[0]=="stop"||u[0]=="close"?u[0]=="stop"?Ze(n,7):yo(n):u[0]!="noop"&&n.h&&n.h.Aa(u),n.A=0)}}wn(4)}catch{}}function Fm(t){if(t.Z&&typeof t.Z=="function")return t.Z();if(typeof Map<"u"&&t instanceof Map||typeof Set<"u"&&t instanceof Set)return Array.from(t.values());if(typeof t=="string")return t.split("");if(qr(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}e=[],n=0;for(r in t)e[n++]=t[r];return e}function Um(t){if(t.ta&&typeof t.ta=="function")return t.ta();if(!t.Z||typeof t.Z!="function"){if(typeof Map<"u"&&t instanceof Map)return Array.from(t.keys());if(!(typeof Set<"u"&&t instanceof Set)){if(qr(t)||typeof t=="string"){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(let r in t)e[n++]=r;return e}}}function ol(t,e){if(t.forEach&&typeof t.forEach=="function")t.forEach(e,void 0);else if(qr(t)||typeof t=="string")Array.prototype.forEach.call(t,e,void 0);else for(var n=Um(t),r=Fm(t),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],n&&n[s],t)}var al=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Bm(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var s=t[n].substring(0,r);i=t[n].substring(r+1)}else s=t[n];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function et(t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof et){this.h=t.h,Vr(this,t.j),this.s=t.s,this.g=t.g,Lr(this,t.m),this.l=t.l;var e=t.i,n=new Tn;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),bu(this,n),this.o=t.o}else t&&(e=String(t).match(al))?(this.h=!1,Vr(this,e[1]||"",!0),this.s=pn(e[2]||""),this.g=pn(e[3]||"",!0),Lr(this,e[4]),this.l=pn(e[5]||"",!0),bu(this,e[6]||"",!0),this.o=pn(e[7]||"")):(this.h=!1,this.i=new Tn(null,this.h))}et.prototype.toString=function(){var t=[],e=this.j;e&&t.push(mn(e,Ru,!0),":");var n=this.g;return(n||e=="file")&&(t.push("//"),(e=this.s)&&t.push(mn(e,Ru,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n=this.m,n!=null&&t.push(":",String(n))),(n=this.l)&&(this.g&&n.charAt(0)!="/"&&t.push("/"),t.push(mn(n,n.charAt(0)=="/"?zm:$m,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.o)&&t.push("#",mn(n,Gm)),t.join("")};function De(t){return new et(t)}function Vr(t,e,n){t.j=n?pn(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function Lr(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function bu(t,e,n){e instanceof Tn?(t.i=e,Wm(t.i,t.h)):(n||(e=mn(e,jm)),t.i=new Tn(e,t.h))}function x(t,e,n){t.i.set(e,n)}function Jr(t){return x(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function pn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function mn(t,e,n){return typeof t=="string"?(t=encodeURI(t).replace(e,qm),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function qm(t){return t=t.charCodeAt(0),"%"+(t>>4&15).toString(16)+(t&15).toString(16)}var Ru=/[#\/\?@]/g,$m=/[#\?:]/g,zm=/[#\?]/g,jm=/[#\?@]/g,Gm=/#/g;function Tn(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Be(t){t.g||(t.g=new Map,t.h=0,t.i&&Bm(t.i,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}_=Tn.prototype;_.add=function(t,e){Be(this),this.i=null,t=bt(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this};function cl(t,e){Be(t),e=bt(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function ul(t,e){return Be(t),e=bt(t,e),t.g.has(e)}_.forEach=function(t,e){Be(this),this.g.forEach(function(n,r){n.forEach(function(i){t.call(e,i,r,this)},this)},this)};_.ta=function(){Be(this);let t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let r=0;r<e.length;r++){let i=t[r];for(let s=0;s<i.length;s++)n.push(e[r])}return n};_.Z=function(t){Be(this);let e=[];if(typeof t=="string")ul(this,t)&&(e=e.concat(this.g.get(bt(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e};_.set=function(t,e){return Be(this),this.i=null,t=bt(this,t),ul(this,t)&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this};_.get=function(t,e){return t?(t=this.Z(t),0<t.length?String(t[0]):e):e};function ll(t,e,n){cl(t,e),0<n.length&&(t.i=null,t.g.set(bt(t,e),eo(n)),t.h+=n.length)}_.toString=function(){if(this.i)return this.i;if(!this.g)return"";let t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var r=e[n];let s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;o[r]!==""&&(i+="="+encodeURIComponent(String(o[r]))),t.push(i)}}return this.i=t.join("&")};function bt(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function Wm(t,e){e&&!t.j&&(Be(t),t.i=null,t.g.forEach(function(n,r){var i=r.toLowerCase();r!=i&&(cl(this,r),ll(this,i,n))},t)),t.j=e}var Km=class{constructor(t,e){this.g=t,this.map=e}};function hl(t){this.l=t||Hm,w.PerformanceNavigationTiming?(t=w.performance.getEntriesByType("navigation"),t=0<t.length&&(t[0].nextHopProtocol=="hq"||t[0].nextHopProtocol=="h2")):t=!!(w.g&&w.g.Ka&&w.g.Ka()&&w.g.Ka().dc),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Hm=10;function dl(t){return t.h?!0:t.g?t.g.size>=t.j:!1}function fl(t){return t.h?1:t.g?t.g.size:0}function Ys(t,e){return t.h?t.h==e:t.g?t.g.has(e):!1}function mo(t,e){t.g?t.g.add(e):t.h=e}function pl(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}hl.prototype.cancel=function(){if(this.i=ml(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let t of this.g.values())t.cancel();this.g.clear()}};function ml(t){if(t.h!=null)return t.i.concat(t.h.F);if(t.g!=null&&t.g.size!==0){let e=t.i;for(let n of t.g.values())e=e.concat(n.F);return e}return eo(t.i)}var Qm=class{stringify(t){return w.JSON.stringify(t,void 0)}parse(t){return w.JSON.parse(t,void 0)}};function Ym(){this.g=new Qm}function Jm(t,e,n){let r=n||"";try{ol(t,function(i,s){let o=i;Sn(i)&&(o=ao(i)),e.push(r+s+"="+encodeURIComponent(o))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function Xm(t,e){let n=new Wr;if(w.Image){let r=new Image;r.onload=Pr(Or,n,r,"TestLoadImage: loaded",!0,e),r.onerror=Pr(Or,n,r,"TestLoadImage: error",!1,e),r.onabort=Pr(Or,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=Pr(Or,n,r,"TestLoadImage: timeout",!1,e),w.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}function Or(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch{}}function kn(t){this.l=t.ec||null,this.j=t.ob||!1}H(kn,ho);kn.prototype.g=function(){return new Xr(this.l,this.j)};kn.prototype.i=function(t){return function(){return t}}({});function Xr(t,e){K.call(this),this.F=t,this.u=e,this.m=void 0,this.readyState=go,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}H(Xr,K);var go=0;_=Xr.prototype;_.open=function(t,e){if(this.readyState!=go)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,An(this)};_.send=function(t){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.F||w).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))};_.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Nn(this)),this.readyState=go};_.$a=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,An(this)),this.g&&(this.readyState=3,An(this),this.g)))if(this.responseType==="arraybuffer")t.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof w.ReadableStream<"u"&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;gl(this)}else t.text().then(this.Za.bind(this),this.ka.bind(this))};function gl(t){t.j.read().then(t.Xa.bind(t)).catch(t.ka.bind(t))}_.Xa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?Nn(this):An(this),this.readyState==3&&gl(this)}};_.Za=function(t){this.g&&(this.response=this.responseText=t,Nn(this))};_.Ya=function(t){this.g&&(this.response=t,Nn(this))};_.ka=function(){this.g&&Nn(this)};function Nn(t){t.readyState=4,t.l=null,t.j=null,t.A=null,An(t)}_.setRequestHeader=function(t,e){this.v.append(t,e)};_.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""};_.getAllResponseHeaders=function(){if(!this.h)return"";let t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join(`\r
`)};function An(t){t.onreadystatechange&&t.onreadystatechange.call(t)}Object.defineProperty(Xr.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(t){this.m=t?"include":"same-origin"}});var Zm=w.JSON.parse;function L(t){K.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=_l,this.L=this.M=!1}H(L,K);var _l="",eg=/^https?$/i,tg=["POST","PUT"];_=L.prototype;_.Oa=function(t){this.M=t};_.ha=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+t);e=e?e.toUpperCase():"GET",this.I=t,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():Ws.g(),this.C=this.u?Su(this.u):Su(Ws),this.g.onreadystatechange=te(this.La,this);try{this.G=!0,this.g.open(e,String(t),!0),this.G=!1}catch(s){Pu(this,s);return}if(t=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else if(typeof r.keys=="function"&&typeof r.get=="function")for(let s of r.keys())n.set(s,r.get(s));else throw Error("Unknown input type for opt_headers: "+String(r));r=Array.from(n.keys()).find(s=>s.toLowerCase()=="content-type"),i=w.FormData&&t instanceof w.FormData,!(0<=Ou(tg,e))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[s,o]of n)this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{vl(this),0<this.B&&((this.L=ng(this.g))?(this.g.timeout=this.B,this.g.ontimeout=te(this.ua,this)):this.A=lo(this.ua,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(s){Pu(this,s)}};function ng(t){return St&&typeof t.timeout=="number"&&t.ontimeout!==void 0}_.ua=function(){typeof Zs<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,X(this,"timeout"),this.abort(8))};function Pu(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,yl(t),Zr(t)}function yl(t){t.F||(t.F=!0,X(t,"complete"),X(t,"error"))}_.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,X(this,"complete"),X(this,"abort"),Zr(this))};_.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Zr(this,!0)),L.$.N.call(this)};_.La=function(){this.s||(this.G||this.v||this.l?Il(this):this.kb())};_.kb=function(){Il(this)};function Il(t){if(t.h&&typeof Zs<"u"&&(!t.C[1]||Ie(t)!=4||t.da()!=2)){if(t.v&&Ie(t)==4)lo(t.La,0,t);else if(X(t,"readystatechange"),Ie(t)==4){t.h=!1;try{let o=t.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var n;if(!(n=e)){var r;if(r=o===0){var i=String(t.I).match(al)[1]||null;!i&&w.self&&w.self.location&&(i=w.self.location.protocol.slice(0,-1)),r=!eg.test(i?i.toLowerCase():"")}n=r}if(n)X(t,"complete"),X(t,"success");else{t.m=6;try{var s=2<Ie(t)?t.g.statusText:""}catch{s=""}t.j=s+" ["+t.da()+"]",yl(t)}}finally{Zr(t)}}}}function Zr(t,e){if(t.g){vl(t);let n=t.g,r=t.C[0]?()=>{}:null;t.g=null,t.C=null,e||X(t,"ready");try{n.onreadystatechange=r}catch{}}}function vl(t){t.g&&t.L&&(t.g.ontimeout=null),t.A&&(w.clearTimeout(t.A),t.A=null)}_.isActive=function(){return!!this.g};function Ie(t){return t.g?t.g.readyState:0}_.da=function(){try{return 2<Ie(this)?this.g.status:-1}catch{return-1}};_.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};_.Wa=function(t){if(this.g){var e=this.g.responseText;return t&&e.indexOf(t)==0&&(e=e.substring(t.length)),Zm(e)}};function Cu(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.K){case _l:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch{return null}}function rg(t){let e={};t=(t.g&&2<=Ie(t)&&t.g.getAllResponseHeaders()||"").split(`\r
`);for(let r=0;r<t.length;r++){if(_n(t[r]))continue;var n=Cm(t[r]);let i=n[0];if(n=n[1],typeof n!="string")continue;n=n.trim();let s=e[i]||[];e[i]=s,s.push(n)}Sm(e,function(r){return r.join(", ")})}_.Ia=function(){return this.m};_.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function El(t){let e="";return no(t,function(n,r){e+=r,e+=":",e+=n,e+=`\r
`}),e}function _o(t,e,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=El(n),typeof t=="string"?n!=null&&encodeURIComponent(String(n)):x(t,e,n))}function dn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function wl(t){this.Ga=0,this.j=[],this.l=new Wr,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=dn("failFast",!1,t),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=dn("baseRetryDelayMs",5e3,t),this.hb=dn("retryDelaySeedMs",1e4,t),this.eb=dn("forwardChannelMaxRetries",2,t),this.xa=dn("forwardChannelRequestTimeoutMs",2e4,t),this.va=t&&t.xmlHttpFactory||void 0,this.Ha=t&&t.useFetchStreams||!1,this.L=void 0,this.J=t&&t.supportsCrossDomainXhr||!1,this.K="",this.i=new hl(t&&t.concurrentRequestLimit),this.Ja=new Ym,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=t&&t.bc||!1,t&&t.Ea&&this.l.Ea(),t&&t.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&t&&t.detectBufferingProxy||!1,this.qa=void 0,t&&t.longPollingTimeout&&0<t.longPollingTimeout&&(this.qa=t.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}_=wl.prototype;_.ra=8;_.H=1;function yo(t){if(Tl(t),t.H==3){var e=t.W++,n=De(t.I);if(x(n,"SID",t.K),x(n,"RID",e),x(n,"TYPE","terminate"),On(t,n),e=new Cn(t,t.l,e),e.L=2,e.A=Jr(De(n)),n=!1,w.navigator&&w.navigator.sendBeacon)try{n=w.navigator.sendBeacon(e.A.toString(),"")}catch{}!n&&w.Image&&(new Image().src=e.A,n=!0),n||(e.g=kl(e.l,null),e.g.ha(e.A)),e.G=Date.now(),Dn(e)}Cl(t)}function ei(t){t.g&&(vo(t),t.g.cancel(),t.g=null)}function Tl(t){ei(t),t.u&&(w.clearTimeout(t.u),t.u=null),Mr(t),t.i.cancel(),t.m&&(typeof t.m=="number"&&w.clearTimeout(t.m),t.m=null)}function ti(t){if(!dl(t.i)&&!t.m){t.m=!0;var e=t.Na;In||Gu(),vn||(In(),vn=!0),co.add(e,t),t.C=0}}function ig(t,e){return fl(t.i)>=t.i.j-(t.m?1:0)?!1:t.m?(t.j=e.F.concat(t.j),!0):t.H==1||t.H==2||t.C>=(t.cb?0:t.eb)?!1:(t.m=Rn(te(t.Na,t,e),Pl(t,t.C)),t.C++,!0)}_.Na=function(t){if(this.m)if(this.m=null,this.H==1){if(!t){this.W=Math.floor(1e5*Math.random()),t=this.W++;let i=new Cn(this,this.l,t),s=this.s;if(this.U&&(s?(s=Mu(s),Fu(s,this.U)):s=this.U),this.o!==null||this.O||(i.I=s,s=null),this.P)e:{for(var e=0,n=0;n<this.j.length;n++){t:{var r=this.j[n];if("__data__"in r.map&&(r=r.map.__data__,typeof r=="string")){r=r.length;break t}r=void 0}if(r===void 0)break;if(e+=r,4096<e){e=n;break e}if(e===4096||n===this.j.length-1){e=n+1;break e}}e=1e3}else e=1e3;e=Al(this,i,e),n=De(this.I),x(n,"RID",t),x(n,"CVER",22),this.F&&x(n,"X-HTTP-Session-Id",this.F),On(this,n),s&&(this.O?e="headers="+encodeURIComponent(String(El(s)))+"&"+e:this.o&&_o(n,this.o,s)),mo(this.i,i),this.bb&&x(n,"TYPE","init"),this.P?(x(n,"$req",e),x(n,"SID","null"),i.aa=!0,Hs(i,n,null)):Hs(i,n,e),this.H=2}}else this.H==3&&(t?Du(this,t):this.j.length==0||dl(this.i)||Du(this))};function Du(t,e){var n;e?n=e.m:n=t.W++;let r=De(t.I);x(r,"SID",t.K),x(r,"RID",n),x(r,"AID",t.V),On(t,r),t.o&&t.s&&_o(r,t.o,t.s),n=new Cn(t,t.l,n,t.C+1),t.o===null&&(n.I=t.s),e&&(t.j=e.F.concat(t.j)),e=Al(t,n,1e3),n.setTimeout(Math.round(.5*t.xa)+Math.round(.5*t.xa*Math.random())),mo(t.i,n),Hs(n,r,e)}function On(t,e){t.na&&no(t.na,function(n,r){x(e,r,n)}),t.h&&ol({},function(n,r){x(e,r,n)})}function Al(t,e,n){n=Math.min(t.j.length,n);var r=t.h?te(t.h.Va,t.h,t):null;e:{var i=t.j;let s=-1;for(;;){let o=["count="+n];s==-1?0<n?(s=i[0].g,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let c=0;c<n;c++){let u=i[c].g,l=i[c].map;if(u-=s,0>u)s=Math.max(0,i[c].g-100),a=!1;else try{Jm(l,o,"req"+u+"_")}catch{r&&r(l)}}if(a){r=o.join("&");break e}}}return t=t.j.splice(0,n),e.F=t,r}function Sl(t){if(!t.g&&!t.u){t.ba=1;var e=t.Ma;In||Gu(),vn||(In(),vn=!0),co.add(e,t),t.A=0}}function Io(t){return t.g||t.u||3<=t.A?!1:(t.ba++,t.u=Rn(te(t.Ma,t),Pl(t,t.A)),t.A++,!0)}_.Ma=function(){if(this.u=null,bl(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var t=2*this.S;this.l.info("BP detection timer enabled: "+t),this.B=Rn(te(this.jb,this),t)}};_.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,se(10),ei(this),bl(this))};function vo(t){t.B!=null&&(w.clearTimeout(t.B),t.B=null)}function bl(t){t.g=new Cn(t,t.l,"rpc",t.ba),t.o===null&&(t.g.I=t.s),t.g.O=0;var e=De(t.wa);x(e,"RID","rpc"),x(e,"SID",t.K),x(e,"AID",t.V),x(e,"CI",t.G?"0":"1"),!t.G&&t.qa&&x(e,"TO",t.qa),x(e,"TYPE","xmlhttp"),On(t,e),t.o&&t.s&&_o(e,t.o,t.s),t.L&&t.g.setTimeout(t.L);var n=t.g;t=t.pa,n.L=1,n.A=Jr(De(e)),n.u=null,n.S=!0,nl(n,t)}_.ib=function(){this.v!=null&&(this.v=null,ei(this),Io(this),se(19))};function Mr(t){t.v!=null&&(w.clearTimeout(t.v),t.v=null)}function Rl(t,e){var n=null;if(t.g==e){Mr(t),vo(t),t.g=null;var r=2}else if(Ys(t.i,e))n=e.F,pl(t.i,e),r=1;else return;if(t.H!=0){if(e.i)if(r==1){n=e.u?e.u.length:0,e=Date.now()-e.G;var i=t.C;r=Kr(),X(r,new Ju(r,n)),ti(t)}else Sl(t);else if(i=e.s,i==3||i==0&&0<e.ca||!(r==1&&ig(t,e)||r==2&&Io(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),i){case 1:Ze(t,5);break;case 4:Ze(t,10);break;case 3:Ze(t,6);break;default:Ze(t,2)}}}function Pl(t,e){let n=t.ab+Math.floor(Math.random()*t.hb);return t.isActive()||(n*=2),n*e}function Ze(t,e){if(t.l.info("Error code "+e),e==2){var n=null;t.h&&(n=null);var r=te(t.pb,t);n||(n=new et("//www.google.com/images/cleardot.gif"),w.location&&w.location.protocol=="http"||Vr(n,"https"),Jr(n)),Xm(n.toString(),r)}else se(2);t.H=0,t.h&&t.h.za(e),Cl(t),Tl(t)}_.pb=function(t){t?(this.l.info("Successfully pinged google.com"),se(2)):(this.l.info("Failed to ping google.com"),se(1))};function Cl(t){if(t.H=0,t.ma=[],t.h){let e=ml(t.i);(e.length!=0||t.j.length!=0)&&(Eu(t.ma,e),Eu(t.ma,t.j),t.i.i.length=0,eo(t.j),t.j.length=0),t.h.ya()}}function Dl(t,e,n){var r=n instanceof et?De(n):new et(n);if(r.g!="")e&&(r.g=e+"."+r.g),Lr(r,r.m);else{var i=w.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new et(null);r&&Vr(s,r),e&&(s.g=e),i&&Lr(s,i),n&&(s.l=n),r=s}return n=t.F,e=t.Da,n&&e&&x(r,n,e),x(r,"VER",t.ra),On(t,r),r}function kl(t,e,n){if(e&&!t.J)throw Error("Can't create secondary domain capable XhrIo object.");return e=t.Ha&&!t.va?new L(new kn({ob:n})):new L(t.va),e.Oa(t.J),e}_.isActive=function(){return!!this.h&&this.h.isActive(this)};function Nl(){}_=Nl.prototype;_.Ba=function(){};_.Aa=function(){};_.za=function(){};_.ya=function(){};_.isActive=function(){return!0};_.Va=function(){};function Fr(){if(St&&!(10<=Number(Em)))throw Error("Environmental error: no available transport.")}Fr.prototype.g=function(t,e){return new ae(t,e)};function ae(t,e){K.call(this),this.g=new wl(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(t?t["X-WebChannel-Client-Profile"]=e.Ca:t={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=t,(t=e&&e.cc)&&!_n(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!_n(e)&&(this.g.F=e,t=this.h,t!==null&&e in t&&(t=this.h,e in t&&delete t[e])),this.j=new Rt(this)}H(ae,K);ae.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var t=this.g,e=this.l,n=this.h||void 0;se(0),t.Y=e,t.na=n||{},t.G=t.aa,t.I=Dl(t,null,t.Y),ti(t)};ae.prototype.close=function(){yo(this.g)};ae.prototype.u=function(t){var e=this.g;if(typeof t=="string"){var n={};n.__data__=t,t=n}else this.v&&(n={},n.__data__=ao(t),t=n);e.j.push(new Km(e.fb++,t)),e.H==3&&ti(e)};ae.prototype.N=function(){this.g.h=null,delete this.j,yo(this.g),delete this.g,ae.$.N.call(this)};function Ol(t){fo.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){e:{for(let n in e){t=n;break e}t=void 0}(this.i=t)&&(t=this.i,e=e!==null&&t in e?e[t]:void 0),this.data=e}else this.data=t}H(Ol,fo);function xl(){po.call(this),this.status=1}H(xl,po);function Rt(t){this.g=t}H(Rt,Nl);Rt.prototype.Ba=function(){X(this.g,"a")};Rt.prototype.Aa=function(t){X(this.g,new Ol(t))};Rt.prototype.za=function(t){X(this.g,new xl)};Rt.prototype.ya=function(){X(this.g,"b")};function sg(){this.blockSize=-1}function de(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}H(de,sg);de.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function Ls(t,e,n){n||(n=0);var r=Array(16);if(typeof e=="string")for(var i=0;16>i;++i)r[i]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],i=t.g[2];var s=t.g[3],o=e+(s^n&(i^s))+r[0]+3614090360&4294967295;e=n+(o<<7&4294967295|o>>>25),o=s+(i^e&(n^i))+r[1]+3905402710&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(n^s&(e^n))+r[2]+606105819&4294967295,i=s+(o<<17&4294967295|o>>>15),o=n+(e^i&(s^e))+r[3]+3250441966&4294967295,n=i+(o<<22&4294967295|o>>>10),o=e+(s^n&(i^s))+r[4]+4118548399&4294967295,e=n+(o<<7&4294967295|o>>>25),o=s+(i^e&(n^i))+r[5]+1200080426&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(n^s&(e^n))+r[6]+2821735955&4294967295,i=s+(o<<17&4294967295|o>>>15),o=n+(e^i&(s^e))+r[7]+4249261313&4294967295,n=i+(o<<22&4294967295|o>>>10),o=e+(s^n&(i^s))+r[8]+1770035416&4294967295,e=n+(o<<7&4294967295|o>>>25),o=s+(i^e&(n^i))+r[9]+2336552879&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(n^s&(e^n))+r[10]+4294925233&4294967295,i=s+(o<<17&4294967295|o>>>15),o=n+(e^i&(s^e))+r[11]+2304563134&4294967295,n=i+(o<<22&4294967295|o>>>10),o=e+(s^n&(i^s))+r[12]+1804603682&4294967295,e=n+(o<<7&4294967295|o>>>25),o=s+(i^e&(n^i))+r[13]+4254626195&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(n^s&(e^n))+r[14]+2792965006&4294967295,i=s+(o<<17&4294967295|o>>>15),o=n+(e^i&(s^e))+r[15]+1236535329&4294967295,n=i+(o<<22&4294967295|o>>>10),o=e+(i^s&(n^i))+r[1]+4129170786&4294967295,e=n+(o<<5&4294967295|o>>>27),o=s+(n^i&(e^n))+r[6]+3225465664&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^n&(s^e))+r[11]+643717713&4294967295,i=s+(o<<14&4294967295|o>>>18),o=n+(s^e&(i^s))+r[0]+3921069994&4294967295,n=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(n^i))+r[5]+3593408605&4294967295,e=n+(o<<5&4294967295|o>>>27),o=s+(n^i&(e^n))+r[10]+38016083&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^n&(s^e))+r[15]+3634488961&4294967295,i=s+(o<<14&4294967295|o>>>18),o=n+(s^e&(i^s))+r[4]+3889429448&4294967295,n=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(n^i))+r[9]+568446438&4294967295,e=n+(o<<5&4294967295|o>>>27),o=s+(n^i&(e^n))+r[14]+3275163606&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^n&(s^e))+r[3]+4107603335&4294967295,i=s+(o<<14&4294967295|o>>>18),o=n+(s^e&(i^s))+r[8]+1163531501&4294967295,n=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(n^i))+r[13]+2850285829&4294967295,e=n+(o<<5&4294967295|o>>>27),o=s+(n^i&(e^n))+r[2]+4243563512&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^n&(s^e))+r[7]+1735328473&4294967295,i=s+(o<<14&4294967295|o>>>18),o=n+(s^e&(i^s))+r[12]+2368359562&4294967295,n=i+(o<<20&4294967295|o>>>12),o=e+(n^i^s)+r[5]+4294588738&4294967295,e=n+(o<<4&4294967295|o>>>28),o=s+(e^n^i)+r[8]+2272392833&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^n)+r[11]+1839030562&4294967295,i=s+(o<<16&4294967295|o>>>16),o=n+(i^s^e)+r[14]+4259657740&4294967295,n=i+(o<<23&4294967295|o>>>9),o=e+(n^i^s)+r[1]+2763975236&4294967295,e=n+(o<<4&4294967295|o>>>28),o=s+(e^n^i)+r[4]+1272893353&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^n)+r[7]+4139469664&4294967295,i=s+(o<<16&4294967295|o>>>16),o=n+(i^s^e)+r[10]+3200236656&4294967295,n=i+(o<<23&4294967295|o>>>9),o=e+(n^i^s)+r[13]+681279174&4294967295,e=n+(o<<4&4294967295|o>>>28),o=s+(e^n^i)+r[0]+3936430074&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^n)+r[3]+3572445317&4294967295,i=s+(o<<16&4294967295|o>>>16),o=n+(i^s^e)+r[6]+76029189&4294967295,n=i+(o<<23&4294967295|o>>>9),o=e+(n^i^s)+r[9]+3654602809&4294967295,e=n+(o<<4&4294967295|o>>>28),o=s+(e^n^i)+r[12]+3873151461&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^n)+r[15]+530742520&4294967295,i=s+(o<<16&4294967295|o>>>16),o=n+(i^s^e)+r[2]+3299628645&4294967295,n=i+(o<<23&4294967295|o>>>9),o=e+(i^(n|~s))+r[0]+4096336452&4294967295,e=n+(o<<6&4294967295|o>>>26),o=s+(n^(e|~i))+r[7]+1126891415&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~n))+r[14]+2878612391&4294967295,i=s+(o<<15&4294967295|o>>>17),o=n+(s^(i|~e))+r[5]+4237533241&4294967295,n=i+(o<<21&4294967295|o>>>11),o=e+(i^(n|~s))+r[12]+1700485571&4294967295,e=n+(o<<6&4294967295|o>>>26),o=s+(n^(e|~i))+r[3]+2399980690&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~n))+r[10]+4293915773&4294967295,i=s+(o<<15&4294967295|o>>>17),o=n+(s^(i|~e))+r[1]+2240044497&4294967295,n=i+(o<<21&4294967295|o>>>11),o=e+(i^(n|~s))+r[8]+1873313359&4294967295,e=n+(o<<6&4294967295|o>>>26),o=s+(n^(e|~i))+r[15]+4264355552&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~n))+r[6]+2734768916&4294967295,i=s+(o<<15&4294967295|o>>>17),o=n+(s^(i|~e))+r[13]+1309151649&4294967295,n=i+(o<<21&4294967295|o>>>11),o=e+(i^(n|~s))+r[4]+4149444226&4294967295,e=n+(o<<6&4294967295|o>>>26),o=s+(n^(e|~i))+r[11]+3174756917&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~n))+r[2]+718787259&4294967295,i=s+(o<<15&4294967295|o>>>17),o=n+(s^(i|~e))+r[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,t.g[2]=t.g[2]+i&4294967295,t.g[3]=t.g[3]+s&4294967295}de.prototype.j=function(t,e){e===void 0&&(e=t.length);for(var n=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(i==0)for(;s<=n;)Ls(this,t,s),s+=this.blockSize;if(typeof t=="string"){for(;s<e;)if(r[i++]=t.charCodeAt(s++),i==this.blockSize){Ls(this,r),i=0;break}}else for(;s<e;)if(r[i++]=t[s++],i==this.blockSize){Ls(this,r),i=0;break}}this.h=i,this.i+=e};de.prototype.l=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var n=8*this.i;for(e=t.length-8;e<t.length;++e)t[e]=n&255,n/=256;for(this.j(t),t=Array(16),e=n=0;4>e;++e)for(var r=0;32>r;r+=8)t[n++]=this.g[e]>>>r&255;return t};function O(t,e){this.h=e;for(var n=[],r=!0,i=t.length-1;0<=i;i--){var s=t[i]|0;r&&s==e||(n[i]=s,r=!1)}this.g=n}var og={};function Eo(t){return-128<=t&&128>t?ym(t,function(e){return new O([e|0],0>e?-1:0)}):new O([t|0],0>t?-1:0)}function ve(t){if(isNaN(t)||!isFinite(t))return At;if(0>t)return J(ve(-t));for(var e=[],n=1,r=0;t>=n;r++)e[r]=t/n|0,n*=Js;return new O(e,0)}function Vl(t,e){if(t.length==0)throw Error("number format error: empty string");if(e=e||10,2>e||36<e)throw Error("radix out of range: "+e);if(t.charAt(0)=="-")return J(Vl(t.substring(1),e));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var n=ve(Math.pow(e,8)),r=At,i=0;i<t.length;i+=8){var s=Math.min(8,t.length-i),o=parseInt(t.substring(i,i+s),e);8>s?(s=ve(Math.pow(e,s)),r=r.R(s).add(ve(o))):(r=r.R(n),r=r.add(ve(o)))}return r}var Js=4294967296,At=Eo(0),Xs=Eo(1),ku=Eo(16777216);_=O.prototype;_.ea=function(){if(le(this))return-J(this).ea();for(var t=0,e=1,n=0;n<this.g.length;n++){var r=this.D(n);t+=(0<=r?r:Js+r)*e,e*=Js}return t};_.toString=function(t){if(t=t||10,2>t||36<t)throw Error("radix out of range: "+t);if(Ce(this))return"0";if(le(this))return"-"+J(this).toString(t);for(var e=ve(Math.pow(t,6)),n=this,r="";;){var i=Br(n,e).g;n=Ur(n,i.R(e));var s=((0<n.g.length?n.g[0]:n.h)>>>0).toString(t);if(n=i,Ce(n))return s+r;for(;6>s.length;)s="0"+s;r=s+r}};_.D=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h};function Ce(t){if(t.h!=0)return!1;for(var e=0;e<t.g.length;e++)if(t.g[e]!=0)return!1;return!0}function le(t){return t.h==-1}_.X=function(t){return t=Ur(this,t),le(t)?-1:Ce(t)?0:1};function J(t){for(var e=t.g.length,n=[],r=0;r<e;r++)n[r]=~t.g[r];return new O(n,~t.h).add(Xs)}_.abs=function(){return le(this)?J(this):this};_.add=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0,i=0;i<=e;i++){var s=r+(this.D(i)&65535)+(t.D(i)&65535),o=(s>>>16)+(this.D(i)>>>16)+(t.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,n[i]=o<<16|s}return new O(n,n[n.length-1]&-2147483648?-1:0)};function Ur(t,e){return t.add(J(e))}_.R=function(t){if(Ce(this)||Ce(t))return At;if(le(this))return le(t)?J(this).R(J(t)):J(J(this).R(t));if(le(t))return J(this.R(J(t)));if(0>this.X(ku)&&0>t.X(ku))return ve(this.ea()*t.ea());for(var e=this.g.length+t.g.length,n=[],r=0;r<2*e;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<t.g.length;i++){var s=this.D(r)>>>16,o=this.D(r)&65535,a=t.D(i)>>>16,c=t.D(i)&65535;n[2*r+2*i]+=o*c,xr(n,2*r+2*i),n[2*r+2*i+1]+=s*c,xr(n,2*r+2*i+1),n[2*r+2*i+1]+=o*a,xr(n,2*r+2*i+1),n[2*r+2*i+2]+=s*a,xr(n,2*r+2*i+2)}for(r=0;r<e;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=e;r<2*e;r++)n[r]=0;return new O(n,0)};function xr(t,e){for(;(t[e]&65535)!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function fn(t,e){this.g=t,this.h=e}function Br(t,e){if(Ce(e))throw Error("division by zero");if(Ce(t))return new fn(At,At);if(le(t))return e=Br(J(t),e),new fn(J(e.g),J(e.h));if(le(e))return e=Br(t,J(e)),new fn(J(e.g),e.h);if(30<t.g.length){if(le(t)||le(e))throw Error("slowDivide_ only works with positive integers.");for(var n=Xs,r=e;0>=r.X(t);)n=Nu(n),r=Nu(r);var i=wt(n,1),s=wt(r,1);for(r=wt(r,2),n=wt(n,2);!Ce(r);){var o=s.add(r);0>=o.X(t)&&(i=i.add(n),s=o),r=wt(r,1),n=wt(n,1)}return e=Ur(t,i.R(e)),new fn(i,e)}for(i=At;0<=t.X(e);){for(n=Math.max(1,Math.floor(t.ea()/e.ea())),r=Math.ceil(Math.log(n)/Math.LN2),r=48>=r?1:Math.pow(2,r-48),s=ve(n),o=s.R(e);le(o)||0<o.X(t);)n-=r,s=ve(n),o=s.R(e);Ce(s)&&(s=Xs),i=i.add(s),t=Ur(t,o)}return new fn(i,t)}_.gb=function(t){return Br(this,t).h};_.and=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)&t.D(r);return new O(n,this.h&t.h)};_.or=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)|t.D(r);return new O(n,this.h|t.h)};_.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)^t.D(r);return new O(n,this.h^t.h)};function Nu(t){for(var e=t.g.length+1,n=[],r=0;r<e;r++)n[r]=t.D(r)<<1|t.D(r-1)>>>31;return new O(n,t.h)}function wt(t,e){var n=e>>5;e%=32;for(var r=t.g.length-n,i=[],s=0;s<r;s++)i[s]=0<e?t.D(s+n)>>>e|t.D(s+n+1)<<32-e:t.D(s+n);return new O(i,t.h)}Fr.prototype.createWebChannel=Fr.prototype.g;ae.prototype.send=ae.prototype.u;ae.prototype.open=ae.prototype.m;ae.prototype.close=ae.prototype.close;Hr.NO_ERROR=0;Hr.TIMEOUT=8;Hr.HTTP_ERROR=6;Xu.COMPLETE="complete";Zu.EventType=Pn;Pn.OPEN="a";Pn.CLOSE="b";Pn.ERROR="c";Pn.MESSAGE="d";K.prototype.listen=K.prototype.O;L.prototype.listenOnce=L.prototype.P;L.prototype.getLastError=L.prototype.Sa;L.prototype.getLastErrorCode=L.prototype.Ia;L.prototype.getStatus=L.prototype.da;L.prototype.getResponseJson=L.prototype.Wa;L.prototype.getResponseText=L.prototype.ja;L.prototype.send=L.prototype.ha;L.prototype.setWithCredentials=L.prototype.Oa;de.prototype.digest=de.prototype.l;de.prototype.reset=de.prototype.reset;de.prototype.update=de.prototype.j;O.prototype.add=O.prototype.add;O.prototype.multiply=O.prototype.R;O.prototype.modulo=O.prototype.gb;O.prototype.compare=O.prototype.X;O.prototype.toNumber=O.prototype.ea;O.prototype.toString=O.prototype.toString;O.prototype.getBits=O.prototype.D;O.fromNumber=ve;O.fromString=Vl;var Ll=fe.createWebChannelTransport=function(){return new Fr},Ml=fe.getStatEventTarget=function(){return Kr()},ni=fe.ErrorCode=Hr,Fl=fe.EventType=Xu,Ul=fe.Event=tt,wo=fe.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},UI=fe.FetchXmlHttpFactory=kn,xn=fe.WebChannel=Zu,Bl=fe.XhrIo=L,ql=fe.Md5=de,nt=fe.Integer=O;var $l="@firebase/firestore";var Q=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Q.UNAUTHENTICATED=new Q(null),Q.GOOGLE_CREDENTIALS=new Q("google-credentials-uid"),Q.FIRST_PARTY=new Q("first-party-uid"),Q.MOCK_USER=new Q("mock-user");var Ht="10.10.0";var ut=new Ve("@firebase/firestore");function Vn(){return ut.logLevel}function y(t,...e){if(ut.logLevel<=S.DEBUG){let n=e.map(ic);ut.debug(`Firestore (${Ht}): ${t}`,...n)}}function Ae(t,...e){if(ut.logLevel<=S.ERROR){let n=e.map(ic);ut.error(`Firestore (${Ht}): ${t}`,...n)}}function Lt(t,...e){if(ut.logLevel<=S.WARN){let n=e.map(ic);ut.warn(`Firestore (${Ht}): ${t}`,...n)}}function ic(t){if(typeof t=="string")return t;try{return function(n){return JSON.stringify(n)}(t)}catch{return t}}function T(t="Unexpected state"){let e=`FIRESTORE (${Ht}) INTERNAL ASSERTION FAILED: `+t;throw Ae(e),new Error(e)}function $(t,e){t||T()}function D(t,e){return t}var g={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},I=class extends ce{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Ne=class{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}};var ai=class{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Po=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(Q.UNAUTHENTICATED))}shutdown(){}},Co=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}},Do=class{constructor(e){this.t=e,this.currentUser=Q.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){let r=this.i,i=c=>this.i!==r?(r=this.i,n(c)):Promise.resolve(),s=new Ne;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Ne,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let c=s;e.enqueueRetryable(()=>d(this,null,function*(){yield c.promise,yield i(this.currentUser)}))},a=c=>{y("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(c=>a(c)),setTimeout(()=>{if(!this.auth){let c=this.t.getImmediate({optional:!0});c?a(c):(y("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Ne)}},0),o()}getToken(){let e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(r=>this.i!==e?(y("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?($(typeof r.accessToken=="string"),new ai(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let e=this.auth&&this.auth.getUid();return $(e===null||typeof e=="string"),new Q(e)}},ko=class{constructor(e,n,r){this.l=e,this.h=n,this.P=r,this.type="FirstParty",this.user=Q.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},No=class{constructor(e,n,r){this.l=e,this.h=n,this.P=r}getToken(){return Promise.resolve(new ko(this.l,this.h,this.P))}start(e,n){e.enqueueRetryable(()=>n(Q.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Oo=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},xo=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,n){let r=s=>{s.error!=null&&y("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.R;return this.R=s.token,y("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?n(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{y("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):y("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?($(typeof n.token=="string"),this.R=n.token,new Oo(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}};function ag(t){let e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var Vo=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/e.length)*e.length,r="";for(;r.length<20;){let i=ag(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<n&&(r+=e.charAt(i[s]%e.length))}return r}};function N(t,e){return t<e?-1:t>e?1:0}function Mt(t,e,n){return t.length===e.length&&t.every((r,i)=>n(r,e[i]))}var he=class t{constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new I(g.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new I(g.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<-62135596800)throw new I(g.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new I(g.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return t.fromMillis(Date.now())}static fromDate(e){return t.fromMillis(e.getTime())}static fromMillis(e){let n=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*n));return new t(n,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?N(this.nanoseconds,e.nanoseconds):N(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var A=class t{constructor(e){this.timestamp=e}static fromTimestamp(e){return new t(e)}static min(){return new t(new he(0,0))}static max(){return new t(new he(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var ci=class t{constructor(e,n,r){n===void 0?n=0:n>e.length&&T(),r===void 0?r=e.length-n:r>e.length-n&&T(),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return t.comparator(this,e)===0}child(e){let n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach(r=>{n.push(r)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){let r=Math.min(e.length,n.length);for(let i=0;i<r;i++){let s=e.get(i),o=n.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<n.length?-1:e.length>n.length?1:0}},q=class t extends ci{construct(e,n,r){return new t(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let n=[];for(let r of e){if(r.indexOf("//")>=0)throw new I(g.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter(i=>i.length>0))}return new t(n)}static emptyPath(){return new t([])}},cg=/^[_a-zA-Z][_a-zA-Z0-9]*$/,pe=class t extends ci{construct(e,n,r){return new t(e,n,r)}static isValidIdentifier(e){return cg.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),t.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new t(["__name__"])}static fromServerFormat(e){let n=[],r="",i=0,s=()=>{if(r.length===0)throw new I(g.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""},o=!1;for(;i<e.length;){let a=e[i];if(a==="\\"){if(i+1===e.length)throw new I(g.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let c=e[i+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new I(g.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=c,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new I(g.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new t(n)}static emptyPath(){return new t([])}};var v=class t{constructor(e){this.path=e}static fromPath(e){return new t(q.fromString(e))}static fromName(e){return new t(q.fromString(e).popFirst(5))}static empty(){return new t(q.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&q.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return q.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new t(new q(e.slice()))}};var Lo=class{constructor(e,n,r,i){this.indexId=e,this.collectionGroup=n,this.fields=r,this.indexState=i}};Lo.UNKNOWN_ID=-1;function ug(t,e){let n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=A.fromTimestamp(r===1e9?new he(n+1,0):new he(n,r));return new lt(i,v.empty(),e)}function lg(t){return new lt(t.readTime,t.key,-1)}var lt=class t{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new t(A.min(),v.empty(),-1)}static max(){return new t(A.max(),v.empty(),-1)}};function hg(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=v.comparator(t.documentKey,e.documentKey),n!==0?n:N(t.largestBatchId,e.largestBatchId))}var dg="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Mo=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function sc(t){return d(this,null,function*(){if(t.code!==g.FAILED_PRECONDITION||t.message!==dg)throw t;y("LocalStore","Unexpectedly lost primary lease")})}var p=class t{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&T(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(n,s).next(r,i)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{let n=e();return n instanceof t?n:t.resolve(n)}catch(n){return t.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):t.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):t.reject(n)}static resolve(e){return new t((n,r)=>{n(e)})}static reject(e){return new t((n,r)=>{r(e)})}static waitFor(e){return new t((n,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&n()},c=>r(c))}),o=!0,s===i&&n()})}static or(e){let n=t.resolve(!1);for(let r of e)n=n.next(i=>i?t.resolve(i):r());return n}static forEach(e,n){let r=[];return e.forEach((i,s)=>{r.push(n.call(this,i,s))}),this.waitFor(r)}static mapArray(e,n){return new t((r,i)=>{let s=e.length,o=new Array(s),a=0;for(let c=0;c<s;c++){let u=c;n(e[u]).next(l=>{o[u]=l,++a,a===s&&r(o)},l=>i(l))}})}static doWhile(e,n){return new t((r,i)=>{let s=()=>{e()===!0?n().next(()=>{s()},i):r()};s()})}};var Fo=class t{constructor(e,n){this.action=e,this.transaction=n,this.aborted=!1,this.V=new Ne,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{n.error?this.V.reject(new ct(e,n.error)):this.V.resolve()},this.transaction.onerror=r=>{let i=oc(r.target.error);this.V.reject(new ct(e,i))}}static open(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(s){throw new ct(n,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(y("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let n=this.transaction.objectStore(e);return new Bo(n)}},ui=class t{constructor(e,n,r){this.name=e,this.version=n,this.p=r,t.S(ee())===12.2&&Ae("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return y("SimpleDb","Removing database:",e),rt(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!hr())return!1;if(t.C())return!0;let e=ee(),n=t.S(e),r=0<n&&n<10,i=t.v(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static C(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.F)==="YES"}static M(e,n){return e.store(n)}static S(e){let n=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=n?n[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static v(e){let n=e.match(/Android ([\d.]+)/i),r=n?n[1].split(".").slice(0,2).join("."):"-1";return Number(r)}O(e){return d(this,null,function*(){return this.db||(y("SimpleDb","Opening database:",this.name),this.db=yield new Promise((n,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;n(o)},i.onblocked=()=>{r(new ct(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new I(g.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new I(g.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new ct(e,o))},i.onupgradeneeded=s=>{y("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.p.N(o,i.transaction,s.oldVersion,this.version).next(()=>{y("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.L&&(this.db.onversionchange=n=>this.L(n)),this.db})}B(e){this.L=e,this.db&&(this.db.onversionchange=n=>e(n))}runTransaction(e,n,r,i){return d(this,null,function*(){let s=n==="readonly",o=0;for(;;){++o;try{this.db=yield this.O(e);let a=Fo.open(this.db,e,s?"readonly":"readwrite",r),c=i(a).next(u=>(a.g(),u)).catch(u=>(a.abort(u),p.reject(u))).toPromise();return c.catch(()=>{}),yield a.m,c}catch(a){let c=a,u=c.name!=="FirebaseError"&&o<3;if(y("SimpleDb","Transaction failed with error:",c.message,"Retrying:",u),this.close(),!u)return Promise.reject(c)}}})}close(){this.db&&this.db.close(),this.db=void 0}},Uo=class{constructor(e){this.k=e,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(e){this.k=e}done(){this.q=!0}U(e){this.K=e}delete(){return rt(this.k.delete())}},ct=class extends I{constructor(e,n){super(g.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${n}`),this.name="IndexedDbTransactionError"}};function er(t){return t.name==="IndexedDbTransactionError"}var Bo=class{constructor(e){this.store=e}put(e,n){let r;return n!==void 0?(y("SimpleDb","PUT",this.store.name,e,n),r=this.store.put(n,e)):(y("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),rt(r)}add(e){return y("SimpleDb","ADD",this.store.name,e,e),rt(this.store.add(e))}get(e){return rt(this.store.get(e)).next(n=>(n===void 0&&(n=null),y("SimpleDb","GET",this.store.name,e,n),n))}delete(e){return y("SimpleDb","DELETE",this.store.name,e),rt(this.store.delete(e))}count(){return y("SimpleDb","COUNT",this.store.name),rt(this.store.count())}W(e,n){let r=this.options(e,n),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new p((o,a)=>{s.onerror=c=>{a(c.target.error)},s.onsuccess=c=>{o(c.target.result)}})}{let s=this.cursor(r),o=[];return this.G(s,(a,c)=>{o.push(c)}).next(()=>o)}}j(e,n){let r=this.store.getAll(e,n===null?void 0:n);return new p((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}H(e,n){y("SimpleDb","DELETE ALL",this.store.name);let r=this.options(e,n);r.J=!1;let i=this.cursor(r);return this.G(i,(s,o,a)=>a.delete())}Y(e,n){let r;n?r=e:(r={},n=e);let i=this.cursor(r);return this.G(i,n)}Z(e){let n=this.cursor({});return new p((r,i)=>{n.onerror=s=>{let o=oc(s.target.error);i(o)},n.onsuccess=s=>{let o=s.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}G(e,n){let r=[];return new p((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let a=o.target.result;if(!a)return void i();let c=new Uo(a),u=n(a.primaryKey,a.value,c);if(u instanceof p){let l=u.catch(h=>(c.done(),p.reject(h)));r.push(l)}c.isDone?i():c.$===null?a.continue():a.continue(c.$)}}).next(()=>p.waitFor(r))}options(e,n){let r;return e!==void 0&&(typeof e=="string"?r=e:n=e),{index:r,range:n}}cursor(e){let n="next";if(e.reverse&&(n="prev"),e.index){let r=this.store.index(e.index);return e.J?r.openKeyCursor(e.range,n):r.openCursor(e.range,n)}return this.store.openCursor(e.range,n)}};function rt(t){return new p((e,n)=>{t.onsuccess=r=>{let i=r.target.result;e(i)},t.onerror=r=>{let i=oc(r.target.error);n(i)}})}var zl=!1;function oc(t){let e=ui.S(ee());if(e>=12.2&&e<13){let n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){let r=new I("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${n}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return zl||(zl=!0,setTimeout(()=>{throw r},0)),r}}return t}var vh=(()=>{class t{constructor(n,r){this.previousValue=n,r&&(r.sequenceNumberHandler=i=>this.se(i),this.oe=i=>r.writeSequenceNumber(i))}se(n){return this.previousValue=Math.max(n,this.previousValue),this.previousValue}next(){let n=++this.previousValue;return this.oe&&this.oe(n),n}}return t._e=-1,t})();function xi(t){return t==null}function li(t){return t===0&&1/t==-1/0}var fg=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],QI=[...fg,"documentOverlays"],pg=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],mg=pg,YI=[...mg,"indexConfiguration","indexState","indexEntries"];function jl(t){let e=0;for(let n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Vi(t,e){for(let n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function gg(t){for(let e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var F=class t{constructor(e,n){this.comparator=e,this.root=n||we.EMPTY}insert(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,we.BLACK,null,null))}remove(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,we.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){let r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return n+r.left.size;i<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,r)=>(e(n,r),!1))}toString(){let e=[];return this.inorderTraversal((n,r)=>(e.push(`${n}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new kt(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new kt(this.root,e,this.comparator,!1)}getReverseIterator(){return new kt(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new kt(this.root,e,this.comparator,!0)}},kt=class{constructor(e,n,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=n?r(e.key,n):1,n&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},we=class t{constructor(e,n,r,i,s){this.key=e,this.value=n,this.color=r??t.RED,this.left=i??t.EMPTY,this.right=s??t.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,i,s){return new t(e??this.key,n??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let i=this,s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,n,r),null):s===0?i.copy(null,n,null,null,null):i.copy(null,null,null,null,i.right.insert(e,n,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return t.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),n(e,i.key)===0){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw T();let e=this.left.check();if(e!==this.right.check())throw T();return e+(this.isRed()?0:1)}};we.EMPTY=null,we.RED=!0,we.BLACK=!1;we.EMPTY=new class{constructor(){this.size=0}get key(){throw T()}get value(){throw T()}get color(){throw T()}get left(){throw T()}get right(){throw T()}copy(e,n,r,i,s){return this}insert(e,n,r){return new we(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var ie=class t{constructor(e){this.comparator=e,this.data=new F(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,r)=>(e(n),!1))}forEachInRange(e,n){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;n(i.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new hi(this.data.getIterator())}getIteratorFrom(e){return new hi(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(r=>{n=n.add(r)}),n}isEqual(e){if(!(e instanceof t)||this.size!==e.size)return!1;let n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){let i=n.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(n=>{e.push(n)}),e}toString(){let e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){let n=new t(this.comparator);return n.data=e,n}},hi=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var it=class t{constructor(e){this.fields=e,e.sort(pe.comparator)}static empty(){return new t([])}unionWith(e){let n=new ie(pe.comparator);for(let r of this.fields)n=n.add(r);for(let r of e)n=n.add(r);return new t(n.toArray())}covers(e){for(let n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return Mt(this.fields,e.fields,(n,r)=>n.isEqual(r))}};var di=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var oe=class t{constructor(e){this.binaryString=e}static fromBase64String(e){let n=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new di("Invalid base64 string: "+s):s}}(e);return new t(n)}static fromUint8Array(e){let n=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new t(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){let r=new Uint8Array(n.length);for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return N(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};oe.EMPTY_BYTE_STRING=new oe("");var _g=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function qe(t){if($(!!t),typeof t=="string"){let e=0,n=_g.exec(t);if($(!!n),n[1]){let i=n[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:M(t.seconds),nanos:M(t.nanos)}}function M(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function $e(t){return typeof t=="string"?oe.fromBase64String(t):oe.fromUint8Array(t)}function ac(t){var e,n;return((n=(((e=t?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="server_timestamp"}function cc(t){let e=t.mapValue.fields.__previous_value__;return ac(e)?cc(e):e}function $n(t){let e=qe(t.mapValue.fields.__local_write_time__.timestampValue);return new he(e.seconds,e.nanos)}var qo=class{constructor(e,n,r,i,s,o,a,c,u){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=c,this.useFetchStreams=u}},fi=class t{constructor(e,n){this.projectId=e,this.database=n||"(default)"}static empty(){return new t("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database}};var ri={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function ht(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?ac(t)?4:Eh(t)?9007199254740991:10:T()}function Se(t,e){if(t===e)return!0;let n=ht(t);if(n!==ht(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return $n(t).isEqual($n(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let o=qe(i.timestampValue),a=qe(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(i,s){return $e(i.bytesValue).isEqual($e(s.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(i,s){return M(i.geoPointValue.latitude)===M(s.geoPointValue.latitude)&&M(i.geoPointValue.longitude)===M(s.geoPointValue.longitude)}(t,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return M(i.integerValue)===M(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let o=M(i.doubleValue),a=M(s.doubleValue);return o===a?li(o)===li(a):isNaN(o)&&isNaN(a)}return!1}(t,e);case 9:return Mt(t.arrayValue.values||[],e.arrayValue.values||[],Se);case 10:return function(i,s){let o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(jl(o)!==jl(a))return!1;for(let c in o)if(o.hasOwnProperty(c)&&(a[c]===void 0||!Se(o[c],a[c])))return!1;return!0}(t,e);default:return T()}}function zn(t,e){return(t.values||[]).find(n=>Se(n,e))!==void 0}function Ft(t,e){if(t===e)return 0;let n=ht(t),r=ht(e);if(n!==r)return N(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return N(t.booleanValue,e.booleanValue);case 2:return function(s,o){let a=M(s.integerValue||s.doubleValue),c=M(o.integerValue||o.doubleValue);return a<c?-1:a>c?1:a===c?0:isNaN(a)?isNaN(c)?0:-1:1}(t,e);case 3:return Gl(t.timestampValue,e.timestampValue);case 4:return Gl($n(t),$n(e));case 5:return N(t.stringValue,e.stringValue);case 6:return function(s,o){let a=$e(s),c=$e(o);return a.compareTo(c)}(t.bytesValue,e.bytesValue);case 7:return function(s,o){let a=s.split("/"),c=o.split("/");for(let u=0;u<a.length&&u<c.length;u++){let l=N(a[u],c[u]);if(l!==0)return l}return N(a.length,c.length)}(t.referenceValue,e.referenceValue);case 8:return function(s,o){let a=N(M(s.latitude),M(o.latitude));return a!==0?a:N(M(s.longitude),M(o.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(s,o){let a=s.values||[],c=o.values||[];for(let u=0;u<a.length&&u<c.length;++u){let l=Ft(a[u],c[u]);if(l)return l}return N(a.length,c.length)}(t.arrayValue,e.arrayValue);case 10:return function(s,o){if(s===ri.mapValue&&o===ri.mapValue)return 0;if(s===ri.mapValue)return 1;if(o===ri.mapValue)return-1;let a=s.fields||{},c=Object.keys(a),u=o.fields||{},l=Object.keys(u);c.sort(),l.sort();for(let h=0;h<c.length&&h<l.length;++h){let f=N(c[h],l[h]);if(f!==0)return f;let m=Ft(a[c[h]],u[l[h]]);if(m!==0)return m}return N(c.length,l.length)}(t.mapValue,e.mapValue);default:throw T()}}function Gl(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return N(t,e);let n=qe(t),r=qe(e),i=N(n.seconds,r.seconds);return i!==0?i:N(n.nanos,r.nanos)}function Ut(t){return $o(t)}function $o(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(n){let r=qe(n);return`time(${r.seconds},${r.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(n){return $e(n).toBase64()}(t.bytesValue):"referenceValue"in t?function(n){return v.fromName(n).toString()}(t.referenceValue):"geoPointValue"in t?function(n){return`geo(${n.latitude},${n.longitude})`}(t.geoPointValue):"arrayValue"in t?function(n){let r="[",i=!0;for(let s of n.values||[])i?i=!1:r+=",",r+=$o(s);return r+"]"}(t.arrayValue):"mapValue"in t?function(n){let r=Object.keys(n.fields||{}).sort(),i="{",s=!0;for(let o of r)s?s=!1:i+=",",i+=`${o}:${$o(n.fields[o])}`;return i+"}"}(t.mapValue):T()}function zo(t){return!!t&&"integerValue"in t}function uc(t){return!!t&&"arrayValue"in t}function Wl(t){return!!t&&"nullValue"in t}function Kl(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function To(t){return!!t&&"mapValue"in t}function Mn(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){let e={mapValue:{fields:{}}};return Vi(t.mapValue.fields,(n,r)=>e.mapValue.fields[n]=Mn(r)),e}if(t.arrayValue){let e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Mn(t.arrayValue.values[n]);return e}return Object.assign({},t)}function Eh(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var ke=class t{constructor(e){this.value=e}static empty(){return new t({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!To(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=Mn(n)}setAll(e){let n=pe.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!n.isImmediateParentOf(a)){let c=this.getFieldsMap(n);this.applyChanges(c,r,i),r={},i=[],n=a.popLast()}o?r[a.lastSegment()]=Mn(o):i.push(a.lastSegment())});let s=this.getFieldsMap(n);this.applyChanges(s,r,i)}delete(e){let n=this.field(e.popLast());To(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return Se(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=n.mapValue.fields[e.get(r)];To(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=i),n=i}return n.mapValue.fields}applyChanges(e,n,r){Vi(n,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new t(Mn(this.value))}};var me=class t{constructor(e,n,r,i,s,o,a){this.key=e,this.documentType=n,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new t(e,0,A.min(),A.min(),A.min(),ke.empty(),0)}static newFoundDocument(e,n,r,i){return new t(e,1,n,A.min(),r,i,0)}static newNoDocument(e,n){return new t(e,2,n,A.min(),A.min(),ke.empty(),0)}static newUnknownDocument(e,n){return new t(e,3,n,A.min(),A.min(),ke.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(A.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ke.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ke.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=A.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new t(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Bt=class{constructor(e,n){this.position=e,this.inclusive=n}};function Hl(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){let s=e[i],o=t.position[i];if(s.field.isKeyField()?r=v.comparator(v.fromName(o.referenceValue),n.key):r=Ft(o,n.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function Ql(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Se(t.position[n],e.position[n]))return!1;return!0}var qt=class{constructor(e,n="asc"){this.field=e,this.dir=n}};function yg(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}var pi=class{},z=class t extends pi{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new Go(e,n,r):n==="array-contains"?new Ho(e,r):n==="in"?new Qo(e,r):n==="not-in"?new Yo(e,r):n==="array-contains-any"?new Jo(e,r):new t(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new Wo(e,r):new Ko(e,r)}matches(e){let n=e.data.field(this.field);return this.op==="!="?n!==null&&this.matchesComparison(Ft(n,this.value)):n!==null&&ht(this.value)===ht(n)&&this.matchesComparison(Ft(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return T()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},be=class t extends pi{constructor(e,n){super(),this.filters=e,this.op=n,this.ue=null}static create(e,n){return new t(e,n)}matches(e){return wh(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.ue!==null||(this.ue=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.ue}getFilters(){return Object.assign([],this.filters)}};function wh(t){return t.op==="and"}function Th(t){return Ig(t)&&wh(t)}function Ig(t){for(let e of t.filters)if(e instanceof be)return!1;return!0}function jo(t){if(t instanceof z)return t.field.canonicalString()+t.op.toString()+Ut(t.value);if(Th(t))return t.filters.map(e=>jo(e)).join(",");{let e=t.filters.map(n=>jo(n)).join(",");return`${t.op}(${e})`}}function Ah(t,e){return t instanceof z?function(r,i){return i instanceof z&&r.op===i.op&&r.field.isEqual(i.field)&&Se(r.value,i.value)}(t,e):t instanceof be?function(r,i){return i instanceof be&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,o,a)=>s&&Ah(o,i.filters[a]),!0):!1}(t,e):void T()}function Sh(t){return t instanceof z?function(n){return`${n.field.canonicalString()} ${n.op} ${Ut(n.value)}`}(t):t instanceof be?function(n){return n.op.toString()+" {"+n.getFilters().map(Sh).join(" ,")+"}"}(t):"Filter"}var Go=class extends z{constructor(e,n,r){super(e,n,r),this.key=v.fromName(r.referenceValue)}matches(e){let n=v.comparator(e.key,this.key);return this.matchesComparison(n)}},Wo=class extends z{constructor(e,n){super(e,"in",n),this.keys=bh("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}},Ko=class extends z{constructor(e,n){super(e,"not-in",n),this.keys=bh("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}};function bh(t,e){var n;return(((n=e.arrayValue)===null||n===void 0?void 0:n.values)||[]).map(r=>v.fromName(r.referenceValue))}var Ho=class extends z{constructor(e,n){super(e,"array-contains",n)}matches(e){let n=e.data.field(this.field);return uc(n)&&zn(n.arrayValue,this.value)}},Qo=class extends z{constructor(e,n){super(e,"in",n)}matches(e){let n=e.data.field(this.field);return n!==null&&zn(this.value.arrayValue,n)}},Yo=class extends z{constructor(e,n){super(e,"not-in",n)}matches(e){if(zn(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let n=e.data.field(this.field);return n!==null&&!zn(this.value.arrayValue,n)}},Jo=class extends z{constructor(e,n){super(e,"array-contains-any",n)}matches(e){let n=e.data.field(this.field);return!(!uc(n)||!n.arrayValue.values)&&n.arrayValue.values.some(r=>zn(this.value.arrayValue,r))}};var Xo=class{constructor(e,n=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.ce=null}};function Yl(t,e=null,n=[],r=[],i=null,s=null,o=null){return new Xo(t,e,n,r,i,s,o)}function lc(t){let e=D(t);if(e.ce===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(r=>jo(r)).join(","),n+="|ob:",n+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),xi(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(r=>Ut(r)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(r=>Ut(r)).join(",")),e.ce=n}return e.ce}function hc(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!yg(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!Ah(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Ql(t.startAt,e.startAt)&&Ql(t.endAt,e.endAt)}function Zo(t){return v.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}var $t=class{constructor(e,n=null,r=[],i=[],s=null,o="F",a=null,c=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=c,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}};function vg(t,e,n,r,i,s,o,a){return new $t(t,e,n,r,i,s,o,a)}function dc(t){return new $t(t)}function Jl(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function Eg(t){return t.collectionGroup!==null}function Fn(t){let e=D(t);if(e.le===null){e.le=[];let n=new Set;for(let s of e.explicitOrderBy)e.le.push(s),n.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new ie(pe.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(u=>{u.isInequality()&&(a=a.add(u.field))})}),a})(e).forEach(s=>{n.has(s.canonicalString())||s.isKeyField()||e.le.push(new qt(s,r))}),n.has(pe.keyField().canonicalString())||e.le.push(new qt(pe.keyField(),r))}return e.le}function Te(t){let e=D(t);return e.he||(e.he=wg(e,Fn(t))),e.he}function wg(t,e){if(t.limitType==="F")return Yl(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new qt(i.field,s)});let n=t.endAt?new Bt(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new Bt(t.startAt.position,t.startAt.inclusive):null;return Yl(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function ea(t,e,n){return new $t(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Li(t,e){return hc(Te(t),Te(e))&&t.limitType===e.limitType}function Rh(t){return`${lc(Te(t))}|lt:${t.limitType}`}function Pt(t){return`Query(target=${function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map(i=>Sh(i)).join(", ")}]`),xi(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map(i=>Ut(i)).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map(i=>Ut(i)).join(",")),`Target(${r})`}(Te(t))}; limitType=${t.limitType})`}function Mi(t,e){return e.isFoundDocument()&&function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):v.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(t,e)&&function(r,i){for(let s of Fn(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(t,e)&&function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0}(t,e)&&function(r,i){return!(r.startAt&&!function(o,a,c){let u=Hl(o,a,c);return o.inclusive?u<=0:u<0}(r.startAt,Fn(r),i)||r.endAt&&!function(o,a,c){let u=Hl(o,a,c);return o.inclusive?u>=0:u>0}(r.endAt,Fn(r),i))}(t,e)}function Tg(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function Ph(t){return(e,n)=>{let r=!1;for(let i of Fn(t)){let s=Ag(i,e,n);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function Ag(t,e,n){let r=t.field.isKeyField()?v.comparator(e.key,n.key):function(s,o,a){let c=o.data.field(s),u=a.data.field(s);return c!==null&&u!==null?Ft(c,u):T()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return T()}}var ze=class{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){let n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,n){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,n]);i.push([e,n]),this.innerSize++}delete(e){let n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[n]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Vi(this.inner,(n,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return gg(this.inner)}size(){return this.innerSize}};var Sg=new F(v.comparator);function je(){return Sg}var Ch=new F(v.comparator);function Ln(...t){let e=Ch;for(let n of t)e=e.insert(n.key,n);return e}function bg(t){let e=Ch;return t.forEach((n,r)=>e=e.insert(n,r.overlayedDocument)),e}function st(){return Un()}function Dh(){return Un()}function Un(){return new ze(t=>t.toString(),(t,e)=>t.isEqual(e))}var XI=new F(v.comparator),Rg=new ie(v.comparator);function C(...t){let e=Rg;for(let n of t)e=e.add(n);return e}var Pg=new ie(N);function Cg(){return Pg}function Dg(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:li(e)?"-0":e}}function kg(t){return{integerValue:""+t}}var zt=class{constructor(){this._=void 0}};function Ng(t,e,n){return t instanceof jn?function(i,s){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&ac(s)&&(s=cc(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(n,e):t instanceof jt?kh(t,e):t instanceof Gt?Nh(t,e):function(i,s){let o=xg(i,s),a=Xl(o)+Xl(i.Ie);return zo(o)&&zo(i.Ie)?kg(a):Dg(i.serializer,a)}(t,e)}function Og(t,e,n){return t instanceof jt?kh(t,e):t instanceof Gt?Nh(t,e):n}function xg(t,e){return t instanceof Gn?function(r){return zo(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}var jn=class extends zt{},jt=class extends zt{constructor(e){super(),this.elements=e}};function kh(t,e){let n=Oh(e);for(let r of t.elements)n.some(i=>Se(i,r))||n.push(r);return{arrayValue:{values:n}}}var Gt=class extends zt{constructor(e){super(),this.elements=e}};function Nh(t,e){let n=Oh(e);for(let r of t.elements)n=n.filter(i=>!Se(i,r));return{arrayValue:{values:n}}}var Gn=class extends zt{constructor(e,n){super(),this.serializer=e,this.Ie=n}};function Xl(t){return M(t.integerValue||t.doubleValue)}function Oh(t){return uc(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function Vg(t,e){return t.field.isEqual(e.field)&&function(r,i){return r instanceof jt&&i instanceof jt||r instanceof Gt&&i instanceof Gt?Mt(r.elements,i.elements,Se):r instanceof Gn&&i instanceof Gn?Se(r.Ie,i.Ie):r instanceof jn&&i instanceof jn}(t.transform,e.transform)}var Bn=class t{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new t}static exists(e){return new t(void 0,e)}static updateTime(e){return new t(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function si(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}var Wn=class{};function xh(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new ta(t.key,Bn.none()):new Kn(t.key,t.data,Bn.none());{let n=t.data,r=ke.empty(),i=new ie(pe.comparator);for(let s of e.fields)if(!i.has(s)){let o=n.field(s);o===null&&s.length>1&&(s=s.popLast(),o=n.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new Wt(t.key,r,new it(i.toArray()),Bn.none())}}function Lg(t,e,n){t instanceof Kn?function(i,s,o){let a=i.value.clone(),c=eh(i.fieldTransforms,s,o.transformResults);a.setAll(c),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(t,e,n):t instanceof Wt?function(i,s,o){if(!si(i.precondition,s))return void s.convertToUnknownDocument(o.version);let a=eh(i.fieldTransforms,s,o.transformResults),c=s.data;c.setAll(Vh(i)),c.setAll(a),s.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(t,e,n):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,n)}function qn(t,e,n,r){return t instanceof Kn?function(s,o,a,c){if(!si(s.precondition,o))return a;let u=s.value.clone(),l=th(s.fieldTransforms,c,o);return u.setAll(l),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(t,e,n,r):t instanceof Wt?function(s,o,a,c){if(!si(s.precondition,o))return a;let u=th(s.fieldTransforms,c,o),l=o.data;return l.setAll(Vh(s)),l.setAll(u),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(h=>h.field))}(t,e,n,r):function(s,o,a){return si(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(t,e,n)}function Zl(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&Mt(r,i,(s,o)=>Vg(s,o))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}var Kn=class extends Wn{constructor(e,n,r,i=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},Wt=class extends Wn{constructor(e,n,r,i,s=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function Vh(t){let e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){let r=t.data.field(n);e.set(n,r)}}),e}function eh(t,e,n){let r=new Map;$(t.length===n.length);for(let i=0;i<n.length;i++){let s=t[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,Og(o,a,n[i]))}return r}function th(t,e,n){let r=new Map;for(let i of t){let s=i.transform,o=n.data.field(i.field);r.set(i.field,Ng(s,o,e))}return r}var ta=class extends Wn{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}};var na=class{constructor(e,n,r,i){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,n){let r=n.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&Lg(s,e,r[i])}}applyToLocalView(e,n){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(n=qn(r,e,n,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(n=qn(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){let r=Dh();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=n.has(i.key)?null:a;let c=xh(o,a);c!==null&&r.set(i.key,c),o.isValidDocument()||o.convertToNoDocument(A.min())}),r}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),C())}isEqual(e){return this.batchId===e.batchId&&Mt(this.mutations,e.mutations,(n,r)=>Zl(n,r))&&Mt(this.baseMutations,e.baseMutations,(n,r)=>Zl(n,r))}};var ra=class{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var ia=class{constructor(e,n){this.count=e,this.unchangedNames=n}};var U,R;function Lh(t){if(t===void 0)return Ae("GRPC error has no .code"),g.UNKNOWN;switch(t){case U.OK:return g.OK;case U.CANCELLED:return g.CANCELLED;case U.UNKNOWN:return g.UNKNOWN;case U.DEADLINE_EXCEEDED:return g.DEADLINE_EXCEEDED;case U.RESOURCE_EXHAUSTED:return g.RESOURCE_EXHAUSTED;case U.INTERNAL:return g.INTERNAL;case U.UNAVAILABLE:return g.UNAVAILABLE;case U.UNAUTHENTICATED:return g.UNAUTHENTICATED;case U.INVALID_ARGUMENT:return g.INVALID_ARGUMENT;case U.NOT_FOUND:return g.NOT_FOUND;case U.ALREADY_EXISTS:return g.ALREADY_EXISTS;case U.PERMISSION_DENIED:return g.PERMISSION_DENIED;case U.FAILED_PRECONDITION:return g.FAILED_PRECONDITION;case U.ABORTED:return g.ABORTED;case U.OUT_OF_RANGE:return g.OUT_OF_RANGE;case U.UNIMPLEMENTED:return g.UNIMPLEMENTED;case U.DATA_LOSS:return g.DATA_LOSS;default:return T()}}(R=U||(U={}))[R.OK=0]="OK",R[R.CANCELLED=1]="CANCELLED",R[R.UNKNOWN=2]="UNKNOWN",R[R.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",R[R.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",R[R.NOT_FOUND=5]="NOT_FOUND",R[R.ALREADY_EXISTS=6]="ALREADY_EXISTS",R[R.PERMISSION_DENIED=7]="PERMISSION_DENIED",R[R.UNAUTHENTICATED=16]="UNAUTHENTICATED",R[R.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",R[R.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",R[R.ABORTED=10]="ABORTED",R[R.OUT_OF_RANGE=11]="OUT_OF_RANGE",R[R.UNIMPLEMENTED=12]="UNIMPLEMENTED",R[R.INTERNAL=13]="INTERNAL",R[R.UNAVAILABLE=14]="UNAVAILABLE",R[R.DATA_LOSS=15]="DATA_LOSS";var nh=null;function Mg(){return new TextEncoder}var Fg=new nt([4294967295,4294967295],0);function rh(t){let e=Mg().encode(t),n=new ql;return n.update(e),new Uint8Array(n.digest())}function ih(t){let e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new nt([n,r],0),new nt([i,s],0)]}var sa=class t{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new ot(`Invalid padding: ${n}`);if(r<0)throw new ot(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new ot(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new ot(`Invalid padding when bitmap length is 0: ${n}`);this.Te=8*e.length-n,this.Ee=nt.fromNumber(this.Te)}de(e,n,r){let i=e.add(n.multiply(nt.fromNumber(r)));return i.compare(Fg)===1&&(i=new nt([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Ee).toNumber()}Ae(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Te===0)return!1;let n=rh(e),[r,i]=ih(n);for(let s=0;s<this.hashCount;s++){let o=this.de(r,i,s);if(!this.Ae(o))return!1}return!0}static create(e,n,r){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new t(s,i,n);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Te===0)return;let n=rh(e),[r,i]=ih(n);for(let s=0;s<this.hashCount;s++){let o=this.de(r,i,s);this.Re(o)}}Re(e){let n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}},ot=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var mi=class t{constructor(e,n,r,i,s){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,n,r){let i=new Map;return i.set(e,Hn.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new t(A.min(),i,new F(N),je(),C())}},Hn=class t{constructor(e,n,r,i,s){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new t(r,n,C(),C(),C())}};var Nt=class{constructor(e,n,r,i){this.Ve=e,this.removedTargetIds=n,this.key=r,this.me=i}},gi=class{constructor(e,n){this.targetId=e,this.fe=n}},_i=class{constructor(e,n,r=oe.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=i}},yi=class{constructor(){this.ge=0,this.pe=oh(),this.ye=oe.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return this.ge!==0}get De(){return this.Se}Ce(e){e.approximateByteSize()>0&&(this.Se=!0,this.ye=e)}ve(){let e=C(),n=C(),r=C();return this.pe.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:n=n.add(i);break;case 1:r=r.add(i);break;default:T()}}),new Hn(this.ye,this.we,e,n,r)}Fe(){this.Se=!1,this.pe=oh()}Me(e,n){this.Se=!0,this.pe=this.pe.insert(e,n)}xe(e){this.Se=!0,this.pe=this.pe.remove(e)}Oe(){this.ge+=1}Ne(){this.ge-=1,$(this.ge>=0)}Le(){this.Se=!0,this.we=!0}},oa=class{constructor(e){this.Be=e,this.ke=new Map,this.qe=je(),this.Qe=sh(),this.Ke=new F(N)}$e(e){for(let n of e.Ve)e.me&&e.me.isFoundDocument()?this.Ue(n,e.me):this.We(n,e.key,e.me);for(let n of e.removedTargetIds)this.We(n,e.key,e.me)}Ge(e){this.forEachTarget(e,n=>{let r=this.ze(n);switch(e.state){case 0:this.je(n)&&r.Ce(e.resumeToken);break;case 1:r.Ne(),r.be||r.Fe(),r.Ce(e.resumeToken);break;case 2:r.Ne(),r.be||this.removeTarget(n);break;case 3:this.je(n)&&(r.Le(),r.Ce(e.resumeToken));break;case 4:this.je(n)&&(this.He(n),r.Ce(e.resumeToken));break;default:T()}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.ke.forEach((r,i)=>{this.je(i)&&n(i)})}Je(e){let n=e.targetId,r=e.fe.count,i=this.Ye(n);if(i){let s=i.target;if(Zo(s))if(r===0){let o=new v(s.path);this.We(n,o,me.newNoDocument(o,A.min()))}else $(r===1);else{let o=this.Ze(n);if(o!==r){let a=this.Xe(e),c=a?this.et(a,e,o):1;if(c!==0){this.He(n);let u=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(n,u)}nh?.tt(function(l,h,f,m,P){var b,E,V,j,Y,Z;let ge={localCacheCount:l,existenceFilterCount:h.count,databaseId:f.database,projectId:f.projectId},G=h.unchangedNames;return G&&(ge.bloomFilter={applied:P===0,hashCount:(b=G?.hashCount)!==null&&b!==void 0?b:0,bitmapLength:(j=(V=(E=G?.bits)===null||E===void 0?void 0:E.bitmap)===null||V===void 0?void 0:V.length)!==null&&j!==void 0?j:0,padding:(Z=(Y=G?.bits)===null||Y===void 0?void 0:Y.padding)!==null&&Z!==void 0?Z:0,mightContain:Re=>{var pt;return(pt=m?.mightContain(Re))!==null&&pt!==void 0&&pt}}),ge}(o,e.fe,this.Be.nt(),a,c))}}}}Xe(e){let n=e.fe.unchangedNames;if(!n||!n.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=n,o,a;try{o=$e(r).toUint8Array()}catch(c){if(c instanceof di)return Lt("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{a=new sa(o,i,s)}catch(c){return Lt(c instanceof ot?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return a.Te===0?null:a}et(e,n,r){return n.fe.count===r-this.rt(e,n.targetId)?0:2}rt(e,n){let r=this.Be.getRemoteKeysForTarget(n),i=0;return r.forEach(s=>{let o=this.Be.nt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.We(n,s,null),i++)}),i}it(e){let n=new Map;this.ke.forEach((s,o)=>{let a=this.Ye(o);if(a){if(s.current&&Zo(a.target)){let c=new v(a.target.path);this.qe.get(c)!==null||this.st(o,c)||this.We(o,c,me.newNoDocument(c,e))}s.De&&(n.set(o,s.ve()),s.Fe())}});let r=C();this.Qe.forEach((s,o)=>{let a=!0;o.forEachWhile(c=>{let u=this.Ye(c);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(s))}),this.qe.forEach((s,o)=>o.setReadTime(e));let i=new mi(e,n,this.Ke,this.qe,r);return this.qe=je(),this.Qe=sh(),this.Ke=new F(N),i}Ue(e,n){if(!this.je(e))return;let r=this.st(e,n.key)?2:0;this.ze(e).Me(n.key,r),this.qe=this.qe.insert(n.key,n),this.Qe=this.Qe.insert(n.key,this.ot(n.key).add(e))}We(e,n,r){if(!this.je(e))return;let i=this.ze(e);this.st(e,n)?i.Me(n,1):i.xe(n),this.Qe=this.Qe.insert(n,this.ot(n).delete(e)),r&&(this.qe=this.qe.insert(n,r))}removeTarget(e){this.ke.delete(e)}Ze(e){let n=this.ze(e).ve();return this.Be.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Oe(e){this.ze(e).Oe()}ze(e){let n=this.ke.get(e);return n||(n=new yi,this.ke.set(e,n)),n}ot(e){let n=this.Qe.get(e);return n||(n=new ie(N),this.Qe=this.Qe.insert(e,n)),n}je(e){let n=this.Ye(e)!==null;return n||y("WatchChangeAggregator","Detected inactive target",e),n}Ye(e){let n=this.ke.get(e);return n&&n.be?null:this.Be._t(e)}He(e){this.ke.set(e,new yi),this.Be.getRemoteKeysForTarget(e).forEach(n=>{this.We(e,n,null)})}st(e,n){return this.Be.getRemoteKeysForTarget(e).has(n)}};function sh(){return new F(v.comparator)}function oh(){return new F(v.comparator)}var Ug={asc:"ASCENDING",desc:"DESCENDING"},Bg={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},qg={and:"AND",or:"OR"},aa=class{constructor(e,n){this.databaseId=e,this.useProto3Json=n}};function ca(t,e){return t.useProto3Json||xi(e)?e:{value:e}}function $g(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function zg(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function Ot(t){return $(!!t),A.fromTimestamp(function(n){let r=qe(n);return new he(r.seconds,r.nanos)}(t))}function jg(t,e){return ua(t,e).canonicalString()}function ua(t,e){let n=function(i){return new q(["projects",i.projectId,"databases",i.database])}(t).child("documents");return e===void 0?n:n.child(e)}function Mh(t){let e=q.fromString(t);return $($h(e)),e}function Ao(t,e){let n=Mh(e);if(n.get(1)!==t.databaseId.projectId)throw new I(g.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new I(g.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new v(Uh(n))}function Fh(t,e){return jg(t.databaseId,e)}function Gg(t){let e=Mh(t);return e.length===4?q.emptyPath():Uh(e)}function ah(t){return new q(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Uh(t){return $(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function Wg(t,e){let n;if("targetChange"in e){e.targetChange;let r=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:T()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(u,l){return u.useProto3Json?($(l===void 0||typeof l=="string"),oe.fromBase64String(l||"")):($(l===void 0||l instanceof Uint8Array),oe.fromUint8Array(l||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){let l=u.code===void 0?g.UNKNOWN:Lh(u.code);return new I(l,u.message||"")}(o);n=new _i(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=Ao(t,r.document.name),s=Ot(r.document.updateTime),o=r.document.createTime?Ot(r.document.createTime):A.min(),a=new ke({mapValue:{fields:r.document.fields}}),c=me.newFoundDocument(i,s,o,a),u=r.targetIds||[],l=r.removedTargetIds||[];n=new Nt(u,l,c.key,c)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=Ao(t,r.document),s=r.readTime?Ot(r.readTime):A.min(),o=me.newNoDocument(i,s),a=r.removedTargetIds||[];n=new Nt([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=Ao(t,r.document),s=r.removedTargetIds||[];n=new Nt([],s,i,null)}else{if(!("filter"in e))return T();{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new ia(i,s),a=r.targetId;n=new gi(a,o)}}return n}function Kg(t,e){return{documents:[Fh(t,e.path)]}}function Hg(t,e){let n={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=Fh(t,i);let s=function(u){if(u.length!==0)return qh(be.create(u,"and"))}(e.filters);s&&(n.structuredQuery.where=s);let o=function(u){if(u.length!==0)return u.map(l=>function(f){return{field:Ct(f.field),direction:Jg(f.dir)}}(l))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);let a=ca(t,e.limit);return a!==null&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{ut:n,parent:i}}function Qg(t){let e=Gg(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){$(r===1);let l=n.from[0];l.allDescendants?i=l.collectionId:e=e.child(l.collectionId)}let s=[];n.where&&(s=function(h){let f=Bh(h);return f instanceof be&&Th(f)?f.getFilters():[f]}(n.where));let o=[];n.orderBy&&(o=function(h){return h.map(f=>function(P){return new qt(Dt(P.field),function(E){switch(E){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(P.direction))}(f))}(n.orderBy));let a=null;n.limit&&(a=function(h){let f;return f=typeof h=="object"?h.value:h,xi(f)?null:f}(n.limit));let c=null;n.startAt&&(c=function(h){let f=!!h.before,m=h.values||[];return new Bt(m,f)}(n.startAt));let u=null;return n.endAt&&(u=function(h){let f=!h.before,m=h.values||[];return new Bt(m,f)}(n.endAt)),vg(e,i,o,s,a,"F",c,u)}function Yg(t,e){let n=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return T()}}(e.purpose);return n==null?null:{"goog-listen-tags":n}}function Bh(t){return t.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":let r=Dt(n.unaryFilter.field);return z.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=Dt(n.unaryFilter.field);return z.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=Dt(n.unaryFilter.field);return z.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=Dt(n.unaryFilter.field);return z.create(o,"!=",{nullValue:"NULL_VALUE"});default:return T()}}(t):t.fieldFilter!==void 0?function(n){return z.create(Dt(n.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return T()}}(n.fieldFilter.op),n.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(n){return be.create(n.compositeFilter.filters.map(r=>Bh(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return T()}}(n.compositeFilter.op))}(t):T()}function Jg(t){return Ug[t]}function Xg(t){return Bg[t]}function Zg(t){return qg[t]}function Ct(t){return{fieldPath:t.canonicalString()}}function Dt(t){return pe.fromServerFormat(t.fieldPath)}function qh(t){return t instanceof z?function(n){if(n.op==="=="){if(Kl(n.value))return{unaryFilter:{field:Ct(n.field),op:"IS_NAN"}};if(Wl(n.value))return{unaryFilter:{field:Ct(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(Kl(n.value))return{unaryFilter:{field:Ct(n.field),op:"IS_NOT_NAN"}};if(Wl(n.value))return{unaryFilter:{field:Ct(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ct(n.field),op:Xg(n.op),value:n.value}}}(t):t instanceof be?function(n){let r=n.getFilters().map(i=>qh(i));return r.length===1?r[0]:{compositeFilter:{op:Zg(n.op),filters:r}}}(t):T()}function $h(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}var Qn=class t{constructor(e,n,r,i,s=A.min(),o=A.min(),a=oe.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=c}withSequenceNumber(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var la=class{constructor(e){this.ct=e}};function e_(t){let e=Qg({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?ea(e,e.limit,"L"):e}var Ii=class{constructor(){}Pt(e,n){this.It(e,n),n.Tt()}It(e,n){if("nullValue"in e)this.Et(n,5);else if("booleanValue"in e)this.Et(n,10),n.dt(e.booleanValue?1:0);else if("integerValue"in e)this.Et(n,15),n.dt(M(e.integerValue));else if("doubleValue"in e){let r=M(e.doubleValue);isNaN(r)?this.Et(n,13):(this.Et(n,15),li(r)?n.dt(0):n.dt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Et(n,20),typeof r=="string"?n.At(r):(n.At(`${r.seconds||""}`),n.dt(r.nanos||0))}else if("stringValue"in e)this.Rt(e.stringValue,n),this.Vt(n);else if("bytesValue"in e)this.Et(n,30),n.ft($e(e.bytesValue)),this.Vt(n);else if("referenceValue"in e)this.gt(e.referenceValue,n);else if("geoPointValue"in e){let r=e.geoPointValue;this.Et(n,45),n.dt(r.latitude||0),n.dt(r.longitude||0)}else"mapValue"in e?Eh(e)?this.Et(n,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,n),this.Vt(n)):"arrayValue"in e?(this.wt(e.arrayValue,n),this.Vt(n)):T()}Rt(e,n){this.Et(n,25),this.St(e,n)}St(e,n){n.At(e)}yt(e,n){let r=e.fields||{};this.Et(n,55);for(let i of Object.keys(r))this.Rt(i,n),this.It(r[i],n)}wt(e,n){let r=e.values||[];this.Et(n,50);for(let i of r)this.It(i,n)}gt(e,n){this.Et(n,37),v.fromName(e).path.forEach(r=>{this.Et(n,60),this.St(r,n)})}Et(e,n){e.dt(n)}Vt(e){e.dt(2)}};Ii.bt=new Ii;var ha=class{constructor(){this._n=new da}addToCollectionParentIndex(e,n){return this._n.add(n),p.resolve()}getCollectionParents(e,n){return p.resolve(this._n.getEntries(n))}addFieldIndex(e,n){return p.resolve()}deleteFieldIndex(e,n){return p.resolve()}deleteAllFieldIndexes(e){return p.resolve()}createTargetIndexes(e,n){return p.resolve()}getDocumentsMatchingTarget(e,n){return p.resolve(null)}getIndexType(e,n){return p.resolve(0)}getFieldIndexes(e,n){return p.resolve([])}getNextCollectionGroupToUpdate(e){return p.resolve(null)}getMinOffset(e,n){return p.resolve(lt.min())}getMinOffsetFromCollectionGroup(e,n){return p.resolve(lt.min())}updateCollectionGroup(e,n,r){return p.resolve()}updateIndexEntries(e,n){return p.resolve()}},da=class{constructor(){this.index={}}add(e){let n=e.lastSegment(),r=e.popLast(),i=this.index[n]||new ie(q.comparator),s=!i.has(r);return this.index[n]=i.add(r),s}has(e){let n=e.lastSegment(),r=e.popLast(),i=this.index[n];return i&&i.has(r)}getEntries(e){return(this.index[e]||new ie(q.comparator)).toArray()}};var ZI=new Uint8Array(0);var Ee=class t{constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};Ee.DEFAULT_COLLECTION_PERCENTILE=10,Ee.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ee.DEFAULT=new Ee(41943040,Ee.DEFAULT_COLLECTION_PERCENTILE,Ee.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ee.DISABLED=new Ee(-1,0,0);var Yn=class t{constructor(e){this.On=e}next(){return this.On+=2,this.On}static Nn(){return new t(0)}static Ln(){return new t(-1)}};var fa=class{constructor(){this.changes=new ze(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,me.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();let r=this.changes.get(n);return r!==void 0?p.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var pa=class{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}};var ma=class{constructor(e,n,r,i){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,n))).next(i=>(r!==null&&qn(r.mutation,i,it.empty(),he.now()),i))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.getLocalViewOfDocuments(e,r,C()).next(()=>r))}getLocalViewOfDocuments(e,n,r=C()){let i=st();return this.populateOverlays(e,i,n).next(()=>this.computeViews(e,n,i,r).next(s=>{let o=Ln();return s.forEach((a,c)=>{o=o.insert(a,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,n){let r=st();return this.populateOverlays(e,r,n).next(()=>this.computeViews(e,n,r,C()))}populateOverlays(e,n,r){let i=[];return r.forEach(s=>{n.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{n.set(o,a)})})}computeViews(e,n,r,i){let s=je(),o=Un(),a=function(){return Un()}();return n.forEach((c,u)=>{let l=r.get(u.key);i.has(u.key)&&(l===void 0||l.mutation instanceof Wt)?s=s.insert(u.key,u):l!==void 0?(o.set(u.key,l.mutation.getFieldMask()),qn(l.mutation,u,l.mutation.getFieldMask(),he.now())):o.set(u.key,it.empty())}),this.recalculateAndSaveOverlays(e,s).next(c=>(c.forEach((u,l)=>o.set(u,l)),n.forEach((u,l)=>{var h;return a.set(u,new pa(l,(h=o.get(u))!==null&&h!==void 0?h:null))}),a))}recalculateAndSaveOverlays(e,n){let r=Un(),i=new F((o,a)=>o-a),s=C();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(o=>{for(let a of o)a.keys().forEach(c=>{let u=n.get(c);if(u===null)return;let l=r.get(c)||it.empty();l=a.applyToLocalView(u,l),r.set(c,l);let h=(i.get(a.batchId)||C()).add(c);i=i.insert(a.batchId,h)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let c=a.getNext(),u=c.key,l=c.value,h=Dh();l.forEach(f=>{if(!s.has(f)){let m=xh(n.get(f),r.get(f));m!==null&&h.set(f,m),s=s.add(f)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,h))}return p.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,n,r,i){return function(o){return v.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):Eg(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,i):this.getDocumentsMatchingCollectionQuery(e,n,r,i)}getNextDocuments(e,n,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,i-s.size):p.resolve(st()),a=-1,c=s;return o.next(u=>p.forEach(u,(l,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),s.get(l)?p.resolve():this.remoteDocumentCache.getEntry(e,l).next(f=>{c=c.insert(l,f)}))).next(()=>this.populateOverlays(e,u,s)).next(()=>this.computeViews(e,c,u,C())).next(l=>({batchId:a,changes:bg(l)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new v(n)).next(r=>{let i=Ln();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,n,r,i){let s=n.collectionGroup,o=Ln();return this.indexManager.getCollectionParents(e,s).next(a=>p.forEach(a,c=>{let u=function(h,f){return new $t(f,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(n,c.child(s));return this.getDocumentsMatchingCollectionQuery(e,u,r,i).next(l=>{l.forEach((h,f)=>{o=o.insert(h,f)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,n,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,s,i))).next(o=>{s.forEach((c,u)=>{let l=u.getKey();o.get(l)===null&&(o=o.insert(l,me.newInvalidDocument(l)))});let a=Ln();return o.forEach((c,u)=>{let l=s.get(c);l!==void 0&&qn(l.mutation,u,it.empty(),he.now()),Mi(n,u)&&(a=a.insert(c,u))}),a})}};var ga=class{constructor(e){this.serializer=e,this.cr=new Map,this.lr=new Map}getBundleMetadata(e,n){return p.resolve(this.cr.get(n))}saveBundleMetadata(e,n){return this.cr.set(n.id,function(i){return{id:i.id,version:i.version,createTime:Ot(i.createTime)}}(n)),p.resolve()}getNamedQuery(e,n){return p.resolve(this.lr.get(n))}saveNamedQuery(e,n){return this.lr.set(n.name,function(i){return{name:i.name,query:e_(i.bundledQuery),readTime:Ot(i.readTime)}}(n)),p.resolve()}};var _a=class{constructor(){this.overlays=new F(v.comparator),this.hr=new Map}getOverlay(e,n){return p.resolve(this.overlays.get(n))}getOverlays(e,n){let r=st();return p.forEach(n,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,n,r){return r.forEach((i,s)=>{this.ht(e,n,s)}),p.resolve()}removeOverlaysForBatchId(e,n,r){let i=this.hr.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.hr.delete(r)),p.resolve()}getOverlaysForCollection(e,n,r){let i=st(),s=n.length+1,o=new v(n.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let c=a.getNext().value,u=c.getKey();if(!n.isPrefixOf(u.path))break;u.path.length===s&&c.largestBatchId>r&&i.set(c.getKey(),c)}return p.resolve(i)}getOverlaysForCollectionGroup(e,n,r,i){let s=new F((u,l)=>u-l),o=this.overlays.getIterator();for(;o.hasNext();){let u=o.getNext().value;if(u.getKey().getCollectionGroup()===n&&u.largestBatchId>r){let l=s.get(u.largestBatchId);l===null&&(l=st(),s=s.insert(u.largestBatchId,l)),l.set(u.getKey(),u)}}let a=st(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((u,l)=>a.set(u,l)),!(a.size()>=i)););return p.resolve(a)}ht(e,n,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.hr.get(i.largestBatchId).delete(r.key);this.hr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new ra(n,r));let s=this.hr.get(n);s===void 0&&(s=C(),this.hr.set(n,s)),this.hr.set(n,s.add(r.key))}};var Jn=class{constructor(){this.Pr=new ie(B.Ir),this.Tr=new ie(B.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(e,n){let r=new B(e,n);this.Pr=this.Pr.add(r),this.Tr=this.Tr.add(r)}dr(e,n){e.forEach(r=>this.addReference(r,n))}removeReference(e,n){this.Ar(new B(e,n))}Rr(e,n){e.forEach(r=>this.removeReference(r,n))}Vr(e){let n=new v(new q([])),r=new B(n,e),i=new B(n,e+1),s=[];return this.Tr.forEachInRange([r,i],o=>{this.Ar(o),s.push(o.key)}),s}mr(){this.Pr.forEach(e=>this.Ar(e))}Ar(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}gr(e){let n=new v(new q([])),r=new B(n,e),i=new B(n,e+1),s=C();return this.Tr.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let n=new B(e,0),r=this.Pr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}},B=class{constructor(e,n){this.key=e,this.pr=n}static Ir(e,n){return v.comparator(e.key,n.key)||N(e.pr,n.pr)}static Er(e,n){return N(e.pr,n.pr)||v.comparator(e.key,n.key)}};var ya=class{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.yr=1,this.wr=new ie(B.Ir)}checkEmpty(e){return p.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,i){let s=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new na(s,n,r,i);this.mutationQueue.push(o);for(let a of i)this.wr=this.wr.add(new B(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return p.resolve(o)}lookupMutationBatch(e,n){return p.resolve(this.Sr(n))}getNextMutationBatchAfterBatchId(e,n){let r=n+1,i=this.br(r),s=i<0?0:i;return p.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return p.resolve(this.mutationQueue.length===0?-1:this.yr-1)}getAllMutationBatches(e){return p.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){let r=new B(n,0),i=new B(n,Number.POSITIVE_INFINITY),s=[];return this.wr.forEachInRange([r,i],o=>{let a=this.Sr(o.pr);s.push(a)}),p.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new ie(N);return n.forEach(i=>{let s=new B(i,0),o=new B(i,Number.POSITIVE_INFINITY);this.wr.forEachInRange([s,o],a=>{r=r.add(a.pr)})}),p.resolve(this.Dr(r))}getAllMutationBatchesAffectingQuery(e,n){let r=n.path,i=r.length+1,s=r;v.isDocumentKey(s)||(s=s.child(""));let o=new B(new v(s),0),a=new ie(N);return this.wr.forEachWhile(c=>{let u=c.key.path;return!!r.isPrefixOf(u)&&(u.length===i&&(a=a.add(c.pr)),!0)},o),p.resolve(this.Dr(a))}Dr(e){let n=[];return e.forEach(r=>{let i=this.Sr(r);i!==null&&n.push(i)}),n}removeMutationBatch(e,n){$(this.Cr(n.batchId,"removed")===0),this.mutationQueue.shift();let r=this.wr;return p.forEach(n.mutations,i=>{let s=new B(i.key,n.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.wr=r})}Mn(e){}containsKey(e,n){let r=new B(n,0),i=this.wr.firstAfterOrEqual(r);return p.resolve(n.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,p.resolve()}Cr(e,n){return this.br(e)}br(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Sr(e){let n=this.br(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}};var Ia=class{constructor(e){this.vr=e,this.docs=function(){return new F(v.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){let r=n.key,i=this.docs.get(r),s=i?i.size:0,o=this.vr(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){let r=this.docs.get(n);return p.resolve(r?r.document.mutableCopy():me.newInvalidDocument(n))}getEntries(e,n){let r=je();return n.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():me.newInvalidDocument(i))}),p.resolve(r)}getDocumentsMatchingQuery(e,n,r,i){let s=je(),o=n.path,a=new v(o.child("")),c=this.docs.getIteratorFrom(a);for(;c.hasNext();){let{key:u,value:{document:l}}=c.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||hg(lg(l),r)<=0||(i.has(l.key)||Mi(n,l))&&(s=s.insert(l.key,l.mutableCopy()))}return p.resolve(s)}getAllFromCollectionGroup(e,n,r,i){T()}Fr(e,n){return p.forEach(this.docs,r=>n(r))}newChangeBuffer(e){return new va(this)}getSize(e){return p.resolve(this.size)}},va=class extends fa{constructor(e){super(),this.ar=e}applyChanges(e){let n=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?n.push(this.ar.addEntry(e,i)):this.ar.removeEntry(r)}),p.waitFor(n)}getFromCache(e,n){return this.ar.getEntry(e,n)}getAllFromCache(e,n){return this.ar.getEntries(e,n)}};var Ea=class{constructor(e){this.persistence=e,this.Mr=new ze(n=>lc(n),hc),this.lastRemoteSnapshotVersion=A.min(),this.highestTargetId=0,this.Or=0,this.Nr=new Jn,this.targetCount=0,this.Lr=Yn.Nn()}forEachTarget(e,n){return this.Mr.forEach((r,i)=>n(i)),p.resolve()}getLastRemoteSnapshotVersion(e){return p.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return p.resolve(this.Or)}allocateTargetId(e){return this.highestTargetId=this.Lr.next(),p.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.Or&&(this.Or=n),p.resolve()}qn(e){this.Mr.set(e.target,e);let n=e.targetId;n>this.highestTargetId&&(this.Lr=new Yn(n),this.highestTargetId=n),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}addTargetData(e,n){return this.qn(n),this.targetCount+=1,p.resolve()}updateTargetData(e,n){return this.qn(n),p.resolve()}removeTargetData(e,n){return this.Mr.delete(n.target),this.Nr.Vr(n.targetId),this.targetCount-=1,p.resolve()}removeTargets(e,n,r){let i=0,s=[];return this.Mr.forEach((o,a)=>{a.sequenceNumber<=n&&r.get(a.targetId)===null&&(this.Mr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),p.waitFor(s).next(()=>i)}getTargetCount(e){return p.resolve(this.targetCount)}getTargetData(e,n){let r=this.Mr.get(n)||null;return p.resolve(r)}addMatchingKeys(e,n,r){return this.Nr.dr(n,r),p.resolve()}removeMatchingKeys(e,n,r){this.Nr.Rr(n,r);let i=this.persistence.referenceDelegate,s=[];return i&&n.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),p.waitFor(s)}removeMatchingKeysForTargetId(e,n){return this.Nr.Vr(n),p.resolve()}getMatchingKeysForTargetId(e,n){let r=this.Nr.gr(n);return p.resolve(r)}containsKey(e,n){return p.resolve(this.Nr.containsKey(n))}};var wa=class{constructor(e,n){this.Br={},this.overlays={},this.kr=new vh(0),this.qr=!1,this.qr=!0,this.referenceDelegate=e(this),this.Qr=new Ea(this),this.indexManager=new ha,this.remoteDocumentCache=function(i){return new Ia(i)}(r=>this.referenceDelegate.Kr(r)),this.serializer=new la(n),this.$r=new ga(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new _a,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.Br[e.toKey()];return r||(r=new ya(n,this.referenceDelegate),this.Br[e.toKey()]=r),r}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(e,n,r){y("MemoryPersistence","Starting transaction:",e);let i=new Ta(this.kr.next());return this.referenceDelegate.Ur(),r(i).next(s=>this.referenceDelegate.Wr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Gr(e,n){return p.or(Object.values(this.Br).map(r=>()=>r.containsKey(e,n)))}},Ta=class extends Mo{constructor(e){super(),this.currentSequenceNumber=e}},Aa=class t{constructor(e){this.persistence=e,this.zr=new Jn,this.jr=null}static Hr(e){return new t(e)}get Jr(){if(this.jr)return this.jr;throw T()}addReference(e,n,r){return this.zr.addReference(r,n),this.Jr.delete(r.toString()),p.resolve()}removeReference(e,n,r){return this.zr.removeReference(r,n),this.Jr.add(r.toString()),p.resolve()}markPotentiallyOrphaned(e,n){return this.Jr.add(n.toString()),p.resolve()}removeTarget(e,n){this.zr.Vr(n.targetId).forEach(i=>this.Jr.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next(i=>{i.forEach(s=>this.Jr.add(s.toString()))}).next(()=>r.removeTargetData(e,n))}Ur(){this.jr=new Set}Wr(e){let n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return p.forEach(this.Jr,r=>{let i=v.fromPath(r);return this.Yr(e,i).next(s=>{s||n.removeEntry(i,A.min())})}).next(()=>(this.jr=null,n.apply(e)))}updateLimboDocument(e,n){return this.Yr(e,n).next(r=>{r?this.Jr.delete(n.toString()):this.Jr.add(n.toString())})}Kr(e){return 0}Yr(e,n){return p.or([()=>p.resolve(this.zr.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Gr(e,n)])}};var Sa=class t{constructor(e,n,r,i){this.targetId=e,this.fromCache=n,this.qi=r,this.Qi=i}static Ki(e,n){let r=C(),i=C();for(let s of n.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new t(e,n.fromCache,r,i)}};var ba=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var Ra=class{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=function(){return Bc()?8:ui.v(ee())>0?6:4}()}initialize(e,n){this.zi=e,this.indexManager=n,this.$i=!0}getDocumentsMatchingQuery(e,n,r,i){let s={result:null};return this.ji(e,n).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Hi(e,n,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new ba;return this.Ji(e,n,o).next(a=>{if(s.result=a,this.Ui)return this.Yi(e,n,o,a.size)})}).next(()=>s.result)}Yi(e,n,r,i){return r.documentReadCount<this.Wi?(Vn()<=S.DEBUG&&y("QueryEngine","SDK will not create cache indexes for query:",Pt(n),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),p.resolve()):(Vn()<=S.DEBUG&&y("QueryEngine","Query:",Pt(n),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Gi*i?(Vn()<=S.DEBUG&&y("QueryEngine","The SDK decides to create cache indexes for query:",Pt(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Te(n))):p.resolve())}ji(e,n){if(Jl(n))return p.resolve(null);let r=Te(n);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(n.limit!==null&&i===1&&(n=ea(n,null,"F"),r=Te(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=C(...s);return this.zi.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(c=>{let u=this.Zi(n,a);return this.Xi(n,u,o,c.readTime)?this.ji(e,ea(n,null,"F")):this.es(e,u,n,c)}))})))}Hi(e,n,r,i){return Jl(n)||i.isEqual(A.min())?p.resolve(null):this.zi.getDocuments(e,r).next(s=>{let o=this.Zi(n,s);return this.Xi(n,o,r,i)?p.resolve(null):(Vn()<=S.DEBUG&&y("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Pt(n)),this.es(e,o,n,ug(i,-1)).next(a=>a))})}Zi(e,n){let r=new ie(Ph(e));return n.forEach((i,s)=>{Mi(e,s)&&(r=r.add(s))}),r}Xi(e,n,r,i){if(e.limit===null)return!1;if(r.size!==n.size)return!0;let s=e.limitType==="F"?n.last():n.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Ji(e,n,r){return Vn()<=S.DEBUG&&y("QueryEngine","Using full collection scan to execute query:",Pt(n)),this.zi.getDocumentsMatchingQuery(e,n,lt.min(),r)}es(e,n,r,i){return this.zi.getDocumentsMatchingQuery(e,r,i).next(s=>(n.forEach(o=>{s=s.insert(o.key,o)}),s))}};var Pa=class{constructor(e,n,r,i){this.persistence=e,this.ts=n,this.serializer=i,this.ns=new F(N),this.rs=new ze(s=>lc(s),hc),this.ss=new Map,this.os=e.getRemoteDocumentCache(),this.Qr=e.getTargetCache(),this.$r=e.getBundleCache(),this._s(r)}_s(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new ma(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.ns))}};function t_(t,e,n,r){return new Pa(t,e,n,r)}function zh(t,e){return d(this,null,function*(){let n=D(t);return yield n.persistence.runTransaction("Handle user change","readonly",r=>{let i;return n.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,n._s(e),n.mutationQueue.getAllMutationBatches(r))).next(s=>{let o=[],a=[],c=C();for(let u of i){o.push(u.batchId);for(let l of u.mutations)c=c.add(l.key)}for(let u of s){a.push(u.batchId);for(let l of u.mutations)c=c.add(l.key)}return n.localDocuments.getDocuments(r,c).next(u=>({us:u,removedBatchIds:o,addedBatchIds:a}))})})})}function jh(t){let e=D(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.Qr.getLastRemoteSnapshotVersion(n))}function n_(t,e){let n=D(t),r=e.snapshotVersion,i=n.ns;return n.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=n.os.newChangeBuffer({trackRemovals:!0});i=n.ns;let a=[];e.targetChanges.forEach((l,h)=>{let f=i.get(h);if(!f)return;a.push(n.Qr.removeMatchingKeys(s,l.removedDocuments,h).next(()=>n.Qr.addMatchingKeys(s,l.addedDocuments,h)));let m=f.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(h)!==null?m=m.withResumeToken(oe.EMPTY_BYTE_STRING,A.min()).withLastLimboFreeSnapshotVersion(A.min()):l.resumeToken.approximateByteSize()>0&&(m=m.withResumeToken(l.resumeToken,r)),i=i.insert(h,m),function(b,E,V){return b.resumeToken.approximateByteSize()===0||E.snapshotVersion.toMicroseconds()-b.snapshotVersion.toMicroseconds()>=3e8?!0:V.addedDocuments.size+V.modifiedDocuments.size+V.removedDocuments.size>0}(f,m,l)&&a.push(n.Qr.updateTargetData(s,m))});let c=je(),u=C();if(e.documentUpdates.forEach(l=>{e.resolvedLimboDocuments.has(l)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(s,l))}),a.push(r_(s,o,e.documentUpdates).next(l=>{c=l.cs,u=l.ls})),!r.isEqual(A.min())){let l=n.Qr.getLastRemoteSnapshotVersion(s).next(h=>n.Qr.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(l)}return p.waitFor(a).next(()=>o.apply(s)).next(()=>n.localDocuments.getLocalViewOfDocuments(s,c,u)).next(()=>c)}).then(s=>(n.ns=i,s))}function r_(t,e,n){let r=C(),i=C();return n.forEach(s=>r=r.add(s)),e.getEntries(t,r).next(s=>{let o=je();return n.forEach((a,c)=>{let u=s.get(a);c.isFoundDocument()!==u.isFoundDocument()&&(i=i.add(a)),c.isNoDocument()&&c.version.isEqual(A.min())?(e.removeEntry(a,c.readTime),o=o.insert(a,c)):!u.isValidDocument()||c.version.compareTo(u.version)>0||c.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(c),o=o.insert(a,c)):y("LocalStore","Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",c.version)}),{cs:o,ls:i}})}function i_(t,e){let n=D(t);return n.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return n.Qr.getTargetData(r,e).next(s=>s?(i=s,p.resolve(i)):n.Qr.allocateTargetId(r).next(o=>(i=new Qn(e,o,"TargetPurposeListen",r.currentSequenceNumber),n.Qr.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=n.ns.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.ns=n.ns.insert(r.targetId,r),n.rs.set(e,r.targetId)),r})}function Ca(t,e,n){return d(this,null,function*(){let r=D(t),i=r.ns.get(e),s=n?"readwrite":"readwrite-primary";try{n||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!er(o))throw o;y("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.ns=r.ns.remove(e),r.rs.delete(i.target)})}function ch(t,e,n){let r=D(t),i=A.min(),s=C();return r.persistence.runTransaction("Execute query","readwrite",o=>function(c,u,l){let h=D(c),f=h.rs.get(l);return f!==void 0?p.resolve(h.ns.get(f)):h.Qr.getTargetData(u,l)}(r,o,Te(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.Qr.getMatchingKeysForTargetId(o,a.targetId).next(c=>{s=c})}).next(()=>r.ts.getDocumentsMatchingQuery(o,e,n?i:A.min(),n?s:C())).next(a=>(s_(r,Tg(e),a),{documents:a,hs:s})))}function s_(t,e,n){let r=t.ss.get(e)||A.min();n.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),t.ss.set(e,r)}var vi=class{constructor(){this.activeTargetIds=Cg()}As(e){this.activeTargetIds=this.activeTargetIds.add(e)}Rs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ds(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}};var Da=class{constructor(){this.no=new vi,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e){return this.no.As(e),this.ro[e]||"not-current"}updateQueryState(e,n,r){this.ro[e]=n}removeLocalQueryTarget(e){this.no.Rs(e)}isLocalQueryTarget(e){return this.no.activeTargetIds.has(e)}clearQueryState(e){delete this.ro[e]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(e){return this.no.activeTargetIds.has(e)}start(){return this.no=new vi,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var ka=class{io(e){}shutdown(){}};var Ei=class{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(e){this.uo.push(e)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){y("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.uo)e(0)}ao(){y("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.uo)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var ii=null;function So(){return ii===null?ii=function(){return 268435456+Math.round(2147483648*Math.random())}():ii++,"0x"+ii.toString(16)}var o_={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var Na=class{constructor(e){this.lo=e.lo,this.ho=e.ho}Po(e){this.Io=e}To(e){this.Eo=e}onMessage(e){this.Ao=e}close(){this.ho()}send(e){this.lo(e)}Ro(){this.Io()}Vo(e){this.Eo(e)}mo(e){this.Ao(e)}};var re="WebChannelConnection",Oa=class extends class{constructor(n){this.databaseInfo=n,this.databaseId=n.databaseId;let r=n.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.fo=r+"://"+n.host,this.po=`projects/${i}/databases/${s}`,this.yo=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get wo(){return!1}So(n,r,i,s,o){let a=So(),c=this.bo(n,r.toUriEncodedString());y("RestConnection",`Sending RPC '${n}' ${a}:`,c,i);let u={"google-cloud-resource-prefix":this.po,"x-goog-request-params":this.yo};return this.Do(u,s,o),this.Co(n,c,u,i).then(l=>(y("RestConnection",`Received RPC '${n}' ${a}: `,l),l),l=>{throw Lt("RestConnection",`RPC '${n}' ${a} failed with error: `,l,"url: ",c,"request:",i),l})}vo(n,r,i,s,o,a){return this.So(n,r,i,s,o)}Do(n,r,i){n["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Ht}(),n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>n[o]=s),i&&i.headers.forEach((s,o)=>n[o]=s)}bo(n,r){let i=o_[n];return`${this.fo}/v1/${r}:${i}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Co(e,n,r,i){let s=So();return new Promise((o,a)=>{let c=new Bl;c.setWithCredentials(!0),c.listenOnce(Fl.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case ni.NO_ERROR:let l=c.getResponseJson();y(re,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(l)),o(l);break;case ni.TIMEOUT:y(re,`RPC '${e}' ${s} timed out`),a(new I(g.DEADLINE_EXCEEDED,"Request time out"));break;case ni.HTTP_ERROR:let h=c.getStatus();if(y(re,`RPC '${e}' ${s} failed with status:`,h,"response text:",c.getResponseText()),h>0){let f=c.getResponseJson();Array.isArray(f)&&(f=f[0]);let m=f?.error;if(m&&m.status&&m.message){let P=function(E){let V=E.toLowerCase().replace(/_/g,"-");return Object.values(g).indexOf(V)>=0?V:g.UNKNOWN}(m.status);a(new I(P,m.message))}else a(new I(g.UNKNOWN,"Server responded with status "+c.getStatus()))}else a(new I(g.UNAVAILABLE,"Connection failed."));break;default:T()}}finally{y(re,`RPC '${e}' ${s} completed.`)}});let u=JSON.stringify(i);y(re,`RPC '${e}' ${s} sending request:`,i),c.send(n,"POST",u,r,15)})}Fo(e,n,r){let i=So(),s=[this.fo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Ll(),a=Ml(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(c.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(c.useFetchStreams=!0),this.Do(c.initMessageHeaders,n,r),c.encodeInitMessageHeaders=!0;let l=s.join("");y(re,`Creating RPC '${e}' stream ${i}: ${l}`,c);let h=o.createWebChannel(l,c),f=!1,m=!1,P=new Na({lo:E=>{m?y(re,`Not sending because RPC '${e}' stream ${i} is closed:`,E):(f||(y(re,`Opening RPC '${e}' stream ${i} transport.`),h.open(),f=!0),y(re,`RPC '${e}' stream ${i} sending:`,E),h.send(E))},ho:()=>h.close()}),b=(E,V,j)=>{E.listen(V,Y=>{try{j(Y)}catch(Z){setTimeout(()=>{throw Z},0)}})};return b(h,xn.EventType.OPEN,()=>{m||y(re,`RPC '${e}' stream ${i} transport opened.`)}),b(h,xn.EventType.CLOSE,()=>{m||(m=!0,y(re,`RPC '${e}' stream ${i} transport closed`),P.Vo())}),b(h,xn.EventType.ERROR,E=>{m||(m=!0,Lt(re,`RPC '${e}' stream ${i} transport errored:`,E),P.Vo(new I(g.UNAVAILABLE,"The operation could not be completed")))}),b(h,xn.EventType.MESSAGE,E=>{var V;if(!m){let j=E.data[0];$(!!j);let Y=j,Z=Y.error||((V=Y[0])===null||V===void 0?void 0:V.error);if(Z){y(re,`RPC '${e}' stream ${i} received error:`,Z);let ge=Z.status,G=function(Yt){let rr=U[Yt];if(rr!==void 0)return Lh(rr)}(ge),Re=Z.message;G===void 0&&(G=g.INTERNAL,Re="Unknown error status: "+ge+" with message "+Z.message),m=!0,P.Vo(new I(G,Re)),h.close()}else y(re,`RPC '${e}' stream ${i} received:`,j),P.mo(j)}}),b(a,Ul.STAT_EVENT,E=>{E.stat===wo.PROXY?y(re,`RPC '${e}' stream ${i} detected buffering proxy`):E.stat===wo.NOPROXY&&y(re,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{P.Ro()},0),P}};function bo(){return typeof document<"u"?document:null}function Gh(t){return new aa(t,!0)}var wi=class{constructor(e,n,r=1e3,i=1.5,s=6e4){this.oi=e,this.timerId=n,this.Mo=r,this.xo=i,this.Oo=s,this.No=0,this.Lo=null,this.Bo=Date.now(),this.reset()}reset(){this.No=0}ko(){this.No=this.Oo}qo(e){this.cancel();let n=Math.floor(this.No+this.Qo()),r=Math.max(0,Date.now()-this.Bo),i=Math.max(0,n-r);i>0&&y("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.No} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.Lo=this.oi.enqueueAfterDelay(this.timerId,i,()=>(this.Bo=Date.now(),e())),this.No*=this.xo,this.No<this.Mo&&(this.No=this.Mo),this.No>this.Oo&&(this.No=this.Oo)}Ko(){this.Lo!==null&&(this.Lo.skipDelay(),this.Lo=null)}cancel(){this.Lo!==null&&(this.Lo.cancel(),this.Lo=null)}Qo(){return(Math.random()-.5)*this.No}};var xa=class{constructor(e,n,r,i,s,o,a,c){this.oi=e,this.$o=r,this.Uo=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=c,this.state=0,this.Wo=0,this.Go=null,this.zo=null,this.stream=null,this.jo=new wi(e,n)}Ho(){return this.state===1||this.state===5||this.Jo()}Jo(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Yo()}stop(){return d(this,null,function*(){this.Ho()&&(yield this.close(0))})}Zo(){this.state=0,this.jo.reset()}Xo(){this.Jo()&&this.Go===null&&(this.Go=this.oi.enqueueAfterDelay(this.$o,6e4,()=>this.e_()))}t_(e){this.n_(),this.stream.send(e)}e_(){return d(this,null,function*(){if(this.Jo())return this.close(0)})}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}r_(){this.zo&&(this.zo.cancel(),this.zo=null)}close(e,n){return d(this,null,function*(){this.n_(),this.r_(),this.jo.cancel(),this.Wo++,e!==4?this.jo.reset():n&&n.code===g.RESOURCE_EXHAUSTED?(Ae(n.toString()),Ae("Using maximum backoff delay to prevent overloading the backend."),this.jo.ko()):n&&n.code===g.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.i_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.To(n)})}i_(){}auth(){this.state=1;let e=this.s_(this.Wo),n=this.Wo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Wo===n&&this.o_(r,i)},r=>{e(()=>{let i=new I(g.UNKNOWN,"Fetching auth token failed: "+r.message);return this.__(i)})})}o_(e,n){let r=this.s_(this.Wo);this.stream=this.a_(e,n),this.stream.Po(()=>{r(()=>(this.state=2,this.zo=this.oi.enqueueAfterDelay(this.Uo,1e4,()=>(this.Jo()&&(this.state=3),Promise.resolve())),this.listener.Po()))}),this.stream.To(i=>{r(()=>this.__(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Yo(){this.state=5,this.jo.qo(()=>d(this,null,function*(){this.state=0,this.start()}))}__(e){return y("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}s_(e){return n=>{this.oi.enqueueAndForget(()=>this.Wo===e?n():(y("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Va=class extends xa{constructor(e,n,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,i,o),this.serializer=s}a_(e,n){return this.connection.Fo("Listen",e,n)}onMessage(e){this.jo.reset();let n=Wg(this.serializer,e),r=function(s){if(!("targetChange"in s))return A.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?A.min():o.readTime?Ot(o.readTime):A.min()}(e);return this.listener.u_(n,r)}c_(e){let n={};n.database=ah(this.serializer),n.addTarget=function(s,o){let a,c=o.target;if(a=Zo(c)?{documents:Kg(s,c)}:{query:Hg(s,c).ut},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=zg(s,o.resumeToken);let u=ca(s,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(A.min())>0){a.readTime=$g(s,o.snapshotVersion.toTimestamp());let u=ca(s,o.expectedCount);u!==null&&(a.expectedCount=u)}return a}(this.serializer,e);let r=Yg(this.serializer,e);r&&(n.labels=r),this.t_(n)}l_(e){let n={};n.database=ah(this.serializer),n.removeTarget=e,this.t_(n)}};var La=class extends class{}{constructor(e,n,r,i){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=i,this.A_=!1}R_(){if(this.A_)throw new I(g.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,n,r,i){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.So(e,ua(n,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===g.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new I(g.UNKNOWN,s.toString())})}vo(e,n,r,i,s){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.vo(e,ua(n,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===g.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new I(g.UNKNOWN,o.toString())})}terminate(){this.A_=!0,this.connection.terminate()}};var Ma=class{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.m_=0,this.f_=null,this.g_=!0}p_(){this.m_===0&&(this.y_("Unknown"),this.f_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.f_=null,this.w_("Backend didn't respond within 10 seconds."),this.y_("Offline"),Promise.resolve())))}S_(e){this.state==="Online"?this.y_("Unknown"):(this.m_++,this.m_>=1&&(this.b_(),this.w_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.y_("Offline")))}set(e){this.b_(),this.m_=0,e==="Online"&&(this.g_=!1),this.y_(e)}y_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}w_(e){let n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.g_?(Ae(n),this.g_=!1):y("OnlineStateTracker",n)}b_(){this.f_!==null&&(this.f_.cancel(),this.f_=null)}};var Fa=class{constructor(e,n,r,i,s){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.D_=[],this.C_=new Map,this.v_=new Set,this.F_=[],this.M_=s,this.M_.io(o=>{r.enqueueAndForget(()=>d(this,null,function*(){nr(this)&&(y("RemoteStore","Restarting streams for network reachability change."),yield function(c){return d(this,null,function*(){let u=D(c);u.v_.add(4),yield tr(u),u.x_.set("Unknown"),u.v_.delete(4),yield Fi(u)})}(this))}))}),this.x_=new Ma(r,i)}};function Fi(t){return d(this,null,function*(){if(nr(t))for(let e of t.F_)yield e(!0)})}function tr(t){return d(this,null,function*(){for(let e of t.F_)yield e(!1)})}function Wh(t,e){let n=D(t);n.C_.has(e.targetId)||(n.C_.set(e.targetId,e),gc(n)?mc(n):Qt(n).Jo()&&pc(n,e))}function fc(t,e){let n=D(t),r=Qt(n);n.C_.delete(e),r.Jo()&&Kh(n,e),n.C_.size===0&&(r.Jo()?r.Xo():nr(n)&&n.x_.set("Unknown"))}function pc(t,e){if(t.O_.Oe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(A.min())>0){let n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}Qt(t).c_(e)}function Kh(t,e){t.O_.Oe(e),Qt(t).l_(e)}function mc(t){t.O_=new oa({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),_t:e=>t.C_.get(e)||null,nt:()=>t.datastore.serializer.databaseId}),Qt(t).start(),t.x_.p_()}function gc(t){return nr(t)&&!Qt(t).Ho()&&t.C_.size>0}function nr(t){return D(t).v_.size===0}function Hh(t){t.O_=void 0}function a_(t){return d(this,null,function*(){t.C_.forEach((e,n)=>{pc(t,e)})})}function c_(t,e){return d(this,null,function*(){Hh(t),gc(t)?(t.x_.S_(e),mc(t)):t.x_.set("Unknown")})}function u_(t,e,n){return d(this,null,function*(){if(t.x_.set("Online"),e instanceof _i&&e.state===2&&e.cause)try{yield function(i,s){return d(this,null,function*(){let o=s.cause;for(let a of s.targetIds)i.C_.has(a)&&(yield i.remoteSyncer.rejectListen(a,o),i.C_.delete(a),i.O_.removeTarget(a))})}(t,e)}catch(r){y("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield uh(t,r)}else if(e instanceof Nt?t.O_.$e(e):e instanceof gi?t.O_.Je(e):t.O_.Ge(e),!n.isEqual(A.min()))try{let r=yield jh(t.localStore);n.compareTo(r)>=0&&(yield function(s,o){let a=s.O_.it(o);return a.targetChanges.forEach((c,u)=>{if(c.resumeToken.approximateByteSize()>0){let l=s.C_.get(u);l&&s.C_.set(u,l.withResumeToken(c.resumeToken,o))}}),a.targetMismatches.forEach((c,u)=>{let l=s.C_.get(c);if(!l)return;s.C_.set(c,l.withResumeToken(oe.EMPTY_BYTE_STRING,l.snapshotVersion)),Kh(s,c);let h=new Qn(l.target,c,u,l.sequenceNumber);pc(s,h)}),s.remoteSyncer.applyRemoteEvent(a)}(t,n))}catch(r){y("RemoteStore","Failed to raise snapshot:",r),yield uh(t,r)}})}function uh(t,e,n){return d(this,null,function*(){if(!er(e))throw e;t.v_.add(1),yield tr(t),t.x_.set("Offline"),n||(n=()=>jh(t.localStore)),t.asyncQueue.enqueueRetryable(()=>d(this,null,function*(){y("RemoteStore","Retrying IndexedDB access"),yield n(),t.v_.delete(1),yield Fi(t)}))})}function lh(t,e){return d(this,null,function*(){let n=D(t);n.asyncQueue.verifyOperationInProgress(),y("RemoteStore","RemoteStore received new credentials");let r=nr(n);n.v_.add(3),yield tr(n),r&&n.x_.set("Unknown"),yield n.remoteSyncer.handleCredentialChange(e),n.v_.delete(3),yield Fi(n)})}function l_(t,e){return d(this,null,function*(){let n=D(t);e?(n.v_.delete(2),yield Fi(n)):e||(n.v_.add(2),yield tr(n),n.x_.set("Unknown"))})}function Qt(t){return t.N_||(t.N_=function(n,r,i){let s=D(n);return s.R_(),new Va(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(t.datastore,t.asyncQueue,{Po:a_.bind(null,t),To:c_.bind(null,t),u_:u_.bind(null,t)}),t.F_.push(e=>d(this,null,function*(){e?(t.N_.Zo(),gc(t)?mc(t):t.x_.set("Unknown")):(yield t.N_.stop(),Hh(t))}))),t.N_}var Ua=class t{constructor(e,n,r,i,s){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Ne,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,i,s){let o=Date.now()+r,a=new t(e,n,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new I(g.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Qh(t,e){if(Ae("AsyncQueue",`${e}: ${t}`),er(t))return new I(g.UNAVAILABLE,`${e}: ${t}`);throw t}var Ti=class t{constructor(e){this.comparator=e?(n,r)=>e(n,r)||v.comparator(n.key,r.key):(n,r)=>v.comparator(n.key,r.key),this.keyedMap=Ln(),this.sortedSet=new F(this.comparator)}static emptySet(e){return new t(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,r)=>(e(n),!1))}add(e){let n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){let n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof t)||this.size!==e.size)return!1;let n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){let i=n.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){let r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}};var Ai=class{constructor(){this.B_=new F(v.comparator)}track(e){let n=e.doc.key,r=this.B_.get(n);r?e.type!==0&&r.type===3?this.B_=this.B_.insert(n,e):e.type===3&&r.type!==1?this.B_=this.B_.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.B_=this.B_.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.B_=this.B_.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.B_=this.B_.remove(n):e.type===1&&r.type===2?this.B_=this.B_.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.B_=this.B_.insert(n,{type:2,doc:e.doc}):T():this.B_=this.B_.insert(n,e)}k_(){let e=[];return this.B_.inorderTraversal((n,r)=>{e.push(r)}),e}},Kt=class t{constructor(e,n,r,i,s,o,a,c,u){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=c,this.hasCachedResults=u}static fromInitialDocuments(e,n,r,i,s){let o=[];return n.forEach(a=>{o.push({type:0,doc:a})}),new t(e,n,Ti.emptySet(n),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Li(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let i=0;i<n.length;i++)if(n[i].type!==r[i].type||!n[i].doc.isEqual(r[i].doc))return!1;return!0}};var Ba=class{constructor(){this.q_=void 0,this.Q_=[]}K_(){return this.Q_.some(e=>e.U_())}},qa=class{constructor(){this.queries=new ze(e=>Rh(e),Li),this.onlineState="Unknown",this.W_=new Set}};function h_(t,e){return d(this,null,function*(){let n=D(t),r=3,i=e.query,s=n.queries.get(i);s?!s.K_()&&e.U_()&&(r=2):(s=new Ba,r=e.U_()?0:1);try{switch(r){case 0:s.q_=yield n.onListen(i,!0);break;case 1:s.q_=yield n.onListen(i,!1);break;case 2:yield n.onFirstRemoteStoreListen(i)}}catch(o){let a=Qh(o,`Initialization of query '${Pt(e.query)}' failed`);return void e.onError(a)}n.queries.set(i,s),s.Q_.push(e),e.G_(n.onlineState),s.q_&&e.z_(s.q_)&&_c(n)})}function d_(t,e){return d(this,null,function*(){let n=D(t),r=e.query,i=3,s=n.queries.get(r);if(s){let o=s.Q_.indexOf(e);o>=0&&(s.Q_.splice(o,1),s.Q_.length===0?i=e.U_()?0:1:!s.K_()&&e.U_()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}})}function f_(t,e){let n=D(t),r=!1;for(let i of e){let s=i.query,o=n.queries.get(s);if(o){for(let a of o.Q_)a.z_(i)&&(r=!0);o.q_=i}}r&&_c(n)}function p_(t,e,n){let r=D(t),i=r.queries.get(e);if(i)for(let s of i.Q_)s.onError(n);r.queries.delete(e)}function _c(t){t.W_.forEach(e=>{e.next()})}var $a,hh;(hh=$a||($a={})).j_="default",hh.Cache="cache";var za=class{constructor(e,n,r){this.query=e,this.H_=n,this.J_=!1,this.Y_=null,this.onlineState="Unknown",this.options=r||{}}z_(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new Kt(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.J_?this.Z_(e)&&(this.H_.next(e),n=!0):this.X_(e,this.onlineState)&&(this.ea(e),n=!0),this.Y_=e,n}onError(e){this.H_.error(e)}G_(e){this.onlineState=e;let n=!1;return this.Y_&&!this.J_&&this.X_(this.Y_,e)&&(this.ea(this.Y_),n=!0),n}X_(e,n){if(!e.fromCache||!this.U_())return!0;let r=n!=="Offline";return(!this.options.ta||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}Z_(e){if(e.docChanges.length>0)return!0;let n=this.Y_&&this.Y_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}ea(e){e=Kt.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.J_=!0,this.H_.next(e)}U_(){return this.options.source!==$a.Cache}};var Si=class{constructor(e){this.key=e}},bi=class{constructor(e){this.key=e}},ja=class{constructor(e,n){this.query=e,this.ua=n,this.ca=null,this.hasCachedResults=!1,this.current=!1,this.la=C(),this.mutatedKeys=C(),this.ha=Ph(e),this.Pa=new Ti(this.ha)}get Ia(){return this.ua}Ta(e,n){let r=n?n.Ea:new Ai,i=n?n.Pa:this.Pa,s=n?n.mutatedKeys:this.mutatedKeys,o=i,a=!1,c=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,u=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((l,h)=>{let f=i.get(l),m=Mi(this.query,h)?h:null,P=!!f&&this.mutatedKeys.has(f.key),b=!!m&&(m.hasLocalMutations||this.mutatedKeys.has(m.key)&&m.hasCommittedMutations),E=!1;f&&m?f.data.isEqual(m.data)?P!==b&&(r.track({type:3,doc:m}),E=!0):this.da(f,m)||(r.track({type:2,doc:m}),E=!0,(c&&this.ha(m,c)>0||u&&this.ha(m,u)<0)&&(a=!0)):!f&&m?(r.track({type:0,doc:m}),E=!0):f&&!m&&(r.track({type:1,doc:f}),E=!0,(c||u)&&(a=!0)),E&&(m?(o=o.add(m),s=b?s.add(l):s.delete(l)):(o=o.delete(l),s=s.delete(l)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let l=this.query.limitType==="F"?o.last():o.first();o=o.delete(l.key),s=s.delete(l.key),r.track({type:1,doc:l})}return{Pa:o,Ea:r,Xi:a,mutatedKeys:s}}da(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,i){let s=this.Pa;this.Pa=e.Pa,this.mutatedKeys=e.mutatedKeys;let o=e.Ea.k_();o.sort((l,h)=>function(m,P){let b=E=>{switch(E){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return T()}};return b(m)-b(P)}(l.type,h.type)||this.ha(l.doc,h.doc)),this.Aa(r),i=i!=null&&i;let a=n&&!i?this.Ra():[],c=this.la.size===0&&this.current&&!i?1:0,u=c!==this.ca;return this.ca=c,o.length!==0||u?{snapshot:new Kt(this.query,e.Pa,s,o,e.mutatedKeys,c===0,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),Va:a}:{Va:a}}G_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Pa:this.Pa,Ea:new Ai,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{Va:[]}}ma(e){return!this.ua.has(e)&&!!this.Pa.has(e)&&!this.Pa.get(e).hasLocalMutations}Aa(e){e&&(e.addedDocuments.forEach(n=>this.ua=this.ua.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.ua=this.ua.delete(n)),this.current=e.current)}Ra(){if(!this.current)return[];let e=this.la;this.la=C(),this.Pa.forEach(r=>{this.ma(r.key)&&(this.la=this.la.add(r.key))});let n=[];return e.forEach(r=>{this.la.has(r)||n.push(new bi(r))}),this.la.forEach(r=>{e.has(r)||n.push(new Si(r))}),n}fa(e){this.ua=e.hs,this.la=C();let n=this.Ta(e.documents);return this.applyChanges(n,!0)}ga(){return Kt.fromInitialDocuments(this.query,this.Pa,this.mutatedKeys,this.ca===0,this.hasCachedResults)}},Ga=class{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}},Wa=class{constructor(e){this.key=e,this.pa=!1}},Ka=class{constructor(e,n,r,i,s,o){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.ya={},this.wa=new ze(a=>Rh(a),Li),this.Sa=new Map,this.ba=new Set,this.Da=new F(v.comparator),this.Ca=new Map,this.va=new Jn,this.Fa={},this.Ma=new Map,this.xa=Yn.Ln(),this.onlineState="Unknown",this.Oa=void 0}get isPrimaryClient(){return this.Oa===!0}};function m_(t,e,n=!0){return d(this,null,function*(){let r=ed(t),i,s=r.wa.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.ga()):i=yield Yh(r,e,n,!0),i})}function g_(t,e){return d(this,null,function*(){let n=ed(t);yield Yh(n,e,!0,!1)})}function Yh(t,e,n,r){return d(this,null,function*(){let i=yield i_(t.localStore,Te(e)),s=i.targetId,o=n?t.sharedClientState.addLocalQueryTarget(s):"not-current",a;return r&&(a=yield __(t,e,s,o==="current",i.resumeToken)),t.isPrimaryClient&&n&&Wh(t.remoteStore,i),a})}function __(t,e,n,r,i){return d(this,null,function*(){t.Na=(h,f,m)=>function(b,E,V,j){return d(this,null,function*(){let Y=E.view.Ta(V);Y.Xi&&(Y=yield ch(b.localStore,E.query,!1).then(({documents:Re})=>E.view.Ta(Re,Y)));let Z=j&&j.targetChanges.get(E.targetId),ge=j&&j.targetMismatches.get(E.targetId)!=null,G=E.view.applyChanges(Y,b.isPrimaryClient,Z,ge);return fh(b,E.targetId,G.Va),G.snapshot})}(t,h,f,m);let s=yield ch(t.localStore,e,!0),o=new ja(e,s.hs),a=o.Ta(s.documents),c=Hn.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",i),u=o.applyChanges(a,t.isPrimaryClient,c);fh(t,n,u.Va);let l=new Ga(e,n,o);return t.wa.set(e,l),t.Sa.has(n)?t.Sa.get(n).push(e):t.Sa.set(n,[e]),u.snapshot})}function y_(t,e,n){return d(this,null,function*(){let r=D(t),i=r.wa.get(e),s=r.Sa.get(i.targetId);if(s.length>1)return r.Sa.set(i.targetId,s.filter(o=>!Li(o,e))),void r.wa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Ca(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),n&&fc(r.remoteStore,i.targetId),Ha(r,i.targetId)}).catch(sc))):(Ha(r,i.targetId),yield Ca(r.localStore,i.targetId,!0))})}function I_(t,e){return d(this,null,function*(){let n=D(t),r=n.wa.get(e),i=n.Sa.get(r.targetId);n.isPrimaryClient&&i.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),fc(n.remoteStore,r.targetId))})}function Jh(t,e){return d(this,null,function*(){let n=D(t);try{let r=yield n_(n.localStore,e);e.targetChanges.forEach((i,s)=>{let o=n.Ca.get(s);o&&($(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.pa=!0:i.modifiedDocuments.size>0?$(o.pa):i.removedDocuments.size>0&&($(o.pa),o.pa=!1))}),yield Zh(n,r,e)}catch(r){yield sc(r)}})}function dh(t,e,n){let r=D(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){let i=[];r.wa.forEach((s,o)=>{let a=o.view.G_(e);a.snapshot&&i.push(a.snapshot)}),function(o,a){let c=D(o);c.onlineState=a;let u=!1;c.queries.forEach((l,h)=>{for(let f of h.Q_)f.G_(a)&&(u=!0)}),u&&_c(c)}(r.eventManager,e),i.length&&r.ya.u_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function v_(t,e,n){return d(this,null,function*(){let r=D(t);r.sharedClientState.updateQueryState(e,"rejected",n);let i=r.Ca.get(e),s=i&&i.key;if(s){let o=new F(v.comparator);o=o.insert(s,me.newNoDocument(s,A.min()));let a=C().add(s),c=new mi(A.min(),new Map,new F(N),o,a);yield Jh(r,c),r.Da=r.Da.remove(s),r.Ca.delete(e),yc(r)}else yield Ca(r.localStore,e,!1).then(()=>Ha(r,e,n)).catch(sc)})}function Ha(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(let r of t.Sa.get(e))t.wa.delete(r),n&&t.ya.La(r,n);t.Sa.delete(e),t.isPrimaryClient&&t.va.Vr(e).forEach(r=>{t.va.containsKey(r)||Xh(t,r)})}function Xh(t,e){t.ba.delete(e.path.canonicalString());let n=t.Da.get(e);n!==null&&(fc(t.remoteStore,n),t.Da=t.Da.remove(e),t.Ca.delete(n),yc(t))}function fh(t,e,n){for(let r of n)r instanceof Si?(t.va.addReference(r.key,e),E_(t,r)):r instanceof bi?(y("SyncEngine","Document no longer in limbo: "+r.key),t.va.removeReference(r.key,e),t.va.containsKey(r.key)||Xh(t,r.key)):T()}function E_(t,e){let n=e.key,r=n.path.canonicalString();t.Da.get(n)||t.ba.has(r)||(y("SyncEngine","New document in limbo: "+n),t.ba.add(r),yc(t))}function yc(t){for(;t.ba.size>0&&t.Da.size<t.maxConcurrentLimboResolutions;){let e=t.ba.values().next().value;t.ba.delete(e);let n=new v(q.fromString(e)),r=t.xa.next();t.Ca.set(r,new Wa(n)),t.Da=t.Da.insert(n,r),Wh(t.remoteStore,new Qn(Te(dc(n.path)),r,"TargetPurposeLimboResolution",vh._e))}}function Zh(t,e,n){return d(this,null,function*(){let r=D(t),i=[],s=[],o=[];r.wa.isEmpty()||(r.wa.forEach((a,c)=>{o.push(r.Na(c,e,n).then(u=>{if((u||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(c.targetId,u?.fromCache?"not-current":"current"),u){i.push(u);let l=Sa.Ki(c.targetId,u);s.push(l)}}))}),yield Promise.all(o),r.ya.u_(i),yield function(c,u){return d(this,null,function*(){let l=D(c);try{yield l.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>p.forEach(u,f=>p.forEach(f.qi,m=>l.persistence.referenceDelegate.addReference(h,f.targetId,m)).next(()=>p.forEach(f.Qi,m=>l.persistence.referenceDelegate.removeReference(h,f.targetId,m)))))}catch(h){if(!er(h))throw h;y("LocalStore","Failed to update sequence numbers: "+h)}for(let h of u){let f=h.targetId;if(!h.fromCache){let m=l.ns.get(f),P=m.snapshotVersion,b=m.withLastLimboFreeSnapshotVersion(P);l.ns=l.ns.insert(f,b)}}})}(r.localStore,s))})}function w_(t,e){return d(this,null,function*(){let n=D(t);if(!n.currentUser.isEqual(e)){y("SyncEngine","User change. New user:",e.toKey());let r=yield zh(n.localStore,e);n.currentUser=e,function(s,o){s.Ma.forEach(a=>{a.forEach(c=>{c.reject(new I(g.CANCELLED,o))})}),s.Ma.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield Zh(n,r.us)}})}function T_(t,e){let n=D(t),r=n.Ca.get(e);if(r&&r.pa)return C().add(r.key);{let i=C(),s=n.Sa.get(e);if(!s)return i;for(let o of s){let a=n.wa.get(o);i=i.unionWith(a.view.Ia)}return i}}function ed(t){let e=D(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Jh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=T_.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=v_.bind(null,e),e.ya.u_=f_.bind(null,e.eventManager),e.ya.La=p_.bind(null,e.eventManager),e}var Ri=class{constructor(){this.synchronizeTabs=!1}initialize(e){return d(this,null,function*(){this.serializer=Gh(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),yield this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)})}createGarbageCollectionScheduler(e,n){return null}createIndexBackfillerScheduler(e,n){return null}createLocalStore(e){return t_(this.persistence,new Ra,e.initialUser,this.serializer)}createPersistence(e){return new wa(Aa.Hr,this.serializer)}createSharedClientState(e){return new Da}terminate(){return d(this,null,function*(){var e,n;(e=this.gcScheduler)===null||e===void 0||e.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var Qa=class{initialize(e,n){return d(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>dh(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=w_.bind(null,this.syncEngine),yield l_(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return function(){return new qa}()}createDatastore(e){let n=Gh(e.databaseInfo.databaseId),r=function(s){return new Oa(s)}(e.databaseInfo);return function(s,o,a,c){return new La(s,o,a,c)}(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return function(r,i,s,o,a){return new Fa(r,i,s,o,a)}(this.localStore,this.datastore,e.asyncQueue,n=>dh(this.syncEngine,n,0),function(){return Ei.D()?new Ei:new ka}())}createSyncEngine(e,n){return function(i,s,o,a,c,u,l){let h=new Ka(i,s,o,a,c,u);return l&&(h.Oa=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}terminate(){return d(this,null,function*(){var e;yield function(r){return d(this,null,function*(){let i=D(r);y("RemoteStore","RemoteStore shutting down."),i.v_.add(5),yield tr(i),i.M_.shutdown(),i.x_.set("Unknown")})}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate()})}};var Ya=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.qa(this.observer.next,e)}error(e){this.observer.error?this.qa(this.observer.error,e):Ae("Uncaught Error in snapshot listener:",e.toString())}Qa(){this.muted=!0}qa(e,n){this.muted||setTimeout(()=>{this.muted||e(n)},0)}};var Ja=class{constructor(e,n,r,i){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=i,this.user=Q.UNAUTHENTICATED,this.clientId=Vo.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,s=>d(this,null,function*(){y("FirestoreClient","Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(r,s=>(y("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new I(g.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new Ne;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>d(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){let r=Qh(n,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function Ro(t,e){return d(this,null,function*(){t.asyncQueue.verifyOperationInProgress(),y("FirestoreClient","Initializing OfflineComponentProvider");let n=t.configuration;yield e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(i=>d(this,null,function*(){r.isEqual(i)||(yield zh(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e})}function ph(t,e){return d(this,null,function*(){t.asyncQueue.verifyOperationInProgress();let n=yield S_(t);y("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(n,t.configuration),t.setCredentialChangeListener(r=>lh(e.remoteStore,r)),t.setAppCheckTokenChangeListener((r,i)=>lh(e.remoteStore,i)),t._onlineComponents=e})}function A_(t){return t.name==="FirebaseError"?t.code===g.FAILED_PRECONDITION||t.code===g.UNIMPLEMENTED:!(typeof DOMException<"u"&&t instanceof DOMException)||t.code===22||t.code===20||t.code===11}function S_(t){return d(this,null,function*(){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){y("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Ro(t,t._uninitializedComponentsProvider._offline)}catch(e){let n=e;if(!A_(n))throw n;Lt("Error using user provided cache. Falling back to memory cache: "+n),yield Ro(t,new Ri)}}else y("FirestoreClient","Using default OfflineComponentProvider"),yield Ro(t,new Ri);return t._offlineComponents})}function b_(t){return d(this,null,function*(){return t._onlineComponents||(t._uninitializedComponentsProvider?(y("FirestoreClient","Using user provided OnlineComponentProvider"),yield ph(t,t._uninitializedComponentsProvider._online)):(y("FirestoreClient","Using default OnlineComponentProvider"),yield ph(t,new Qa))),t._onlineComponents})}function mh(t){return d(this,null,function*(){let e=yield b_(t),n=e.eventManager;return n.onListen=m_.bind(null,e.syncEngine),n.onUnlisten=y_.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=g_.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=I_.bind(null,e.syncEngine),n})}function td(t){let e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}var gh=new Map;function R_(t,e,n){if(!n)throw new I(g.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function P_(t,e,n,r){if(e===!0&&r===!0)throw new I(g.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function _h(t){if(v.isDocumentKey(t))throw new I(g.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function C_(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{let e=function(r){return r.constructor?r.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":T()}function oi(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new I(g.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let n=C_(t);throw new I(g.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}var Pi=class{constructor(e){var n,r;if(e.host===void 0){if(e.ssl!==void 0)throw new I(g.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(n=e.ssl)===null||n===void 0||n;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new I(g.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}P_("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=td((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new I(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new I(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new I(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},Xn=class{constructor(e,n,r,i){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Pi({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new I(g.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new I(g.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Pi(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new Po;switch(r.type){case"firstParty":return new No(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new I(g.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){let r=gh.get(n);r&&(y("ComponentProvider","Removing Datastore"),gh.delete(n),r.terminate())}(this),Promise.resolve()}};function nd(t,e,n,r={}){var i;let s=(t=oi(t,Xn))._getSettings(),o=`${e}:${n}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&Lt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,c;if(typeof r.mockUserToken=="string")a=r.mockUserToken,c=Q.MOCK_USER;else{a=Lc(r.mockUserToken,(i=t._app)===null||i===void 0?void 0:i.options.projectId);let u=r.mockUserToken.sub||r.mockUserToken.user_id;if(!u)throw new I(g.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new Q(u)}t._authCredentials=new Co(new ai(a,c))}}var Ci=class t{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new t(this.firestore,e,this._query)}},dt=class t{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new xt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new t(this.firestore,e,this._key)}},xt=class t extends Ci{constructor(e,n,r){super(e,n,dc(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new dt(this.firestore,null,new v(e))}withConverter(e){return new t(this.firestore,e,this._path)}};function rd(t,e,...n){if(t=xe(t),R_("collection","path",e),t instanceof Xn){let r=q.fromString(e,...n);return _h(r),new xt(t,null,r)}{if(!(t instanceof dt||t instanceof xt))throw new I(g.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=t._path.child(q.fromString(e,...n));return _h(r),new xt(t.firestore,null,r)}}var Xa=class{constructor(){this.nu=Promise.resolve(),this.ru=[],this.iu=!1,this.su=[],this.ou=null,this._u=!1,this.au=!1,this.uu=[],this.jo=new wi(this,"async_queue_retry"),this.cu=()=>{let n=bo();n&&y("AsyncQueue","Visibility state changed to "+n.visibilityState),this.jo.Ko()};let e=bo();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.cu)}get isShuttingDown(){return this.iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.lu(),this.hu(e)}enterRestrictedMode(e){if(!this.iu){this.iu=!0,this.au=e||!1;let n=bo();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this.cu)}}enqueue(e){if(this.lu(),this.iu)return new Promise(()=>{});let n=new Ne;return this.hu(()=>this.iu&&this.au?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.ru.push(e),this.Pu()))}Pu(){return d(this,null,function*(){if(this.ru.length!==0){try{yield this.ru[0](),this.ru.shift(),this.jo.reset()}catch(e){if(!er(e))throw e;y("AsyncQueue","Operation failed with retryable error: "+e)}this.ru.length>0&&this.jo.qo(()=>this.Pu())}})}hu(e){let n=this.nu.then(()=>(this._u=!0,e().catch(r=>{this.ou=r,this._u=!1;let i=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw Ae("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this._u=!1,r))));return this.nu=n,n}enqueueAfterDelay(e,n,r){this.lu(),this.uu.indexOf(e)>-1&&(n=0);let i=Ua.createAndSchedule(this,e,n,r,s=>this.Iu(s));return this.su.push(i),i}lu(){this.ou&&T()}verifyOperationInProgress(){}Tu(){return d(this,null,function*(){let e;do e=this.nu,yield e;while(e!==this.nu)})}Eu(e){for(let n of this.su)if(n.timerId===e)return!0;return!1}du(e){return this.Tu().then(()=>{this.su.sort((n,r)=>n.targetTimeMs-r.targetTimeMs);for(let n of this.su)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Tu()})}Au(e){this.uu.push(e)}Iu(e){let n=this.su.indexOf(e);this.su.splice(n,1)}};function yh(t){return function(n,r){if(typeof n!="object"||n===null)return!1;let i=n;for(let s of r)if(s in i&&typeof i[s]=="function")return!0;return!1}(t,["next","error","complete"])}var Zn=class extends Xn{constructor(e,n,r,i){super(e,n,r,i),this.type="firestore",this._queue=function(){return new Xa}(),this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||sd(this),this._firestoreClient.terminate()}};function id(t,e){let n=typeof t=="object"?t:tn(),r=typeof t=="string"?t:e||"(default)",i=ds(n,"firestore").getImmediate({identifier:r});if(!i._initialized){let s=xc("firestore");s&&nd(i,...s)}return i}function D_(t){return t._firestoreClient||sd(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function sd(t){var e,n,r;let i=t._freezeSettings(),s=function(a,c,u,l){return new qo(a,c,u,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,td(l.experimentalLongPollingOptions),l.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,i);t._firestoreClient=new Ja(t._authCredentials,t._appCheckCredentials,t._queue,s),!((n=i.localCache)===null||n===void 0)&&n._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(t._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}var Za=class t{constructor(e){this._byteString=e}static fromBase64String(e){try{return new t(oe.fromBase64String(e))}catch(n){throw new I(g.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new t(oe.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var Di=class{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new I(g.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new pe(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var ec=class{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new I(g.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new I(g.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return N(this._lat,e._lat)||N(this._long,e._long)}};var k_=new RegExp("[~\\*/\\[\\]]");function N_(t,e,n){if(e.search(k_)>=0)throw Ih(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Di(...e.split("."))._internalPath}catch{throw Ih(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Ih(t,e,n,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new I(g.INVALID_ARGUMENT,a+t+c)}var ki=class{constructor(e,n,r,i,s){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new dt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new tc(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let n=this._document.data.field(od("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}},tc=class extends ki{data(){return super.data()}};function od(t,e){return typeof e=="string"?N_(t,e):e instanceof Di?e._internalPath:e._delegate._internalPath}function O_(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new I(g.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var nc=class{convertValue(e,n="none"){switch(ht(e)){case 0:return null;case 1:return e.booleanValue;case 2:return M(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes($e(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 10:return this.convertObject(e.mapValue,n);default:throw T()}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){let r={};return Vi(e,(i,s)=>{r[i]=this.convertValue(s,n)}),r}convertGeoPoint(e){return new ec(M(e.latitude),M(e.longitude))}convertArray(e,n){return(e.values||[]).map(r=>this.convertValue(r,n))}convertServerTimestamp(e,n){switch(n){case"previous":let r=cc(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp($n(e));default:return null}}convertTimestamp(e){let n=qe(e);return new he(n.seconds,n.nanos)}convertDocumentKey(e,n){let r=q.fromString(e);$($h(r));let i=new fi(r.get(1),r.get(3)),s=new v(r.popFirst(5));return i.isEqual(n)||Ae(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),s}};var at=class{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},Ni=class extends ki{constructor(e,n,r,i,s,o){super(e,n,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let n=new Vt(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){let r=this._document.data.field(od("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}},Vt=class extends Ni{data(e={}){return super.data(e)}},rc=class{constructor(e,n,r,i){this._firestore=e,this._userDataWriter=n,this._snapshot=i,this.metadata=new at(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(r=>{e.call(n,new Vt(this._firestore,this._userDataWriter,r.key,r,new at(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new I(g.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>{let c=new Vt(i._firestore,i._userDataWriter,a.doc.key,a.doc,new at(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);return a.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{let c=new Vt(i._firestore,i._userDataWriter,a.doc.key,a.doc,new at(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter),u=-1,l=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),l=o.indexOf(a.doc.key)),{type:x_(a.type),doc:c,oldIndex:u,newIndex:l}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}};function x_(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return T()}}var Oi=class extends nc{constructor(e){super(),this.firestore=e}convertBytes(e){return new Za(e)}convertReference(e){let n=this.convertDocumentKey(e,this.firestore._databaseId);return new dt(this.firestore,null,n)}};function Ic(t,...e){var n,r,i;t=xe(t);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||yh(e[o])||(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(yh(e[o])){let h=e[o];e[o]=(n=h.next)===null||n===void 0?void 0:n.bind(h),e[o+1]=(r=h.error)===null||r===void 0?void 0:r.bind(h),e[o+2]=(i=h.complete)===null||i===void 0?void 0:i.bind(h)}let c,u,l;if(t instanceof dt)u=oi(t.firestore,Zn),l=dc(t._key.path),c={next:h=>{e[o]&&e[o](V_(u,t,h))},error:e[o+1],complete:e[o+2]};else{let h=oi(t,Ci);u=oi(h.firestore,Zn),l=h._query;let f=new Oi(u);c={next:m=>{e[o]&&e[o](new rc(u,f,h,m))},error:e[o+1],complete:e[o+2]},O_(t._query)}return function(f,m,P,b){let E=new Ya(b),V=new za(m,E,P);return f.asyncQueue.enqueueAndForget(()=>d(this,null,function*(){return h_(yield mh(f),V)})),()=>{E.Qa(),f.asyncQueue.enqueueAndForget(()=>d(this,null,function*(){return d_(yield mh(f),V)}))}}(D_(u),l,a,c)}function V_(t,e,n){let r=n.docs.get(e._key),i=new Oi(t);return new Ni(t,i,e._key,r,new at(n.hasPendingWrites,n.fromCache),e.converter)}(function(e,n=!0){(function(i){Ht=i})(It),Me(new ue("firestore",(r,{instanceIdentifier:i,options:s})=>{let o=r.getProvider("app").getImmediate(),a=new Zn(new Do(r.getProvider("auth-internal")),new xo(r.getProvider("app-check-internal")),function(u,l){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new I(g.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new fi(u.options.projectId,l)}(o,i),o);return s=Object.assign({useFetchStreams:n},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),W($l,"4.5.1",e),W($l,"4.5.1","esm2017")})();var Ui=function(){return Ui=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Ui.apply(this,arguments)};var F_={includeMetadataChanges:!1};function ad(t,e){return e===void 0&&(e=F_),new Jt(function(n){var r=Ic(t,e,{next:n.next.bind(n),error:n.error.bind(n),complete:n.complete.bind(n)});return{unsubscribe:r}})}function cd(t,e){var n;e===void 0&&(e={});var r=t.data(e);return!t.exists()||typeof r!="object"||r===null||!e.idField?r:Ui(Ui({},r),(n={},n[e.idField]=t.id,n))}function ud(t){return ad(t,{includeMetadataChanges:!0}).pipe(Gi(function(e){return e.docs}))}function ld(t,e){return e===void 0&&(e={}),ud(t).pipe(Gi(function(n){return n.map(function(r){return cd(r,e)})}))}var ft=class{constructor(e){return e}},hd="firestore",vc=class{constructor(){return rn(hd)}};var Ec=new or("angularfire2.firestore-instances");function U_(t,e){let n=gs(hd,t,e);return n&&new ft(n)}function B_(t){return(e,n)=>{let r=e.runOutsideAngular(()=>t(n));return new ft(r)}}var q_={provide:vc,deps:[[new Oe,Ec]]},$_={provide:ft,useFactory:U_,deps:[[new Oe,Ec],Qe]},z_=(()=>{class t{constructor(){W("angularfire",Et.full,"fst")}static \u0275fac=function(r){return new(r||t)};static \u0275mod=ar({type:t});static \u0275inj=sr({providers:[$_,q_]})}return t})();function BE(t,...e){return{ngModule:z_,providers:[{provide:Ec,useFactory:B_(t),multi:!0,deps:[gt,cr,sn,on,[new Oe,Rr],[new Oe,nn],...e]}]}}var Bi=He(ld,!0);var qi=He(rd,!0);var qE=He(id,!0);var jE=(()=>{let e=class e{constructor(r){this._Firestore=r,this.dateCollection=qi(this._Firestore,"data"),this.linksCollection=qi(this._Firestore,"links"),this.projectsCollection=qi(this._Firestore,"projects")}getData(){return Bi(this.dateCollection,{idField:"id"})}getLinks(){return Bi(this.linksCollection,{idField:"id"})}getProjects(){return Bi(this.projectsCollection,{idField:"id"})}};e.\u0275fac=function(i){return new(i||e)(mt(ft))},e.\u0275prov=ir({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();export{Cy as a,Dy as b,BE as c,qE as d,jE as e};
